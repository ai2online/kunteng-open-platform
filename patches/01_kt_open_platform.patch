diff -urpN target_orig/linux/ar71xx/base-files/etc/diag.sh target/linux/ar71xx/base-files/etc/diag.sh
--- target_orig/linux/ar71xx/base-files/etc/diag.sh	2016-06-17 15:12:18.444786372 +0800
+++ target/linux/ar71xx/base-files/etc/diag.sh	2016-07-18 09:34:17.009095085 +0800
@@ -25,6 +25,12 @@ get_status_led() {
 	ap136-020)
 		status_led="ap136:green:status"
 		;;
+	kt9661)
+		status_led="kt9661:green:status"
+		;;
+	ap147-010)
+		status_led="ap147:green:status"
+ 		;;
 	ap135-020)
 		status_led="ap135:green:status"
 		;;
@@ -102,6 +108,18 @@ get_status_led() {
 	f9k1115v2)
 		status_led="belkin:blue:status"
 		;;
+	gb-cgw600)
+		status_led="cgw600:green:status"
+		;;
+	gb-cgw800)
+		status_led="cgw800:green:status"
+		;;
+	gb-ta2025ac)
+		status_led="ta2025ac:green:status"
+		;;
+	gb-oa5025)
+		status_led="oa5025:green:status"
+		;;
 	gl-inet)
 		status_led="gl-connect:green:lan"
 		;;
diff -urpN target_orig/linux/ar71xx/base-files/etc/uci-defaults/01_leds target/linux/ar71xx/base-files/etc/uci-defaults/01_leds
--- target_orig/linux/ar71xx/base-files/etc/uci-defaults/01_leds	2016-06-17 15:12:18.444786372 +0800
+++ target/linux/ar71xx/base-files/etc/uci-defaults/01_leds	2016-07-18 09:34:17.009095085 +0800
@@ -31,6 +31,12 @@ all0315n)
 	ucidef_set_led_rssi "rssihigh" "RSSIHIGH" "all0315n:green:rssihigh" "wlan0" "70" "100" "-69" "8"
 	;;
 
+kt9661)
+	ucidef_set_led_netdev "wlan" "WLAN" "kt9661:green:wlan" "ath0" "link tx rx"
+	ucidef_set_led_switch "sysfs" "SYS" "kt9661:green:system" "default-on"
+	ucidef_set_led_netdev "wan" "WAN" "kt9661:green:wan" "eth1" "link tx rx"
+	;;
+
 antminer-s1)
 	ucidef_set_led_default "sys" "SYS" "antminer-s1:green:sys" "0"
 	ucidef_set_led_wlan "wlan" "WLAN" "antminer-s1:green:wlan" "phy0tpt"
@@ -45,10 +51,125 @@ antminer-s3)
 ap113)
 	ucidef_set_led_usbdev "usb" "USB" "ap113:green:usb" "1-1"
 	;;
-
+# added by gukq 20160512 for sihai support
+ap147-010)
+	ucidef_set_led_netdev "wan" "WAN" "ap147:green:wan" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "ap147:green:lan1" "switch0" "0x10"
+	ucidef_set_led_switch "lan2" "LAN2" "ap147:green:lan2" "switch0" "0x08"
+	ucidef_set_led_switch "lan3" "LAN3" "ap147:green:lan3" "switch0" "0x04"
+	ucidef_set_led_switch "lan4" "LAN4" "ap147:green:lan4" "switch0" "0x02"
+	ucidef_set_led_wlan "wlan2g" "WLAN 2.4 GHz" "ap147:green:wlan-2g" "phy0tpt"
+	;;
+# added over
 bsb)
 	ucidef_set_led_default "sys" "SYS" "bsb:red:sys" "1"
 	;;
+# added by gukq
+ap9341fe)
+	ucidef_set_led_default "lan" "LAN" "comfast:green" "1"
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue" "phy0tpt"
+	;;
+
+cf-e316nv2)
+	ucidef_set_led_netdev "wan" "WAN" "comfast:white:wan" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:white:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:white:wifi" "phy0tpt"
+	;;
+
+cf-e325n)
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue" "phy0tpt"
+	;;
+
+kt9671)
+	ucidef_set_led_netdev "wan1" "WAN1" "comfast:green:wan1" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "comfast:green:lan1" "switch0" "0x02"
+	ucidef_set_led_switch "lan2" "LAN2" "comfast:green:lan2" "switch0" "0x04"
+	ucidef_set_led_switch "lan3" "LAN3" "comfast:green:lan3" "switch0" "0x08"
+	ucidef_set_led_switch "lan4" "LAN4" "comfast:green:lan4" "switch0" "0x10"
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	;;
+
+cf-wr600n)
+	ucidef_set_led_netdev "wan1" "WAN1" "cf_wr600n:green:wan1" "eth0"
+	ucidef_set_led_switch "lan1" "LAN1" "cf_wr600n:green:lan1" "switch0" "0x04"
+	ucidef_set_led_switch "lan2" "LAN2" "cf_wr600n:green:lan2" "switch0" "0x08"
+	ucidef_set_led_switch "lan3" "LAN3" "cf_wr600n:green:lan3" "switch0" "0x10"
+#	ucidef_set_led_switch "lan4" "LAN4" "cf_wr600n:green:lan4" "switch0" "0x02"
+#	ucidef_set_led_default "lan" "LAN" "comfast:green" "1"
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red" "eth0"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green" "eth1"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue" "phy0tpt"
+	;;
+
+cf-wr605n)
+	ucidef_set_led_netdev "wan1" "WAN1" "cf_wr605n:green:wan1" "eth0"
+	ucidef_set_led_switch "lan1" "LAN1" "cf_wr605n:green:lan1" "switch0" "0x04"
+	ucidef_set_led_switch "lan2" "LAN2" "cf_wr605n:green:lan2" "switch0" "0x08"
+	ucidef_set_led_switch "lan3" "LAN3" "cf_wr605n:green:lan3" "switch0" "0x10"
+#	ucidef_set_led_switch "lan4" "LAN4" "cf_wr600n:green:lan4" "switch0" "0x02"
+#	ucidef_set_led_default "lan" "LAN" "comfast:green" "1"
+	ucidef_set_led_netdev "wan" "WAN" "cf_wr605n:white:wan" "eth0"
+	ucidef_set_led_netdev "lan" "LAN" "cf_wr605n:white:lan" "eth1"
+	ucidef_set_led_wlan "wlan" "WLAN" "cf_wr605n:white:wifi" "phy0tpt"
+	;;
+
+cf-wr610n)
+	ucidef_set_led_netdev "wan1" "WAN1" "comfast:green:wan1" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "comfast:green:lan1" "switch0" "0x02"
+	ucidef_set_led_switch "lan2" "LAN2" "comfast:green:lan2" "switch0" "0x04"
+	ucidef_set_led_switch "lan3" "LAN3" "comfast:green:lan3" "switch0" "0x08"
+	ucidef_set_led_switch "lan4" "LAN4" "comfast:green:lan4" "switch0" "0x10"
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	;;
+
+cf-wr615n)
+	ucidef_set_led_netdev "wan1" "WAN1" "comfast:green:wan1" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "comfast:green:lan1" "switch0" "0x02"
+	ucidef_set_led_switch "lan2" "LAN2" "comfast:green:lan2" "switch0" "0x04"
+	ucidef_set_led_switch "lan3" "LAN3" "comfast:green:lan3" "switch0" "0x08"
+	ucidef_set_led_switch "lan4" "LAN4" "comfast:green:lan4" "switch0" "0x10"
+#	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+#	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+#	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wifi" "phy0tpt"
+	;;
+
+kt9672)
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	;;
+
+cf-e380ac)
+	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	;;
+
+cf-e520n | \
+cf-e530n)
+	ucidef_set_led_netdev "wan1" "WAN1" "comfast:blue:wan" "eth1"
+	;;
+
+cf-wr650ac)
+#	ucidef_set_led_netdev "wan1" "WAN1" "comfast:green:wan1" "eth1"
+#	ucidef_set_led_switch "lan1" "LAN1" "comfast:green:lan1" "switch0" "0x02"
+#	ucidef_set_led_switch "lan2" "LAN2" "comfast:green:lan2" "switch0" "0x04"
+#	ucidef_set_led_switch "lan3" "LAN3" "comfast:green:lan3" "switch0" "0x08"
+#	ucidef_set_led_switch "lan4" "LAN4" "comfast:green:lan4" "switch0" "0x10"
+#	ucidef_set_led_netdev "wan" "WAN" "comfast:red:wan" "eth1"
+#	ucidef_set_led_netdev "lan" "LAN" "comfast:green:lan" "eth0"
+	ucidef_set_led_wlan "wlan" "WLAN" "comfast:blue:wlan" "phy0tpt"
+	;;
+# added over
 
 bullet-m | \
 nanostation-m | \
@@ -181,6 +302,29 @@ dlan-pro-1200-ac)
 	ucidef_set_led_trigger_gpio "plcr" "dLAN" "devolo:error:dlan" "16" "0"
 	;;
 
+gb-cgw600)
+	ucidef_set_led_netdev "wan" "WAN" "cgw600:green:wan" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "cgw600:green:lan1" "switch0" "0x10"
+	ucidef_set_led_switch "lan2" "LAN2" "cgw600:green:lan2" "switch0" "0x08"
+	ucidef_set_led_switch "lan3" "LAN3" "cgw600:green:lan3" "switch0" "0x04"
+	ucidef_set_led_switch "lan4" "LAN4" "cgw600:green:lan4" "switch0" "0x02"
+	ucidef_set_led_wlan "wlan2g" "WLAN 2.4 GHz" "cgw600:green:wlan" "phy0tpt"
+	;;
+
+gb-cgw800)
+	ucidef_set_led_netdev "wan" "WAN" "cgw800:green:wan" "eth1"
+	ucidef_set_led_switch "lan1" "LAN1" "cgw800:green:lan1" "switch0" "0x10"
+	ucidef_set_led_switch "lan2" "LAN2" "cgw800:green:lan2" "switch0" "0x08"
+	ucidef_set_led_switch "lan3" "LAN3" "cgw800:green:lan3" "switch0" "0x04"
+	ucidef_set_led_switch "lan4" "LAN4" "cgw800:green:lan4" "switch0" "0x02"
+	ucidef_set_led_wlan "wlan2g" "WLAN 2.4 GHz" "cgw800:green:wlan" "phy0tpt"
+	;;
+
+gb-ta2025ac | \
+gb-oa5025)
+	ucidef_set_led_netdev "wlan" "wlan" "$board:green:wlan" "wifi0" "link"
+	;;
+
 gl-inet)
 	ucidef_set_led_netdev "lan" "LAN" "gl-connect:green:lan" "eth1"
 	ucidef_set_led_wlan "wlan" "WLAN" "gl-connect:red:wlan" "phy0tpt"
diff -urpN target_orig/linux/ar71xx/base-files/etc/uci-defaults/02_network target/linux/ar71xx/base-files/etc/uci-defaults/02_network
--- target_orig/linux/ar71xx/base-files/etc/uci-defaults/02_network	2016-06-17 15:12:18.444786372 +0800
+++ target/linux/ar71xx/base-files/etc/uci-defaults/02_network	2016-07-18 09:34:17.013095086 +0800
@@ -23,6 +23,7 @@ ubnt-unifi-outdoor)
 	;;
 
 ap132 |\
+ap152 |\
 wlr8100)
 	ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 	ucidef_add_switch "switch0" "1" "1"
@@ -38,12 +39,170 @@ epg5000)
 	ucidef_add_switch_vlan "switch0" "2" "0t 5"
 	;;
 
-ap136-010)
+ap136-010 |\
+ap147-010)
 	ucidef_set_interfaces_lan_wan "eth0" "eth1"
 	ucidef_add_switch "switch0" "1" "1"
 	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
 	ucidef_add_switch_vlan "switch0" "2" "5 6"
 	;;
+ap9341fe)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4" 
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-e316nv2)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4" 
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac	
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-e325n)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4" 
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	ucidef_set_interface_relayd
+	;;
+
+kt9671 |\
+kt9672)
+        ucidef_set_interface_ap_lan "eth0 eth1"
+        br_mac=$(cat /sys/class/net/eth0/address)
+        [ -n "$br_mac" ] && ucidef_set_interface_macaddr lan $br_mac
+        ;;
+        
+cf-wr600n)
+	ucidef_set_interfaces_lan_wan "eth1" "eth0"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	lan_mac=$(cat /sys/class/net/eth1/address)
+	wlan_mac=$(macaddr_dec "$lan_mac" 1)
+	wan_mac=$(macaddr_dec "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 1)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-wr605n)
+	ucidef_set_interfaces_lan_wan "eth1" "eth0"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	lan_mac=$(cat /sys/class/net/eth1/address)
+	wlan_mac=$(macaddr_dec "$lan_mac" 1)
+	wan_mac=$(macaddr_dec "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 1)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-wr610n)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-wr615n)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-e380ac)
+	ucidef_set_interfaces_lan_wan "eth0" ""
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-e520n | \
+cf-e530n)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
+
+cf-wr650ac)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 2 3 4 5"
+	ucidef_add_switch_vlan "switch0" "2" "1 6"
+	lan_mac=$(cat /sys/class/net/eth0/address)
+	wlan_mac=$(macaddr_add "$lan_mac" 1)
+	wan_mac=$(macaddr_add "$lan_mac" 2)
+	sta_mac=$(macaddr_add "$lan_mac" 3)
+	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr lan $lan_mac
+	[ -n "$wlan_mac" ] && ucidef_set_wireless_macaddr radio0 $wlan_mac
+	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr wan $wan_mac
+	[ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ] && [ -n "$lan_mac" ]&& \
+	ucidef_set_interface_def_macaddr $lan_mac $wan_mac $wlan_mac $sta_mac
+	;;
 
 ap136-020 |\
 ap135-020 |\
@@ -126,6 +285,7 @@ nbg6716)
 	ucidef_add_switch_vlan "switch0" "2" "5 6"
 	;;
 
+ap143 |\
 rb-433 |\
 rb-433u)
 	ucidef_set_interfaces_lan_wan "eth1" "eth0"
@@ -441,6 +601,16 @@ wzr-hp-ag300h)
 	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
 	;;
 
+kt9661)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	wan_mac_addr=`cat /sys/class/net/eth1/address`
+	uci set network.wan.macaddr=$wan_mac_addr
+	lan_mac_addr=`cat /sys/class/net/eth0/address`
+	uci set network.lan.macaddr=$lan_mac_addr
+	;;
+
 wzr-hp-g450h)
 	ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 	ucidef_add_switch "switch0" "1" "1"
@@ -474,8 +644,8 @@ wndr3700)
 	# switch port.
 	#
 	# 0=LED off; 1=Collision/FDX; 2=Link/activity; 3=1000 Mb/s;
-	# 4=100 Mb/s; 5=10 Mb/s; 6=1000 Mb/s+activity; 7=100 Mb/s+activity;
-	# 8=10 Mb/s+activity; 9=10/100 Mb/s+activity; 10: Fiber;
+	# 4=100 Mb/s; 5=10 Mb/s; 6=1000 Mb/sactivity; 7=100 Mb/sactivity;
+	# 8=10 Mb/sactivity; 9=10/100 Mb/sactivity; 10: Fiber;
 	# 11: Fault; 12: Link/activity(tx); 13: Link/activity(rx);
 	# 14: Link (master); 15: separate register
 	uci set network.@switch_port[-1].led='6'
@@ -501,6 +671,28 @@ wndr3700)
 	uci set network.@switch_port[-1].led='2'
 	;;
 
+gb-cgw600)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	ucidef_add_switch_vlan "switch0" "2" "5 6"
+	;;
+
+gb-cgw800)
+	ucidef_set_interfaces_lan_wan "eth0" "eth1"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 4"
+	ucidef_add_switch_vlan "switch0" "2" "5 6"
+	;;
+
+gb-ta2025ac |\
+gb-oa5025)
+	ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
+	ucidef_add_switch "switch0" "1" "1"
+	ucidef_add_switch_vlan "switch0" "1" "0t 2 3 4 5"
+	ucidef_add_switch_vlan "switch0" "2" "0t 1"
+	;;
+
 *)
 	ucidef_set_interfaces_lan_wan "eth0" "eth1"
 	;;
diff -urpN target_orig/linux/ar71xx/base-files/lib/ar71xx.sh target/linux/ar71xx/base-files/lib/ar71xx.sh
--- target_orig/linux/ar71xx/base-files/lib/ar71xx.sh	2016-06-17 15:12:18.448786373 +0800
+++ target/linux/ar71xx/base-files/lib/ar71xx.sh	2016-07-18 09:34:17.013095086 +0800
@@ -5,6 +5,7 @@
 
 AR71XX_BOARD_NAME=
 AR71XX_MODEL=
+AR71XX_BOARD_TYPE=
 
 ar71xx_get_mtd_offset_size_format() {
 	local mtd="$1"
@@ -371,6 +372,19 @@ ar71xx_board_detect() {
 	*"AP135-020 reference board")
 		name="ap135-020"
 		;;
+	*"KUNTENG KT9661")
+		name="kt9661"
+		board_type="kt9661"
+		;;
+	*"AP143 reference board")
+		name="ap143"
+		;;
+	*"AP147-010 reference board")
+		name="ap147-010"
+		;;
+	*"AP152 reference board")
+		name="ap152"
+		;;
 	*AP81)
 		name="ap81"
 		;;
@@ -392,6 +406,47 @@ ar71xx_board_detect() {
 	*CAP4200AG)
 		name="cap4200ag"
 		;;
+	*AP9341FE)
+		name="ap9341fe"
+		;;
+	*CF-E316NV2)
+		name="cf-e316nv2"
+		;;
+	*CF-E325N)
+		name="cf-e325n"
+		;;
+	*"KunTeng KT9671")
+		name="kt9671"
+		board_type="kt9671"
+		;;
+	*CF-WR600N)
+		name="cf-wr600n"
+		;;
+	*CF-WR605N)
+		name="cf-wr605n"
+		;;
+	*"CF-WR610N")
+		name="cf-wr610n"
+		;;
+	*"CF-WR650AC")
+		name="cf-wr650ac"
+		;;
+	*"CF-WR615N")
+		name="cf-wr615n"
+		;;
+	*"KunTeng KT9672")
+		name="kt9672"
+		board_type="kt9672"
+		;;
+	*"CF-E380AC")
+		name="cf-e380ac"
+		;;
+	*"CF-E520N")
+		name="cf-e520n"
+		;;
+	*"CF-E530N")
+		name="cf-e530n"
+		;;
 	*"CPE210/220/510/520")
 		name="cpe510"
 		tplink_pharos_board_detect
@@ -450,6 +505,19 @@ ar71xx_board_detect() {
 	*EL-MINI)
 		name="el-mini"
 		;;
+	*"GBCOM CGW600 board")
+		name="gb-cgw600"
+		board_type="gb-cgw600"
+		;;
+	*"GBCOM CGW800 board")
+		name="gb-cgw800"
+		;;
+	*"GBCOM TA2025AC board")
+		name="gb-ta2025ac"
+		;;
+	*"GBCOM OA5025 board")
+		name="gb-oa5025"
+		;;
 	*"GL-CONNECT INET v1")
 		name="gl-inet"
 		gl_inet_board_detect
@@ -954,9 +1022,12 @@ ar71xx_board_detect() {
 	[ -z "$AR71XX_MODEL" ] && AR71XX_MODEL="$machine"
 
 	[ -e "/tmp/sysinfo/" ] || mkdir -p "/tmp/sysinfo/"
+	
+	AR71XX_BOARD_TYPE=$board_type
 
 	echo "$AR71XX_BOARD_NAME" > /tmp/sysinfo/board_name
 	echo "$AR71XX_MODEL" > /tmp/sysinfo/model
+	echo "$AR71XX_BOARD_TYPE" > /tmp/sysinfo/board_type
 }
 
 ar71xx_board_name() {
diff -urpN target_orig/linux/ar71xx/base-files/lib/preinit/81_load_ath10k_board_bin target/linux/ar71xx/base-files/lib/preinit/81_load_ath10k_board_bin
--- target_orig/linux/ar71xx/base-files/lib/preinit/81_load_ath10k_board_bin	2016-06-17 15:12:18.448786373 +0800
+++ target/linux/ar71xx/base-files/lib/preinit/81_load_ath10k_board_bin	2016-07-18 09:34:17.013095086 +0800
@@ -5,12 +5,22 @@
 
 do_load_ath10k_board_bin() {
 	# load board.bin
+	local dir="/lib/firmware/ath10k/QCA988X/hw2.0"
+	mkdir -p ${dir}
 	case $(ar71xx_board_name) in
 		nbg6716)
 			dd if=/dev/mtdblock2 \
 				bs=1 skip=20480 count=2116 \
 				of=/tmp/ath10k-board.bin
 		;;
+		kt9672 | \
+		gb-cgw600 | \
+		gb-cgw800)
+			local mtdblock=$(find_mtd_part art)
+			echo "mtd:$mtdblock" > /root/mtdblack.tmp
+	                dd if=${mtdblock} of=/tmp/ath10k-board.bin \
+	                        bs=1 skip=20480 count=2116
+	        ;;
 		archer-c5 | \
 		archer-c7)
 			local mac
diff -urpN target_orig/linux/ar71xx/base-files/lib/upgrade/platform.sh target/linux/ar71xx/base-files/lib/upgrade/platform.sh
--- target_orig/linux/ar71xx/base-files/lib/upgrade/platform.sh	2016-06-17 15:12:18.448786373 +0800
+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh	2016-07-18 09:34:17.013095086 +0800
@@ -179,6 +179,8 @@ platform_check_image() {
 	ap136-010 | \
 	ap136-020 | \
 	ap135-020 | \
+	ap147-010 | \
+	ap152 | \
 	ap96 | \
 	bxu2000n-2-a1 | \
 	db120 | \
@@ -195,6 +197,13 @@ platform_check_image() {
 		}
 		return 0
 		;;
+	kt9661)
+		[ "$magic_long" != "27051956" ] && {
+			echo "Invalid image type."
+			return 1
+		}
+		return 0
+		;;
 	ap81 | \
 	ap83 | \
 	ap132 | \
@@ -216,6 +225,10 @@ platform_check_image() {
 	esr900 | \
 	ew-dorin | \
 	ew-dorin-router | \
+	gb-cgw600	| \
+	gb-cgw800	| \
+	gb-ta2025ac	| \
+	gb-oa5025	| \
 	hiwifi-hc6361 | \
 	hornet-ub-x2 | \
 	mzk-w04nu | \
@@ -389,7 +402,11 @@ platform_check_image() {
 		alfa_check_image "$1" && return 0
 		return 1
 		;;
-
+	ap9341fe | \
+	cf-e316nv2 | \
+	cf-e325n | \
+	cf-wr600n | \
+	cf-wr605n | \
 	unifi-outdoor-plus | \
 	uap-pro)
 		[ "$magic_long" != "19852003" ] && {
@@ -398,6 +415,28 @@ platform_check_image() {
 		}
 		return 0
 		;;
+		
+	kt9671)
+		[ "$magic_long" != "27051956" ] && {
+			echo "Invalid image type."
+			return 1
+		}
+		return 0
+		;;
+		
+	kt9672 | \
+	cf-e380ac | \
+	cf-e520n | \
+	cf-e530n | \
+	cf-wr610n | \
+	cf-wr615n | \
+	cf-wr650ac)
+		[ "$magic_long" != "27051956" ] && {
+			echo "Invalid image type."
+			return 1
+		}
+		return 0
+		;;
 	wndr3700 | \
 	wnr2000-v3 | \
 	wnr612-v2 | \
@@ -447,13 +486,20 @@ platform_check_image() {
 		fi
 		return 0
 		;;
-    wnr2000-v4)
+	wnr2000-v4)
 		[ "$magic_long" != "32303034" ] && {
 			echo "Invalid image type."
 			return 1
 		}
 		return 0
 		;;
+	wnr2200)
+                [ "$magic_long" != "32323030" ] && {
+                        echo "Invalid image type."
+                        return 1
+                }
+                return 0
+                ;;
 
 	esac
 
@@ -521,6 +567,19 @@ platform_do_upgrade() {
 	om5p-an)
 		platform_do_upgrade_openmesh "$ARGV"
 		;;
+	ap9341fe | \
+	cf-e316nv2 | \
+	cf-e325n | \
+	kt9671 | \
+	kt9672 | \
+	cf-e380ac | \
+	cf-wr600n | \
+	cf-wr605n | \
+	cf-wr610n | \
+	cf-wr615n | \
+	cf-e520n | \
+	cf-e530n | \
+	cf-wr650ac | \
 	unifi-outdoor-plus | \
 	uap-pro)
 		MTD_CONFIG_ARGS="-s 0x180000"
diff -urpN target_orig/linux/ar71xx/config-3.18 target/linux/ar71xx/config-3.18
--- target_orig/linux/ar71xx/config-3.18	2016-06-17 15:12:18.448786373 +0800
+++ target/linux/ar71xx/config-3.18	2016-07-18 09:34:16.985095079 +0800
@@ -35,6 +35,9 @@ CONFIG_ATH79_MACH_AP113=y
 CONFIG_ATH79_MACH_AP121=y
 CONFIG_ATH79_MACH_AP132=y
 CONFIG_ATH79_MACH_AP136=y
+CONFIG_ATH79_MACH_AP143=y
+CONFIG_ATH79_MACH_AP147=y
+CONFIG_ATH79_MACH_AP152=y
 CONFIG_ATH79_MACH_AP81=y
 CONFIG_ATH79_MACH_AP83=y
 CONFIG_ATH79_MACH_AP96=y
@@ -47,6 +50,11 @@ CONFIG_ATH79_MACH_BSB=y
 CONFIG_ATH79_MACH_CAP4200AG=y
 CONFIG_ATH79_MACH_CARAMBOLA2=y
 CONFIG_ATH79_MACH_CPE510=y
+CONFIG_ATH79_MACH_COMFAST=y
+CONFIG_ATH79_MACH_KUNTENG_KT9671=y
+CONFIG_ATH79_MACH_KUNTENG_KT9672=y
+CONFIG_ATH79_MACH_COMFAST_CF_E380AC=y
+CONFIG_ATH79_MACH_COMFAST_CF_WR650AC=y
 CONFIG_ATH79_MACH_DB120=y
 CONFIG_ATH79_MACH_DGL_5500_A1=y
 CONFIG_ATH79_MACH_DHP_1565_A1=y
@@ -68,6 +76,10 @@ CONFIG_ATH79_MACH_ESR1750=y
 CONFIG_ATH79_MACH_ESR900=y
 CONFIG_ATH79_MACH_EW_DORIN=y
 CONFIG_ATH79_MACH_F9K1115V2=y
+CONFIG_ATH79_MACH_GB_CGW600=y
+CONFIG_ATH79_MACH_GB_CGW800=y
+CONFIG_ATH79_MACH_GB_OA5025=y
+CONFIG_ATH79_MACH_GB_TA2025AC=y
 CONFIG_ATH79_MACH_GL_INET=y
 CONFIG_ATH79_MACH_GS_MINIBOX_V1=y
 CONFIG_ATH79_MACH_GS_OOLITE=y
@@ -75,6 +87,7 @@ CONFIG_ATH79_MACH_HIWIFI_HC6361=y
 CONFIG_ATH79_MACH_HORNET_UB=y
 CONFIG_ATH79_MACH_JA76PF=y
 CONFIG_ATH79_MACH_JWAP003=y
+CONFIG_ATH79_MACH_KT9661=y
 CONFIG_ATH79_MACH_MC_MAC1200R=y
 CONFIG_ATH79_MACH_MR16=y
 CONFIG_ATH79_MACH_MR12=y
@@ -95,6 +108,7 @@ CONFIG_ATH79_MACH_PB44=y
 CONFIG_ATH79_MACH_PB92=y
 CONFIG_ATH79_MACH_QIHOO_C301=y
 CONFIG_ATH79_MACH_R6100=y
+CONFIG_ATH79_MACH_KT9661=y
 # CONFIG_ATH79_MACH_RB2011 is not set
 # CONFIG_ATH79_MACH_RB4XX is not set
 # CONFIG_ATH79_MACH_RB750 is not set
@@ -335,3 +349,4 @@ CONFIG_SYS_SUPPORTS_MIPS16=y
 CONFIG_TICK_CPU_ACCOUNTING=y
 CONFIG_USB_SUPPORT=y
 CONFIG_ZONE_DMA_FLAG=0
+CONFIG_ATH79_MACH_COMFAST_CF_E355AC=y
\ 文件尾没有 newline 字符
diff -urpN target_orig/linux/ar71xx/files/arch/mips/ath79/mach-comfast.c target/linux/ar71xx/files/arch/mips/ath79/mach-comfast.c
--- target_orig/linux/ar71xx/files/arch/mips/ath79/mach-comfast.c	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-comfast.c	2016-07-18 09:34:16.985095079 +0800
@@ -0,0 +1,1532 @@
+/* 
+ gukq modified @20160527 renamed CF-E350N to KT9671
+ gukq modified @20160627 renamed CF-E355AC to KT9672
+*/
+
+#include <linux/init.h>
+#include <linux/pci.h>
+#include <linux/platform_device.h>
+#include <linux/ath9k_platform.h>
+#include <linux/etherdevice.h>
+#include <linux/ar8216_platform.h>
+#include <linux/platform_data/phy-at803x.h>
+
+#include <asm/mach-ath79/irq.h>
+#include <asm/mach-ath79/ath79.h>
+#include <asm/mach-ath79/ar71xx_regs.h>
+
+#include "common.h"
+#include "dev-ap9x-pci.h"
+#include "dev-eth.h"
+#include "dev-gpio-buttons.h"
+#include "dev-leds-gpio.h"
+#include "dev-m25p80.h"
+#include "dev-usb.h"
+#include "dev-wmac.h"
+#include "dev-nfc.h"
+#include "gpio.h"
+#include "machtypes.h"
+#include "pci.h"
+
+
+// For HS-UART
+static struct resource ar934x_hs_uart_resources[] = {
+	{
+		.start	= (AR71XX_APB_BASE + 0x00500000),
+		.end	= (AR71XX_APB_BASE + 0x00500000) + 0x100 - 1,
+		.flags	= IORESOURCE_MEM,
+	},
+	{
+		.start	= ATH79_MISC_IRQ(6),
+		.end	= ATH79_MISC_IRQ(6),
+		.flags	= IORESOURCE_IRQ,
+	},
+};
+
+static struct platform_device ar934x_hs_uart_device = {
+	.name		= "atheros_hs_uart",
+	.id			= 0,
+	.resource	= ar934x_hs_uart_resources,
+	.num_resources	= ARRAY_SIZE(ar934x_hs_uart_resources),
+	.dev = {
+		.platform_data	= NULL,
+	},
+};
+
+extern void __iomem *ath79_gpio_base;
+static void ath79_hs_uart_setup(int rx_gpio, int tx_gpio)
+{
+	// UART1 Out of Reset
+	ath79_reset_wr(AR934X_RESET_REG_RESET_MODULE,
+			ath79_reset_rr(AR934X_RESET_REG_RESET_MODULE) & ~MISC_INT_UART);
+	// Set UART to operate on 100 MHz
+	ath79_pll_wr(AR934X_PLL_SWITCH_CLOCK_CONTROL_REG,
+			ath79_pll_rr(AR934X_PLL_SWITCH_CLOCK_CONTROL_REG) | BIT(7));
+
+	__raw_writel(__raw_readl(ath79_gpio_base + AR71XX_GPIO_REG_OE)| (1 << rx_gpio),
+                     ath79_gpio_base + AR71XX_GPIO_REG_OE);
+
+	__raw_writel((rx_gpio) << 16, ath79_gpio_base + 0x68);
+	ath79_gpio_output_select(tx_gpio, 79);
+
+	platform_device_register(&ar934x_hs_uart_device);
+}
+// End of HS-UART
+
+
+// AP9341FE
+#define AP9341FE_GPIO_HSUART_RX			12
+#define	AP9341FE_GPIO_HSUART_TX			21
+#define	AP9341FE_GPIO_HSUART_SEL		11
+#define	AP9341FE_GPIO_BEACON_RST0		18
+#define	AP9341FE_GPIO_BEACON_RST1		19
+
+#define COMFAST_KEYS_POLL_INTERVAL	20
+#define COMFAST_KEYS_DEBOUNCE_INTERVAL	(3 * COMFAST_KEYS_POLL_INTERVAL)
+
+#define	AP9341FE_GPIO_XWDT_TRIGGER	16
+
+#define	XWDT_AUTOFEED_DURATION		(HZ / 3)
+static int gpio_external_wdt = -1;
+static int wdt_timeout = -1, wdt_autofeed_count = 0;
+
+static void watchdog_fire(unsigned long);
+static struct timer_list watchdog_ticktock = TIMER_INITIALIZER(watchdog_fire, 0, 0);
+static void external_wdt_toggle(void);
+
+static void enable_external_wdt(int gpio)
+{
+	gpio_external_wdt = gpio;
+	
+	external_wdt_toggle();
+	
+	wdt_timeout = -1;
+	mod_timer(&watchdog_ticktock, jiffies + XWDT_AUTOFEED_DURATION);
+}
+
+static void external_wdt_toggle(void)
+{
+	static u32 data;
+	data ++;
+	gpio_set_value(gpio_external_wdt, data & 0x01);
+}
+
+void ath79_external_wdt_disable(void)
+{
+	if(gpio_external_wdt >= 0) {
+		wdt_timeout = -1;
+		mod_timer(&watchdog_ticktock, jiffies + XWDT_AUTOFEED_DURATION);
+	}
+}
+EXPORT_SYMBOL(ath79_external_wdt_disable);
+
+void ath79_external_wdt_trigger(void)
+{
+	if(gpio_external_wdt >= 0) {
+		//printk(KERN_ERR "XWDT TRIGGER\n");
+		wdt_autofeed_count = 0;
+		mod_timer(&watchdog_ticktock, jiffies + XWDT_AUTOFEED_DURATION);
+	}
+}
+EXPORT_SYMBOL(ath79_external_wdt_trigger);
+
+void ath79_external_wdt_set_timeout(int timeout)
+{
+	if(gpio_external_wdt >= 0) {
+		wdt_timeout = timeout;
+		external_wdt_toggle();
+		//printk(KERN_ERR "XWDT SET TIMEOUT: %d\n", timeout);
+	}
+}
+EXPORT_SYMBOL(ath79_external_wdt_set_timeout);
+
+static void watchdog_fire(unsigned long data)
+{
+	if(wdt_timeout > 0) 
+		wdt_autofeed_count++;
+	
+	if((wdt_timeout < 0) || (wdt_autofeed_count < wdt_timeout)) {
+		//printk(KERN_ERR "XWDT AUTOFEED: %d\n", wdt_autofeed_count);
+		external_wdt_toggle();
+		mod_timer(&watchdog_ticktock, jiffies + XWDT_AUTOFEED_DURATION);
+	}
+}
+
+static struct gpio_keys_button comfast_ap934x_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 20,
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_ap934x_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:red",
+		.gpio		= 2,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}, {
+		.name		= "comfast:blue",
+		.gpio		= 0,
+	}
+};
+
+static void ext_lna_control_gpio_setup(int gpio_rx0, int gpio_rx1)
+{
+	ath79_gpio_output_select(gpio_rx0, AR934X_GPIO_OUT_EXT_LNA0);
+	ath79_gpio_output_select(gpio_rx1, AR934X_GPIO_OUT_EXT_LNA1);
+}
+
+
+static void __init comfast_ap9341fe_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+	ath79_gpio_output_select(AP9341FE_GPIO_XWDT_TRIGGER, 0);
+	enable_external_wdt(AP9341FE_GPIO_XWDT_TRIGGER);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_ap934x_gpio_leds),
+				 comfast_ap934x_gpio_leds);
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_ap934x_gpio_keys),
+                                        comfast_ap934x_gpio_keys);
+					
+	ext_lna_control_gpio_setup(13, 14);
+
+	ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
+
+	ath79_register_mdio(1, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 2);
+
+	/* GMAC0 is connected to the PHY0 of the internal switch */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_switch_data.phy_poll_mask = BIT(0);
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_eth0_data.phy_mask = BIT(0);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio1_device.dev;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the internal switch */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;	
+	
+	ath79_register_eth(1);
+	
+	ath79_register_usb();
+
+	ath79_register_wmac(art, NULL);
+}
+MIPS_MACHINE(ATH79_MACH_COMFAST_AP9341FE, "COMFAST-AP9341FE", "COMFAST AP9341FE", comfast_ap9341fe_setup);
+
+#define CF_WR600N_GPIO_LED_LAN1	22
+#define CF_WR600N_GPIO_LED_LAN2	11
+#define CF_WR600N_GPIO_LED_LAN3	19
+#define CF_WR600N_GPIO_LED_WAN1	18
+
+#define	CF_WR600N_GPIO_XWDT_TRIGGER	20
+
+static struct gpio_keys_button comfast_cf_wr600n_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 16,	
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_cf_wr600n_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:red",
+		.gpio		= 2,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}, {
+		.name		= "comfast:blue",
+		.gpio		= 0,
+	}, {
+		.name		= "cf_wr600n:green:lan1",
+		.gpio		= CF_WR600N_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr600n:green:lan2",
+		.gpio		= CF_WR600N_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr600n:green:lan3",
+		.gpio		= CF_WR600N_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr600n:green:wan1",
+		.gpio		= CF_WR600N_GPIO_LED_WAN1,
+		.active_low	= 1,
+	},
+};
+
+static void __init comfast_cf_wr600n_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+//	ath79_gpio_output_select(CF_WR600N_GPIO_XWDT_TRIGGER, 0);
+//	enable_external_wdt(CF_WR600N_GPIO_XWDT_TRIGGER);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_gpio_output_select(CF_WR600N_GPIO_LED_LAN2, 0);
+	
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_cf_wr600n_gpio_leds),
+				 comfast_cf_wr600n_gpio_leds);
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_cf_wr600n_gpio_keys),
+                                        comfast_cf_wr600n_gpio_keys);
+					
+	ext_lna_control_gpio_setup(13, 14);
+	
+	ath79_register_mdio(1, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 2);
+
+	/* GMAC0 is connected to the PHY0 of the internal switch */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_switch_data.phy_poll_mask = BIT(4);
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_eth0_data.phy_mask = BIT(4);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio1_device.dev;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the internal switch */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;	
+	
+	ath79_register_eth(1);
+	
+	ath79_register_usb();
+
+	ath79_register_wmac(art, NULL);
+} 
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_WR600N, "COMFAST-CF-WR600N", "COMFAST CF-WR600N", comfast_cf_wr600n_setup);
+
+#define CF_WR605N_GPIO_LED_LAN1	22
+#define CF_WR605N_GPIO_LED_LAN2	11
+#define CF_WR605N_GPIO_LED_LAN3	19
+#define CF_WR605N_GPIO_LED_WAN1	18
+
+#define CF_WR605N_GPIO_LED_WAN_EXT	15
+#define CF_WR605N_GPIO_LED_LAN_EXT	17
+#define CF_WR605N_GPIO_LED_WIFI_EXT	20
+
+#define	CF_WR605N_GPIO_XWDT_TRIGGER	20
+
+static struct gpio_keys_button comfast_cf_wr605n_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 16,	
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_cf_wr605n_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:red",
+		.gpio		= 2,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}, {
+		.name		= "comfast:blue",
+		.gpio		= 0,
+	}, {
+		.name		= "cf_wr605n:green:lan1",
+		.gpio		= CF_WR605N_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:green:lan2",
+		.gpio		= CF_WR605N_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:green:lan3",
+		.gpio		= CF_WR605N_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:green:wan1",
+		.gpio		= CF_WR605N_GPIO_LED_WAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:white:wan",
+		.gpio		= CF_WR605N_GPIO_LED_WAN_EXT,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:white:lan",
+		.gpio		= CF_WR605N_GPIO_LED_LAN_EXT,
+		.active_low	= 1,
+	}, {
+		.name		= "cf_wr605n:white:wifi",
+		.gpio		= CF_WR605N_GPIO_LED_WIFI_EXT,
+		.active_low	= 1,
+	},
+};
+
+
+static void __init comfast_cf_wr605n_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+//	ath79_gpio_output_select(CF_WR605N_GPIO_XWDT_TRIGGER, 0);
+//	enable_external_wdt(CF_WR605N_GPIO_XWDT_TRIGGER);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_gpio_output_select(CF_WR605N_GPIO_LED_LAN2, 0);
+	
+	ath79_gpio_output_select(CF_WR605N_GPIO_LED_WAN_EXT, 0);
+	ath79_gpio_output_select(CF_WR605N_GPIO_LED_LAN_EXT, 0);
+	ath79_gpio_output_select(CF_WR605N_GPIO_LED_WIFI_EXT, 0);
+	
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_cf_wr605n_gpio_leds),
+				 comfast_cf_wr605n_gpio_leds);
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_cf_wr605n_gpio_keys),
+                                        comfast_cf_wr605n_gpio_keys);
+					
+	ext_lna_control_gpio_setup(13, 14);
+	
+	ath79_register_mdio(1, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 2);
+
+	/* GMAC0 is connected to the PHY0 of the internal switch */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_switch_data.phy_poll_mask = BIT(4);
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_eth0_data.phy_mask = BIT(4);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio1_device.dev;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the internal switch */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;	
+	
+	ath79_register_eth(1);
+	
+	ath79_register_usb();
+
+	ath79_register_wmac(art, NULL);
+} 
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_WR605N, "COMFAST-CF-WR605N", "COMFAST CF-WR605N", comfast_cf_wr605n_setup);
+
+#define	CF_E316NV2_GPIO_XWDT_TRIGGER	16
+
+static struct gpio_keys_button comfast_cf_e316nv2_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 20,
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_cf_e316nv2_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:white:wifi",
+		.gpio		= 12,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:white:lan",
+		.gpio		= 19,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:white:wan",
+		.gpio		= 17,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}
+};
+
+static void __init comfast_cf_e316nv2_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+	ath79_gpio_output_select(CF_E316NV2_GPIO_XWDT_TRIGGER, 0);
+	enable_external_wdt(CF_E316NV2_GPIO_XWDT_TRIGGER);
+
+	ath79_register_m25p80(NULL);
+	
+	ath79_gpio_output_select(12, 0);
+	ath79_gpio_output_select(17, 0);
+	ath79_gpio_output_select(19, 0);
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_cf_e316nv2_gpio_leds),
+				 comfast_cf_e316nv2_gpio_leds);
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_cf_e316nv2_gpio_keys),
+                                        comfast_cf_e316nv2_gpio_keys);
+					
+	ext_lna_control_gpio_setup(13, 14);
+
+	ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
+
+	ath79_register_mdio(1, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 2);
+
+	/* GMAC0 is connected to the PHY0 of the internal switch */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_switch_data.phy_poll_mask = BIT(0);
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_eth0_data.phy_mask = BIT(0);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio1_device.dev;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the internal switch */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;	
+	
+	ath79_register_eth(1);
+	
+	ath79_register_usb();
+
+	ath79_register_wmac(art, NULL);
+}
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_E316NV2, "COMFAST-CF-E316NV2", "COMFAST CF-E316NV2", comfast_cf_e316nv2_setup);
+
+#define	CF_E325N_GPIO_XWDT_TRIGGER	16
+
+static struct gpio_keys_button comfast_cf_e325n_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 20,
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_cf_e325n_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:red",
+		.gpio		= 2,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}, {
+		.name		= "comfast:blue",
+		.gpio		= 0,
+	}, {
+		.name		= "comfast:brst0",
+		.gpio		= AP9341FE_GPIO_BEACON_RST0,
+		.active_low     = 1,	
+	}, {
+		.name		= "comfast:brst1",
+		.gpio		= AP9341FE_GPIO_BEACON_RST1,
+		.active_low     = 1,
+	}, {
+		.name		= "comfast:bsel",
+		.gpio		= AP9341FE_GPIO_HSUART_SEL,
+	},
+};
+
+static void __init comfast_cf_e325n_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+	ath79_gpio_output_select(CF_E325N_GPIO_XWDT_TRIGGER, 0);
+	enable_external_wdt(CF_E325N_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(AP9341FE_GPIO_HSUART_SEL, 0);
+	ath79_gpio_output_select(AP9341FE_GPIO_BEACON_RST0, 0);
+	ath79_gpio_output_select(AP9341FE_GPIO_BEACON_RST1, 0);
+	
+	ath79_hs_uart_setup(AP9341FE_GPIO_HSUART_RX, AP9341FE_GPIO_HSUART_TX);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_cf_e325n_gpio_leds),
+				 comfast_cf_e325n_gpio_leds);
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_cf_e325n_gpio_keys),
+                                        comfast_cf_e325n_gpio_keys);
+					
+	ext_lna_control_gpio_setup(13, 14);
+
+	ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
+
+	ath79_register_mdio(1, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 2);
+
+	/* GMAC0 is connected to the PHY0 of the internal switch */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_switch_data.phy_poll_mask = BIT(0);
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_eth0_data.phy_mask = BIT(0);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio1_device.dev;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the internal switch */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;	
+	
+	ath79_register_eth(1);
+	
+	ath79_register_usb();
+
+	ath79_register_wmac(art, NULL);
+}
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_E325N, "COMFAST-CF-E325N", "COMFAST CF-E325N", comfast_cf_e325n_setup);
+
+#define CF_WR610N_GPIO_BTN_RESET	17
+
+#define CF_WR610N_KEYS_POLL_INTERVAL	20	/* msecs */
+#define CF_WR610N_KEYS_DEBOUNCE_INTERVAL (3 * CF_WR610N_KEYS_POLL_INTERVAL)
+
+#define	CF_WR610N_GPIO_XWDT_TRIGGER	13
+
+#define CF_WR610N_GPIO_LED_WAN		2
+#define CF_WR610N_GPIO_LED_LAN		3
+#define CF_WR610N_GPIO_LED_WLAN		0
+
+#define CF_WR610N_GPIO_LED_WAN1		4
+#define CF_WR610N_GPIO_LED_LAN1		16
+#define CF_WR610N_GPIO_LED_LAN2		15
+#define CF_WR610N_GPIO_LED_LAN3		14
+#define CF_WR610N_GPIO_LED_LAN4		11
+
+
+static struct gpio_led cf_wr610n_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:red:wan",
+		.gpio		= CF_WR610N_GPIO_LED_WAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:lan",
+		.gpio		= CF_WR610N_GPIO_LED_LAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:blue:wlan",
+		.gpio		= CF_WR610N_GPIO_LED_WLAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:wan1",
+		.gpio		= CF_WR610N_GPIO_LED_WAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan1",
+		.gpio		= CF_WR610N_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan2",
+		.gpio		= CF_WR610N_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan3",
+		.gpio		= CF_WR610N_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan4",
+		.gpio		= CF_WR610N_GPIO_LED_LAN4,
+		.active_low	= 1,
+	}, 
+};
+
+static struct gpio_keys_button cf_wr610n_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = CF_WR610N_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= CF_WR610N_GPIO_BTN_RESET,
+		.active_low	= 1,
+	}
+};
+
+static void __init comfast_ap143_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);	
+	
+	ath79_gpio_output_select(CF_WR610N_GPIO_XWDT_TRIGGER, 0);	
+	enable_external_wdt(CF_WR610N_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_WAN, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_LAN, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_WLAN, 0);	
+
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_WAN1, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_LAN1, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_LAN2, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_LAN3, 0);
+	ath79_gpio_output_select(CF_WR610N_GPIO_LED_LAN4, 0);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+	
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 2);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
+
+	// wan
+	ath79_register_eth(1);
+
+	// lan
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_register_eth(0);	
+
+	ath79_register_wmac(art, NULL);
+	
+	ap91_pci_init(art + 0x5000, NULL);
+}
+
+static void __init cf_wr610n_setup(void)
+{
+	comfast_ap143_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_wr610n_leds_gpio),
+				 cf_wr610n_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, CF_WR610N_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_wr610n_gpio_keys),
+					cf_wr610n_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_WR610N, "COMFAST-CF-WR610N", "COMFAST CF-WR610N",
+	     cf_wr610n_setup);
+     
+#define CF_WR615N_GPIO_BTN_RESET	17
+
+#define CF_WR615N_KEYS_POLL_INTERVAL	20	/* msecs */
+#define CF_WR615N_KEYS_DEBOUNCE_INTERVAL (3 * CF_WR615N_KEYS_POLL_INTERVAL)
+
+#define	CF_WR615N_GPIO_XWDT_TRIGGER	13
+
+#define CF_WR615N_GPIO_LED_WAN		2
+#define CF_WR615N_GPIO_LED_LAN		3
+#define CF_WR615N_GPIO_LED_WLAN		0
+
+#define CF_WR615N_GPIO_LED_USR		1
+#define CF_WR615N_GPIO_LED_WIFI		12
+
+#define CF_WR615N_GPIO_LED_WAN1		4
+#define CF_WR615N_GPIO_LED_LAN1		16
+#define CF_WR615N_GPIO_LED_LAN2		15
+#define CF_WR615N_GPIO_LED_LAN3		14
+#define CF_WR615N_GPIO_LED_LAN4		11
+
+static struct gpio_led cf_wr615n_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:red:wan",
+		.gpio		= CF_WR615N_GPIO_LED_WAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:lan",
+		.gpio		= CF_WR615N_GPIO_LED_LAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:blue:wlan",
+		.gpio		= CF_WR615N_GPIO_LED_WLAN,
+		.active_low	= 0,
+	},
+	{
+		.name		= "comfast:green:wan1",
+		.gpio		= CF_WR615N_GPIO_LED_WAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan1",
+		.gpio		= CF_WR615N_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan2",
+		.gpio		= CF_WR615N_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan3",
+		.gpio		= CF_WR615N_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan4",
+		.gpio		= CF_WR615N_GPIO_LED_LAN4,
+		.active_low	= 1,
+	},{
+		.name		= "comfast:blue:wifi",
+		.gpio		= CF_WR615N_GPIO_LED_WIFI,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:blue:usr",
+		.gpio		= CF_WR615N_GPIO_LED_USR,
+		.active_low	= 1,
+	},
+};
+
+static struct gpio_keys_button cf_wr615n_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = CF_WR615N_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= CF_WR615N_GPIO_BTN_RESET,
+		.active_low	= 1,
+	}
+};
+
+static void __init comfast_wr615n_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+	
+	ath79_gpio_output_select(CF_WR615N_GPIO_XWDT_TRIGGER, 0);
+	enable_external_wdt(CF_WR615N_GPIO_XWDT_TRIGGER);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);	
+	
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_WAN, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_LAN, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_WLAN, 0);	
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_WIFI, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_USR, 0);
+
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_WAN1, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_LAN1, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_LAN2, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_LAN3, 0);
+	ath79_gpio_output_select(CF_WR615N_GPIO_LED_LAN4, 0);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 2);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
+
+	// wan
+	ath79_register_eth(1);
+
+	// lan
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_register_eth(0);
+	
+	ath79_register_wmac(art, NULL);	
+}
+
+static void __init cf_wr615n_setup(void)
+{
+	comfast_wr615n_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_wr615n_leds_gpio),
+				 cf_wr615n_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, CF_WR615N_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_wr615n_gpio_keys),
+					cf_wr615n_gpio_keys);
+}
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_WR615N, "COMFAST-CF-WR615N", "COMFAST CF-WR615N",
+	     cf_wr615n_setup);
+     
+#define CF_E520N_GPIO_BTN_RESET	17
+
+#define CF_E520N_KEYS_POLL_INTERVAL	20	/* msecs */
+#define CF_E520N_KEYS_DEBOUNCE_INTERVAL (3 * CF_E520N_KEYS_POLL_INTERVAL)
+
+#define CF_E520N_GPIO_LED_WAN		11
+
+static struct gpio_led cf_e520n_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:blue:wan",
+		.gpio		= CF_E520N_GPIO_LED_WAN,
+		.active_low	= 0,
+	}
+};
+
+static struct gpio_keys_button cf_e520n_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = CF_E520N_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= CF_E520N_GPIO_BTN_RESET,
+		.active_low	= 1,
+	}
+};
+
+static void __init comfast_e520n_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);	
+	
+	ath79_gpio_output_select(CF_E520N_GPIO_LED_WAN, 0);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 2);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
+
+	// wan
+	ath79_register_eth(1);
+
+	// lan
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_register_eth(0);
+	
+	ath79_register_wmac(art, NULL);	
+}
+
+static void __init cf_e520n_e530n_setup(void)
+{
+	comfast_e520n_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_e520n_leds_gpio),
+				 cf_e520n_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, CF_E520N_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_e520n_gpio_keys),
+					cf_e520n_gpio_keys);
+}
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_E520N, "COMFAST-CF-E520N", "COMFAST CF-E520N",
+	     cf_e520n_e530n_setup);
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_E530N, "COMFAST-CF-E530N", "COMFAST CF-E530N",
+	     cf_e520n_e530n_setup);	     
+	     
+     
+#define CF_WR650AC_KEYS_POLL_INTERVAL	20	/* msecs */
+#define CF_WR650AC_KEYS_DEBOUNCE_INTERVAL (3 * CF_WR650AC_KEYS_POLL_INTERVAL)
+
+#define	CF_WR650AC_GPIO_XWDT_TRIGGER	17
+
+#define CF_WR650AC_GPIO_BTN_RESET_WPS	19
+
+#define CF_WR650AC_GPIO_LED_NETWORK	4
+#define CF_WR650AC_GPIO_LED_24G		13
+#define CF_WR650AC_GPIO_LED_58G		2
+#define CF_WR650AC_GPIO_LED_WPS		20
+
+#define CF_WR650AC_WMAC_CALDATA_OFFSET		0x1000
+#define CF_WR650AC_PCIE_CALDATA_OFFSET		0x5000
+
+#define CF_WR650AC_LAN_PHYMASK              BIT(0)
+#define CF_WR650AC_WAN_PHYMASK              BIT(5)
+#define CF_WR650AC_MDIO_MASK                (~(CF_WR650AC_LAN_PHYMASK | CF_WR650AC_WAN_PHYMASK))
+
+static struct gpio_led cf_wr650ac_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:blue:network",
+		.gpio		= CF_WR650AC_GPIO_LED_NETWORK,
+		.active_low	= 1,
+	},
+	{
+		.name		= "comfast:blue:24g",
+		.gpio		= CF_WR650AC_GPIO_LED_24G,
+		.active_low	= 1,
+	},
+	{
+		.name		= "comfast:blue:58g",
+		.gpio		= CF_WR650AC_GPIO_LED_58G,
+		.active_low	= 1,
+	},
+	{
+		.name		= "comfast:blue:wps",
+		.gpio		= CF_WR650AC_GPIO_LED_WPS,
+		.active_low	= 1,
+	},
+};
+
+static struct gpio_keys_button cf_wr650ac_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button/WPS button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = CF_WR650AC_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= CF_WR650AC_GPIO_BTN_RESET_WPS,
+		.active_low	= 1,
+	},
+};
+
+static struct ar8327_pad_cfg cf_wr650ac_ar8327_pad0_cfg = {
+	/* GMAC0 of the AR8337 switch is connected to GMAC0 via RGMII */
+	.mode = AR8327_PAD_MAC_RGMII,
+	.txclk_delay_en = true,
+	.rxclk_delay_en = true,
+	.txclk_delay_sel = AR8327_CLK_DELAY_SEL1,
+	.rxclk_delay_sel = AR8327_CLK_DELAY_SEL2,
+};
+
+static struct ar8327_pad_cfg cf_wr650ac_ar8327_pad6_cfg = {
+	/* GMAC6 of the AR8337 switch is connected to GMAC1 via SGMII */
+	.mode = AR8327_PAD_MAC_SGMII,
+	.rxclk_delay_en = true,
+	.rxclk_delay_sel = AR8327_CLK_DELAY_SEL0,
+};
+
+static struct ar8327_platform_data cf_wr650ac_ar8327_data = {
+	.pad0_cfg = &cf_wr650ac_ar8327_pad0_cfg,
+	.pad6_cfg = &cf_wr650ac_ar8327_pad6_cfg,
+	.port0_cfg = {
+		.force_link = 1,
+		.speed = AR8327_PORT_SPEED_1000,
+		.duplex = 1,
+		.txpause = 1,
+		.rxpause = 1,
+	},
+	.port6_cfg = {
+		.force_link = 1,
+		.speed = AR8327_PORT_SPEED_1000,
+		.duplex = 1,
+		.txpause = 1,
+		.rxpause = 1,
+	},
+};
+
+static struct mdio_board_info cf_wr650ac_mdio0_info[] = {
+	{
+		.bus_id = "ag71xx-mdio.0",
+		.phy_addr = 0,
+		.platform_data = &cf_wr650ac_ar8327_data,
+	},
+};
+
+static void __init cf_wr650ac_setup(void)
+{
+	u8 *art = (u8 *) KSEG1ADDR(0x1f020000);
+	u8 wlan0_mac[ETH_ALEN];
+	u8 wlan1_mac[ETH_ALEN];
+
+	ath79_init_local_mac(ath79_eth0_data.mac_addr, art);
+	ath79_init_mac(wlan0_mac, art, 1);
+	ath79_init_mac(wlan1_mac, art, 3);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);		
+
+	ath79_gpio_output_select(CF_WR650AC_GPIO_XWDT_TRIGGER, 0);	
+	enable_external_wdt(CF_WR650AC_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(CF_WR650AC_GPIO_LED_NETWORK, 0);
+	ath79_gpio_output_select(CF_WR650AC_GPIO_LED_24G, 0);
+	ath79_gpio_output_select(CF_WR650AC_GPIO_LED_58G, 0);	
+	ath79_gpio_output_select(CF_WR650AC_GPIO_LED_WPS, 0);
+
+	ath79_register_m25p80(NULL);
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_wr650ac_leds_gpio),
+					cf_wr650ac_leds_gpio);
+	ath79_register_gpio_keys_polled(-1, CF_WR650AC_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_wr650ac_gpio_keys),
+					cf_wr650ac_gpio_keys);
+
+	ath79_register_usb();
+
+	ath79_register_wmac(art + CF_WR650AC_WMAC_CALDATA_OFFSET, wlan0_mac);
+
+	ath79_setup_qca955x_eth_cfg(QCA955X_ETH_CFG_RGMII_EN);
+
+	ath79_register_mdio(0, 0x0);
+
+	mdiobus_register_board_info(cf_wr650ac_mdio0_info,
+				    ARRAY_SIZE(cf_wr650ac_mdio0_info));
+
+	/* GMAC0 is connected to the RMGII interface */
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;
+	ath79_eth0_data.phy_mask = CF_WR650AC_LAN_PHYMASK;
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio0_device.dev;
+	ath79_eth0_pll_data.pll_1000 = 0xa6000000;
+	ath79_register_eth(0);
+
+	/* GMAC1 is connected to the SGMII interface */
+	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_SGMII;
+	ath79_eth1_data.speed = SPEED_1000;
+	ath79_eth1_data.duplex = DUPLEX_FULL;
+	ath79_eth1_pll_data.pll_1000 = 0x03000101;
+	ath79_register_eth(1);
+
+	ap91_pci_init(art + CF_WR650AC_PCIE_CALDATA_OFFSET, wlan1_mac);
+}
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_WR650AC, "COMFAST-CF-WR650AC", "COMFAST CF-WR650AC",
+	     cf_wr650ac_setup);	     
+     
+#define KT9671_GPIO_BTN_RESET	17
+
+#define KT9671_KEYS_POLL_INTERVAL	20	/* msecs */
+#define KT9671_KEYS_DEBOUNCE_INTERVAL (3 * KT9671_KEYS_POLL_INTERVAL)
+
+#define	KT9671_GPIO_XWDT_TRIGGER	13
+
+#define KT9671_GPIO_LED_WAN		2
+#define KT9671_GPIO_LED_LAN		3
+#define KT9671_GPIO_LED_WLAN		0
+
+#define KT9671_GPIO_LED_WAN1		4
+#define KT9671_GPIO_LED_LAN1		16
+#define KT9671_GPIO_LED_LAN2		15
+#define KT9671_GPIO_LED_LAN3		14
+#define KT9671_GPIO_LED_LAN4		11
+
+
+static struct gpio_led cf_kt9671_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:red:wan",
+		.gpio		= KT9671_GPIO_LED_WAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:lan",
+		.gpio		= KT9671_GPIO_LED_LAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:blue:wlan",
+		.gpio		= KT9671_GPIO_LED_WLAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:wan1",
+		.gpio		= KT9671_GPIO_LED_WAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan1",
+		.gpio		= KT9671_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan2",
+		.gpio		= KT9671_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan3",
+		.gpio		= KT9671_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan4",
+		.gpio		= KT9671_GPIO_LED_LAN4,
+		.active_low	= 1,
+	}, 
+};
+
+static struct gpio_keys_button cf_kt9671_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = KT9671_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= KT9671_GPIO_BTN_RESET,
+		.active_low	= 1,
+	}
+};
+
+static void __init comfast_cf_kt9671_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);	
+	
+	ath79_gpio_output_select(KT9671_GPIO_XWDT_TRIGGER, 0);	
+	enable_external_wdt(KT9671_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(KT9671_GPIO_LED_WAN, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_LAN, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_WLAN, 0);	
+
+	ath79_gpio_output_select(KT9671_GPIO_LED_WAN1, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_LAN1, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_LAN2, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_LAN3, 0);
+	ath79_gpio_output_select(KT9671_GPIO_LED_LAN4, 0);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+	
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 2);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
+	// wan
+	ath79_register_eth(1);
+
+	// lan
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_register_eth(0);	
+
+	ath79_register_wmac(art, NULL);
+	
+	ap91_pci_init(art + 0x5000, NULL);
+}
+
+static void __init cf_kt9671_setup(void)
+{
+	comfast_cf_kt9671_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_kt9671_leds_gpio),
+				 cf_kt9671_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, KT9671_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_kt9671_gpio_keys),
+					cf_kt9671_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_KUNTENG_KT9671, "KUNTENG-KT9671", "KunTeng KT9671",
+	     cf_kt9671_setup);
+	     
+#define KT9672_GPIO_BTN_RESET	17
+
+#define KT9672_KEYS_POLL_INTERVAL	20	/* msecs */
+#define KT9672_KEYS_DEBOUNCE_INTERVAL (3 * KT9672_KEYS_POLL_INTERVAL)
+
+#define	KT9672_GPIO_XWDT_TRIGGER	13
+
+#define KT9672_GPIO_LED_WAN		2
+#define KT9672_GPIO_LED_LAN		3
+#define KT9672_GPIO_LED_WLAN		0
+
+#define KT9672_GPIO_LED_WAN1		4
+#define KT9672_GPIO_LED_LAN1		16
+#define KT9672_GPIO_LED_LAN2		15
+#define KT9672_GPIO_LED_LAN3		14
+#define KT9672_GPIO_LED_LAN4		11
+
+static struct gpio_led kt9672_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:red:wan",
+		.gpio		= KT9672_GPIO_LED_WAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:lan",
+		.gpio		= KT9672_GPIO_LED_LAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:blue:wlan",
+		.gpio		= KT9672_GPIO_LED_WLAN,
+		.active_low	= 0,
+	}, {
+		.name		= "comfast:green:wan1",
+		.gpio		= KT9672_GPIO_LED_WAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan1",
+		.gpio		= KT9671_GPIO_LED_LAN1,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan2",
+		.gpio		= KT9672_GPIO_LED_LAN2,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan3",
+		.gpio		= KT9672_GPIO_LED_LAN3,
+		.active_low	= 1,
+	}, {
+		.name		= "comfast:green:lan4",
+		.gpio		= KT9672_GPIO_LED_LAN4,
+		.active_low	= 1,
+	}, 
+};
+
+static struct gpio_keys_button kt9672_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = KT9672_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= KT9672_GPIO_BTN_RESET,
+		.active_low	= 1,
+	}
+};
+
+static void __init comfast_kt9672_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+	u8 *art = (u8 *) KSEG1ADDR(0x1f011000);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);	
+	
+	ath79_gpio_output_select(KT9672_GPIO_XWDT_TRIGGER, 0);	
+	enable_external_wdt(KT9672_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(KT9672_GPIO_LED_WAN, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_LAN, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_WLAN, 0);	
+
+	ath79_gpio_output_select(KT9672_GPIO_LED_WAN1, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_LAN1, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_LAN2, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_LAN3, 0);
+	ath79_gpio_output_select(KT9672_GPIO_LED_LAN4, 0);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+	
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 2);
+	ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
+
+	// wan
+	ath79_register_eth(1);
+
+	// lan
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+	ath79_register_eth(0);	
+
+	ath79_register_wmac(art, NULL);
+	
+	ap91_pci_init(art + 0x5000, NULL);
+}
+
+static void __init kt9672_setup(void)
+{
+	comfast_kt9672_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(kt9672_leds_gpio),
+				 kt9672_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, KT9672_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(kt9672_gpio_keys),
+					kt9672_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_KUNTENG_KT9672, "KUNTENG-KT9672", "KunTeng KT9672",
+	     kt9672_setup);
+	     
+#define CF_E380AC_KEYS_POLL_INTERVAL	20	/* msecs */
+#define CF_E380AC_KEYS_DEBOUNCE_INTERVAL (3 * CF_E380AC_KEYS_POLL_INTERVAL)
+
+#define	CF_E380AC_GPIO_XWDT_TRIGGER	17
+
+#define CF_E380AC_GPIO_BTN_RESET_WPS	19
+
+#define CF_E380AC_GPIO_LED_WAN		3
+#define CF_E380AC_GPIO_LED_LAN		0
+#define CF_E380AC_GPIO_LED_WLAN		2
+
+#define CF_E380AC_WMAC_CALDATA_OFFSET		0x1000
+#define CF_E380AC_PCIE_CALDATA_OFFSET		0x5000
+
+#define CF_E380AC_LAN_PHYMASK              BIT(0)
+#define CF_E380AC_WAN_PHYMASK              BIT(5)
+#define CF_E380AC_MDIO_MASK                (~(CF_E380AC_LAN_PHYMASK | CF_E380AC_WAN_PHYMASK))
+
+static struct gpio_led cf_e380ac_leds_gpio[] __initdata = {
+	{
+		.name		= "comfast:red:wan",
+		.gpio		= CF_E380AC_GPIO_LED_WAN,
+		.active_low	= 0,
+	}, 
+	{
+		.name		= "comfast:green:lan",
+		.gpio		= CF_E380AC_GPIO_LED_LAN,
+		.active_low	= 0,
+	}, 
+	{
+		.name		= "comfast:blue:wlan",
+		.gpio		= CF_E380AC_GPIO_LED_WLAN,
+		.active_low	= 0,
+	},
+
+};
+
+static struct gpio_keys_button cf_e380ac_gpio_keys[] __initdata = {
+	{
+		.desc		= "Reset button/WPS button",
+		.type		= EV_KEY,
+		.code		= KEY_RESTART,
+		.debounce_interval = CF_E380AC_KEYS_DEBOUNCE_INTERVAL,
+		.gpio		= CF_E380AC_GPIO_BTN_RESET_WPS,
+		.active_low	= 1,
+	},
+};
+
+static struct at803x_platform_data cf_e380ac_at803x_data = {
+	.disable_smarteee = 1,
+//	.enable_rgmii_rx_delay = 1,
+//	.enable_rgmii_tx_delay = 1,
+};
+
+static struct mdio_board_info cf_e380ac_mdio0_info[] = {
+	{
+		.bus_id = "ag71xx-mdio.0",
+		.phy_addr = 0,
+		.platform_data = &cf_e380ac_at803x_data,
+	},
+};
+
+static void __init cf_e380ac_setup(void)
+{
+	u8 *art = (u8 *) KSEG1ADDR(0x1f020000);
+	u8 wlan0_mac[ETH_ALEN];
+	u8 wlan1_mac[ETH_ALEN];
+
+	ath79_init_local_mac(ath79_eth0_data.mac_addr, art);
+	ath79_init_mac(wlan0_mac, art, 1);
+	ath79_init_mac(wlan1_mac, art, 3);
+	
+	/* Disable JTAG, enabling GPIOs 0-3 */
+	/* Configure OBS4 line, for GPIO 4*/	
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, 0);		
+
+	ath79_gpio_output_select(CF_E380AC_GPIO_XWDT_TRIGGER, 0);	
+	enable_external_wdt(CF_E380AC_GPIO_XWDT_TRIGGER);
+	
+	ath79_gpio_output_select(CF_E380AC_GPIO_LED_WAN, 0);
+	ath79_gpio_output_select(CF_E380AC_GPIO_LED_LAN, 0);
+	ath79_gpio_output_select(CF_E380AC_GPIO_LED_WLAN, 0);	
+
+	ath79_register_m25p80(NULL);
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(cf_e380ac_leds_gpio),
+					cf_e380ac_leds_gpio);
+	ath79_register_gpio_keys_polled(-1, CF_E380AC_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(cf_e380ac_gpio_keys),
+					cf_e380ac_gpio_keys);
+
+	ath79_register_usb();
+	ath79_register_wmac(art + CF_E380AC_WMAC_CALDATA_OFFSET, wlan0_mac);
+	ath79_setup_qca955x_eth_cfg(QCA955X_ETH_CFG_RGMII_EN);
+	
+	ath79_register_mdio(0, 0x0);
+	mdiobus_register_board_info(cf_e380ac_mdio0_info,
+				    ARRAY_SIZE(cf_e380ac_mdio0_info));
+
+	ath79_init_local_mac(ath79_eth0_data.mac_addr, art);
+	ath79_eth0_data.mii_bus_dev = &ath79_mdio0_device.dev;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;
+	ath79_eth0_data.phy_mask = BIT(0);
+	ath79_eth0_pll_data.pll_10 = 0xB0001313;
+	ath79_eth0_pll_data.pll_100 = 0xB0000101;
+	ath79_eth0_pll_data.pll_1000 = 0xBE000000;	
+	ath79_register_eth(0);
+
+	ap91_pci_init(art + CF_E380AC_PCIE_CALDATA_OFFSET, wlan1_mac);
+}	
+
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_CF_E380AC, "COMFAST-CF-E380AC", "COMFAST CF-E380AC",
+	     cf_e380ac_setup);	     
+	     
+#if 0
+#define DBDC9344GE_PHYMASK		BIT(0)
+#define	DBDC9344GE_WMAC_CALDATA_OFFSET	0x1000
+#define DBDC9344GE_PCI_CALDATA_OFFSET	0x5000
+
+#define	DBDC9344GE_GPIO_EXTPHY_RESET	11
+
+static struct gpio_keys_button comfast_dbdc9344ge_gpio_keys[] __initdata = {
+	{
+		.desc			= "reset",
+		.type			= EV_KEY,
+		.code			= KEY_RESTART,
+		.debounce_interval	= COMFAST_KEYS_DEBOUNCE_INTERVAL,
+		.gpio			= 22,
+		.active_low		= 1,
+	}
+};
+
+static struct gpio_led comfast_dbdc9344ge_gpio_leds[] __initdata = {
+	{
+		.name		= "comfast:red",
+		.gpio		= 2,
+	}, {
+		.name		= "comfast:green",
+		.gpio		= 3,
+	}, {
+		.name		= "comfast:blue",
+		.gpio		= 0,
+	}
+};
+
+static void __init comfast_dbdc9344ge_setup(void)
+{
+	u8 *mac = (u8 *) KSEG1ADDR(0x1f010000);
+
+	ath79_gpio_function_setup(AR934X_GPIO_FUNC_JTAG_DISABLE, AR934X_GPIO_FUNC_CLK_OBS4_EN);
+
+	ath79_register_m25p80(NULL);
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(comfast_dbdc9344ge_gpio_leds),
+				 comfast_dbdc9344ge_gpio_leds);
+				 
+	ath79_register_gpio_keys_polled(-1, COMFAST_KEYS_POLL_INTERVAL,
+                                        ARRAY_SIZE(comfast_dbdc9344ge_gpio_keys),
+                                        comfast_dbdc9344ge_gpio_keys);
+					
+	ext_lna_control_gpio_setup(18, 19);
+
+	ath79_register_mdio(0, 0x00);
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);
+
+	/* GMAC0 is connected to GE-PHY by RGMII */
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;
+	ath79_eth0_data.phy_mask = DBDC9344GE_PHYMASK;
+	ath79_register_eth(0);
+
+	ath79_register_wmac(mac + DBDC9344GE_WMAC_CALDATA_OFFSET, NULL);
+	ap91_pci_init(mac + DBDC9344GE_PCI_CALDATA_OFFSET, NULL);
+}
+
+MIPS_MACHINE(ATH79_MACH_COMFAST_DBDC9344GE, "COMFAST-DBDC9344GE", "COMFAST DBDC9344GE", comfast_dbdc9344ge_setup);
+#endif
diff -urpN target_orig/linux/ar71xx/files/arch/mips/ath79/mach-kt9661.c target/linux/ar71xx/files/arch/mips/ath79/mach-kt9661.c
--- target_orig/linux/ar71xx/files/arch/mips/ath79/mach-kt9661.c	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-kt9661.c	2016-07-18 09:34:17.001095083 +0800
@@ -0,0 +1,186 @@
+/*
+ *
+ *
+ */
+
+#include <linux/gpio.h>
+#include <linux/platform_device.h>
+#include <linux/mtd/mtd.h>
+#include <linux/mtd/nand.h>
+#include <linux/mtd/partitions.h>
+
+#include <asm/mach-ath79/ath79.h>
+#include <asm/mach-ath79/ar71xx_regs.h>
+
+#include "common.h"
+#include "dev-eth.h"
+#include "dev-gpio-buttons.h"
+#include "dev-leds-gpio.h"
+#include "dev-m25p80.h"
+#include "dev-wmac.h"
+#include "machtypes.h"
+
+#define KT9661_GPIO_LED_SYSTEM 11
+#define KT9661_GPIO_LED_WLAN   12
+#define KT9661_GPIO_LED_WAN    13
+#define KT9661_GPIO_LED_LAN    4
+
+#define KT9661_GPIO_BTN_RESET  3
+
+#define KT9661_KEYS_POLL_INTERVAL  		20  /* msecs */
+#define KT9661_KEYS_DEBOUNCE_INTERVAL 	(3 * KT9661_KEYS_POLL_INTERVAL)
+
+/* jack tseng 01/07/2016 add */
+/* use the mac from the command: "./mfg-info --set --mac-addr-main 00:01:6C:10:00:A3 2"  */
+#define MFC_BASE_ADDR 			0x9F060000
+#define MAC_OFFSET    			0xD0
+#define RADIO_0_OFFSET    		0x110
+#define MAC_ADDR      			MFC_BASE_ADDR + MAC_OFFSET
+#define RADIO_0_MAC_ADDR      		MFC_BASE_ADDR + RADIO_0_OFFSET
+/* end of jack tseng 01/07/2016 */
+
+static struct gpio_led kt9661_leds_gpio[] __initdata = {
+	{
+       .name       = "kt9661:green:wan",
+       .gpio       = KT9661_GPIO_LED_WAN,
+       .active_low = 1,
+   	},{
+       .name       = "kt9661:green:system",
+       .gpio       = KT9661_GPIO_LED_SYSTEM,
+       .active_low = 1,
+   	}, {
+       .name       = "kt9661:green:wlan",
+       .gpio       = KT9661_GPIO_LED_WLAN,
+       .active_low = 1,
+   	}, {
+       .name       = "kt9661:green:lan",
+       .gpio       = KT9661_GPIO_LED_LAN,
+       .active_low = 1,
+   	}
+};
+
+static struct gpio_keys_button kt9661_gpio_keys[] __initdata = {
+   {
+       .desc       = "Reset button",
+       .type       = EV_KEY,
+       .code       = KEY_RESTART,
+       .debounce_interval = KT9661_KEYS_DEBOUNCE_INTERVAL,
+       .gpio       = KT9661_GPIO_BTN_RESET,
+       .active_low = 1,
+   }
+};
+
+
+void ath79_get_mac(char* smac, u8* umac)
+{
+	int i = 0, char_cnt = 0;
+	char *pos_ptr = smac;
+	u8 mac_char[2];
+
+	do {
+		if ((*pos_ptr == 0x3A) || (*pos_ptr == 0x0)) {
+			if (char_cnt==2) {
+				if (mac_char[0] > 0x60) {
+					mac_char[0] = (mac_char[0] - 0x57)<<4;
+				} else if (mac_char[0] > 0x40) {
+					mac_char[0] = (mac_char[0] - 0x37)<<4;
+				} else {
+					mac_char[0] = (mac_char[0] - 0x30)<<4;
+				}
+
+				if (mac_char[1] > 0x60) {
+					mac_char[1] = mac_char[1] - 0x57;
+				} else if (mac_char[1] > 0x40) {
+					mac_char[1] = mac_char[1] - 0x37;
+				} else {
+					mac_char[1] = mac_char[1] - 0x30;
+				}       
+
+				umac[i] = mac_char[0] + mac_char[1];
+			} else if (char_cnt == 1) {
+				if (mac_char[0] > 0x60) {
+					mac_char[0] = mac_char[0] - 0x57;
+				} else if (mac_char[0] > 0x40) {
+					mac_char[0] = mac_char[0] - 0x37;
+				} else {
+					mac_char[0] = mac_char[0] - 0x30;
+				}
+
+				umac[i] = mac_char[0];
+			} else {
+				umac[i] = 0xFF;
+			}
+
+			i++;
+			char_cnt = 0;
+		} else {
+			mac_char[char_cnt] = *pos_ptr;
+			char_cnt += 1;
+		}
+	} while (*pos_ptr != 0x0 && pos_ptr++);
+}  
+
+
+static void __init kf_ap143_setup(void)
+{
+	u8 *ee = (u8 *) KSEG1ADDR(0x1f071000);
+	u8 tmpmac[ETH_ALEN] = {-1};
+	char mac_string[32] = {0};
+	u8 ethmac[6] = {-1};
+	u8 radio_0_mac[6] = {-1};
+	
+	/* gukq 20160510 modified for supporting other qca routers */
+//	ath79_register_m25p80(NULL);
+	ath79_register_m25p80_32M(NULL);
+	/* gukq added over */
+
+	ath79_setup_ar933x_phy4_switch(false, false);
+
+	ath79_register_mdio(0, 0x0);
+
+	/* jack tseng 01/07/2016 add */
+	/* use the mac from the command "./mfg-info --set --mac-addr-main 00:01:6C:10:00:A3 2"  */
+	memcpy(mac_string, (const void *)MAC_ADDR, 32);
+	ath79_get_mac(mac_string, ethmac);
+	pr_err("eth mac address: %02x:%02x:%02x:%02x:%02x:%02x \n",
+		ethmac[0], ethmac[1], ethmac[2], ethmac[3], ethmac[4], ethmac[5]);
+
+	memset(mac_string, 0, 32);
+	memcpy(mac_string, (const void *)RADIO_0_MAC_ADDR, 32);
+	ath79_get_mac(mac_string, radio_0_mac);
+
+	/* LAN */
+	ath79_init_mac(ath79_eth1_data.mac_addr, ethmac, 0);
+
+	ath79_register_eth(1);
+
+	/* WAN */
+	ath79_switch_data.phy4_mii_en = 1;
+	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+
+	ath79_init_mac(ath79_eth0_data.mac_addr, ethmac, 1);
+
+	ath79_register_eth(0);
+
+	/* set wlan mac */
+	pr_err("radio_0 mac address: %02x:%02x:%02x:%02x:%02x:%02x \n",
+		radio_0_mac[0], radio_0_mac[1], radio_0_mac[2], radio_0_mac[3], radio_0_mac[4], radio_0_mac[5]);
+	ath79_init_mac(tmpmac, radio_0_mac, 0);
+
+	ath79_register_wmac(ee, tmpmac);
+}
+
+static void __init kt9661_setup(void)
+{
+	kf_ap143_setup();
+
+	ath79_register_leds_gpio(-1, ARRAY_SIZE(kt9661_leds_gpio),
+				 kt9661_leds_gpio);
+
+	ath79_register_gpio_keys_polled(1, KT9661_KEYS_POLL_INTERVAL,
+					ARRAY_SIZE(kt9661_gpio_keys),
+					kt9661_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_KT9661, "KT9661", "KUNTENG KT9661",
+	     kt9661_setup);
diff -urpN target_orig/linux/ar71xx/generic/profiles/atheros.mk target/linux/ar71xx/generic/profiles/atheros.mk
--- target_orig/linux/ar71xx/generic/profiles/atheros.mk	2016-06-17 15:12:18.452786375 +0800
+++ target/linux/ar71xx/generic/profiles/atheros.mk	2016-07-18 09:34:17.029095092 +0800
@@ -71,6 +71,39 @@ endef
 
 $(eval $(call Profile,AP136))
 
+define Profile/AP143
+	NAME:=Qualcomm Atheros AP143 reference board
+	PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/AP143/Description
+	Package set optimized for the Qualcomm Atheros AP143 reference board.
+endef
+
+$(eval $(call Profile,AP143))
+
+define Profile/AP147
+	NAME:=Qualcomm Atheros AP147 reference board
+	PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/AP147/Description
+	Package set optimized for the Atheros AP147 reference board.
+endef
+
+$(eval $(call Profile,AP147))
+
+define Profile/AP152
+	NAME:=Qualcomm Atheros AP152 reference board
+	PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/AP152/Description
+	Package set optimized for the Qualcomm Atheros AP152 reference board.
+endef
+
+$(eval $(call Profile,AP152))
+
 define Profile/AP81
 	NAME:=Atheros AP81 reference board
 	PACKAGES:=kmod-usb-core kmod-usb2
diff -urpN target_orig/linux/ar71xx/generic/profiles/comfast.mk target/linux/ar71xx/generic/profiles/comfast.mk
--- target_orig/linux/ar71xx/generic/profiles/comfast.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/generic/profiles/comfast.mk	2016-07-18 09:34:17.029095092 +0800
@@ -0,0 +1,137 @@
+#
+# Copyright (C) 2009 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+define Profile/COMFASTAP9341FE
+	NAME:=COMFAST AP9341FE
+	PACKAGES:=
+endef
+
+define Profile/COMFASTAP9341FE/Description
+	Package set optimized for the COMFAST AP9341FE.
+endef
+
+$(eval $(call Profile,COMFASTAP9341FE))
+
+define Profile/COMFASTCFWR600N
+	NAME:=COMFAST CF-WR600N
+	PACKAGES:=
+endef
+
+define Profile/COMFASTCFWR600N/Description
+	Package set optimized for the COMFAST CF-WR600N.
+endef
+
+$(eval $(call Profile,COMFASTCFWR600N))
+
+define Profile/COMFASTCFWR605N
+	NAME:=COMFAST CF-WR605N
+	PACKAGES:=
+endef
+
+define Profile/COMFASTCFWR605N/Description
+	Package set optimized for the COMFAST CF-WR605N.
+endef
+
+$(eval $(call Profile,COMFASTCFWR605N))
+
+define Profile/COMFASTCFWR610N
+	NAME:=COMFAST CF-WR610N
+	PACKAGES:=
+endef
+
+define Profile/COMFASTCFWR610N/Description
+	Package set optimized for the COMFAST CF-WR610N.
+endef
+
+$(eval $(call Profile,COMFASTCFWR610N))
+
+
+define Profile/COMFASTCFWR615N
+	NAME:=COMFAST CF-WR615N
+	PACKAGES:=
+endef
+define Profile/COMFASTCFWR615N/Description
+	Package set optimized for the COMFAST CF-WR615N.
+endef
+$(eval $(call Profile,COMFASTCFWR615N))
+
+define Profile/KUNTENGKT9672
+	NAME:=KunTeng KT9672
+	PACKAGES:=
+endef
+define Profile/KUNTENGKT9672/Description
+	Package set optimized for the COMFAST CF-E355AC which named KT-9672 in KunTeng.
+endef
+$(eval $(call Profile,KUNTENGKT9672))
+
+define Profile/COMFASTCFE380AC
+	NAME:=COMFAST CF-E380AC
+	PACKAGES:=
+endef
+define Profile/COMFASTCFE380AC/Description
+	Package set optimized for the COMFAST CF-E380AC.
+endef
+$(eval $(call Profile,COMFASTCFE380AC))
+
+define Profile/COMFASTCFE520N
+	NAME:=COMFAST CF-E520N
+	PACKAGES:=
+endef
+define Profile/COMFASTCFE520N/Description
+	Package set optimized for the COMFAST CF-E520N.
+endef
+$(eval $(call Profile,COMFASTCFE520N))
+
+define Profile/COMFASTCFE530N
+	NAME:=COMFAST CF-E530N
+	PACKAGES:=
+endef
+define Profile/COMFASTCFE530N/Description
+	Package set optimized for the COMFAST CF-E530N.
+endef
+$(eval $(call Profile,COMFASTCFE530N))
+
+
+define Profile/COMFASTCFWR650AC
+	NAME:=COMFAST CF-WR650AC
+	PACKAGES:=
+endef
+define Profile/COMFASTCFWR650AC/Description
+	Package set optimized for the COMFAST CF-WR650AC.
+endef
+$(eval $(call Profile,COMFASTCFWR650AC))
+
+
+define Profile/COMFASTCFE316NV2
+	NAME:=COMFAST CF-E316NV2
+	PACKAGES:=
+endef
+
+define Profile/COMFASTCFE316NV2/Description
+	Package set optimized for the COMFAST CF-E316NV2.
+endef
+
+$(eval $(call Profile,COMFASTCFE316NV2))
+
+define Profile/COMFASTCFE325N
+	NAME:=COMFAST CF-E325N
+	PACKAGES:=
+endef
+
+define Profile/COMFASTCFE325N/Description
+	Package set optimized for the COMFAST CF-E325N.
+endef
+
+$(eval $(call Profile,COMFASTCFE325N))
+
+define Profile/KUNTENGKT9671
+	NAME:=KunTeng KT9671
+	PACKAGES:=
+endef
+define Profile/KUNTENGKT9671/Description
+	Package set optimized for the COMFAST CF-E350N which named KT-9671 in KunTeng.
+endef
+$(eval $(call Profile,KUNTENGKT9671))
diff -urpN target_orig/linux/ar71xx/generic/profiles/gbcom.mk target/linux/ar71xx/generic/profiles/gbcom.mk
--- target_orig/linux/ar71xx/generic/profiles/gbcom.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/generic/profiles/gbcom.mk	2016-07-18 09:34:17.053095097 +0800
@@ -0,0 +1,50 @@
+#
+# Copyright (C) 2009-2010 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/GB_CGW600
+        NAME:=GBCOM CGW600 board
+        PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/GB_CGW600/Description
+        Package set optimized for the GBCOM CWW600 board.
+endef
+
+$(eval $(call Profile,GB_CGW600))
+
+define Profile/GB_CGW800
+        NAME:=GBCOM CGW800 board
+        PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/GB_CGW800/Description
+        Package set optimized for the GBCOM CWW800 board.
+endef
+
+$(eval $(call Profile,GB_CGW800))
+
+define Profile/GB_TA2025AC
+        NAME:=GBCOM TA2025AC board
+        PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/GB_TA2025AC/Description
+        Package set optimized for the GBCOM TA2025AC board.
+endef
+
+$(eval $(call Profile,GB_TA2025AC))
+
+define Profile/GB_OA5025
+        NAME:=GBCOM OA5025 board
+        PACKAGES:=kmod-usb-core kmod-usb2 kmod-usb-storage
+endef
+
+define Profile/GB_OA5025/Description
+        Package set optimized for the GBCOM OA5025 board.
+endef
+
+$(eval $(call Profile,GB_OA5025))
diff -urpN target_orig/linux/ar71xx/generic/profiles/kf20x0.mk target/linux/ar71xx/generic/profiles/kf20x0.mk
--- target_orig/linux/ar71xx/generic/profiles/kf20x0.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/generic/profiles/kf20x0.mk	2016-07-18 09:34:17.029095092 +0800
@@ -0,0 +1,17 @@
+#
+# Copyright (C) 2013 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+# renamed by gukq 20160526 from kf-2010 to kt9661
+define Profile/KT9661
+	NAME:=KunTeng KT-9661
+	PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev kmod-ath10k
+endef
+
+define Profile/KT9661/Description
+  Package set optimized for the KunTeng kt-9661 device.
+endef
+$(eval $(call Profile,KT9661))
diff -urpN target_orig/linux/ar71xx/image/Makefile target/linux/ar71xx/image/Makefile
--- target_orig/linux/ar71xx/image/Makefile	2016-06-17 15:12:18.452786375 +0800
+++ target/linux/ar71xx/image/Makefile	2016-07-18 09:34:17.053095097 +0800
@@ -955,6 +955,14 @@ ap121_mtdlayout_4M=mtdparts=spi0.0:256k(
 ap132_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,1408k(kernel),6400k(rootfs),64k(art),7808k@0x50000(firmware)
 ap135_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art)ro,16000k@0x50000(firmware)
 ap136_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1408k(kernel),64k(mib0),64k(art)ro,7744k@0x50000(firmware)
+ap143_mtdlayout_8M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1472k(kernel),64k(art)ro,7744k@0x50000(firmware)
+ap143_mtdlayout_16M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art)ro,16000k@0x50000(firmware)
+ap147_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art),16000k@0x50000(firmware)
+ap152_mtdlayout_16M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art)ro,16000k@0x50000(firmware)
+gb_cgw600_16m_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art),16000k@0x50000(firmware)
+gb_cgw800_16m_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art),16000k@0x50000(firmware)
+gb_ta2025ac_16m_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art),16000k@0x50000(firmware)
+gb_oa5025_16m_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,14528k(rootfs),1472k(kernel),64k(art),16000k@0x50000(firmware)
 bxu2000n2_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,1408k(kernel),8448k(rootfs),6016k(user),64k(cfg),64k(oem),64k(art)ro
 cameo_ap81_mtdlayout=mtdparts=spi0.0:128k(u-boot)ro,64k(config)ro,3840k(firmware),64k(art)ro
 cameo_ap91_mtdlayout=mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,3712k(firmware),64k(mac)ro,64k(art)ro
@@ -983,12 +991,26 @@ dlrtdev_mtdlayout=mtdparts=spi0.0:256k(u
 dlrtdev_mtdlayout_fat=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,7168k(firmware),640k(certs),64k(caldata)ro,64k@0x660000(caldata_orig),6208k@0x50000(firmware_orig)
 dragino2_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,16000k(firmware),64k(config)ro,64k(art)ro
 hiwifi_hc6361_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(bdinfo)ro,1280k(kernel),14848k(rootfs),64k(backup)ro,64k(art)ro,16128k@0x20000(firmware)
+kt9661_mtdlayout=mtdparts=spi0.0:256k(redboot),128k(env),64k(mib0),64k(art),2048k(kernel),30208k(rootfs),32256k@0x80000(firmware)
 mr12_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,256k(u-boot-env)ro,13440k(rootfs),2304k(kernel),128k(art)ro,15744k@0x80000(firmware)
 mr16_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,256k(u-boot-env)ro,13440k(rootfs),2304k(kernel),128k(art)ro,15744k@0x80000(firmware)
 pb92_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,2752k(rootfs),896k(kernel),64k(nvram),64k(art)ro,3648k@0x50000(firmware)
 planex_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,7744k(firmware),128k(art)ro
 ubntxm_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,7552k(firmware),256k(cfg)ro,64k(EEPROM)ro
 uap_pro_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,1536k(kernel),14208k(rootfs),256k(cfg)ro,64k(EEPROM)ro,15744k@0x50000(firmware)
+comfast_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+ar9341_cf_wr600n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+ar9341_cf_wr605n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9531_cf_wr610n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9531_cf_wr615n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9558_cf_e380ac_mtdlayout=mtdparts=spi0.0:128k(u-boot)ro,64k(art)ro,1536k(kernel),14592k(rootfs),64k(nvram)ro,16128k@0x30000(firmware)
+qca9531_cf_e520n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),6464k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9531_cf_e530n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),6464k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9558_cf_wr650ac_mtdlayout=mtdparts=spi0.0:128k(u-boot)ro,64k(art)ro,1536k(kernel),14592k(rootfs),64k(nvram)ro,16128k@0x30000(firmware)
+qca9531_kt9671_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+qca9531_kt9672_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+ar9341_cf_e316nv2_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware)
+ar9341_cf_e325n_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,1536k(kernel),14656k(rootfs),64k(nvram)ro,16192k@0x20000(firmware) 
 ubdev_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,7488k(firmware),64k(certs),256k(cfg)ro,64k(EEPROM)ro
 whrhpg300n_mtdlayout=mtdparts=spi0.0:248k(u-boot)ro,8k(u-boot-env)ro,3712k(firmware),64k(art)ro
 wlr8100_mtdlayout=mtdparts=spi0.0:192k(u-boot)ro,64k(u-boot-env)ro,1408k(kernel),14080k(rootfs),192k(unknown)ro,64k(art)ro,384k(unknown2)ro,15488k@0x40000(firmware)
@@ -1224,6 +1246,9 @@ Image/Build/AthLzma/buildkernel=$(call M
 Image/Build/AthLzma=$(call Image/Build/Ath,$(1),$(2),$(3),$(4),$(5),$(6),$(7))
 Image/Build/AthLzma/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(4))
 
+Image/Build/KTLzma/buildkernel=$(call MkuImageLzma,$(2),$(3) $(4))
+Image/Build/KTLzma=$(call Image/Build/Ath,$(1),$(2),$(3),$(4),$(5),$(6),$(7))
+Image/Build/KTLzma/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(4))
 
 Image/Build/Belkin/buildkernel=$(call MkuImageLzma,$(2),$(3) $(4))
 Image/Build/Belkin/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(4))
@@ -1341,6 +1366,200 @@ define Image/Build/UAPPRO
 		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
 		-o $(call factoryname,$(1),$(2))
 endef
+Image/Build/COMFAST/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(comfast_mtdlayout))
+define Image/Build/COMFAST/buildkernel
+	$(call MkuImageLzma,$(2),$(3) $(comfast_mtdlayout))
+	-rm -rf $(KDIR_TMP)/$(2)
+	mkdir -p $(KDIR_TMP)/$(2)/image
+	cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR_TMP)/$(2)/image/kernel0
+	$(STAGING_DIR_HOST)/bin/mkfs.jffs2 \
+		--pad --big-endian --squash-uids -v -e 64KiB \
+		-o $(KDIR_TMP)/$(2)-kernel.jffs2 \
+		-d $(KDIR_TMP)/$(2)/image \
+		2>&1 1>/dev/null | awk '/^.+$$$$/'
+	-rm -rf $(KDIR_TMP)/$(2)
+	$(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR_TMP)/$(2)-kernel.jffs2 -J 64
+endef
+
+define Image/Build/COMFAST
+	$(call CatFiles,$(KDIR_TMP)/$(2)-kernel.jffs2,1572864,$(KDIR)/root.$(1),14548992,$(call sysupname,$(1),$(2)))
+	-$(STAGING_DIR_HOST)/bin/mkfwimage2 -f 0x9f000000 \
+		-v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
+		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
+		-o $(call factoryname,$(1),$(2))
+endef
+
+Image/Build/COMFAST_CF_WR600N/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(ar9341_cf_wr600n_mtdlayout))
+define Image/Build/COMFAST_CF_WR600N/buildkernel
+	$(call MkuImageLzma,$(2),$(3) $(ar9341_cf_wr600n_mtdlayout))
+	-rm -rf $(KDIR_TMP)/$(2)
+	mkdir -p $(KDIR_TMP)/$(2)/image
+	cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR_TMP)/$(2)/image/kernel0
+	$(STAGING_DIR_HOST)/bin/mkfs.jffs2 \
+		--pad --big-endian --squash-uids -v -e 64KiB \
+		-o $(KDIR_TMP)/$(2)-kernel.jffs2 \
+		-d $(KDIR_TMP)/$(2)/image \
+		2>&1 1>/dev/null | awk '/^.+$$$$/'
+	-rm -rf $(KDIR_TMP)/$(2)
+	$(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR_TMP)/$(2)-kernel.jffs2 -J 64
+endef
+
+define Image/Build/COMFAST_CF_WR600N
+	$(call CatFiles,$(KDIR_TMP)/$(2)-kernel.jffs2,1572864,$(KDIR)/root.$(1),14548992,$(call sysupname,$(1),$(2)))
+	-$(STAGING_DIR_HOST)/bin/mkfwimage2 -f 0x9f000000 \
+		-v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
+		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
+		-o $(call factoryname,$(1),$(2))
+endef
+
+Image/Build/COMFAST_CF_WR605N/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(ar9341_cf_wr605n_mtdlayout))
+define Image/Build/COMFAST_CF_WR605N/buildkernel
+	$(call MkuImageLzma,$(2),$(3) $(ar9341_cf_wr605n_mtdlayout))
+	-rm -rf $(KDIR_TMP)/$(2)
+	mkdir -p $(KDIR_TMP)/$(2)/image
+	cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR_TMP)/$(2)/image/kernel0
+	$(STAGING_DIR_HOST)/bin/mkfs.jffs2 \
+		--pad --big-endian --squash-uids -v -e 64KiB \
+		-o $(KDIR_TMP)/$(2)-kernel.jffs2 \
+		-d $(KDIR_TMP)/$(2)/image \
+		2>&1 1>/dev/null | awk '/^.+$$$$/'
+	-rm -rf $(KDIR_TMP)/$(2)
+	$(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR_TMP)/$(2)-kernel.jffs2 -J 64
+endef
+
+define Image/Build/COMFAST_CF_WR605N
+	$(call CatFiles,$(KDIR_TMP)/$(2)-kernel.jffs2,1572864,$(KDIR)/root.$(1),14548992,$(call sysupname,$(1),$(2)))
+	-$(STAGING_DIR_HOST)/bin/mkfwimage2 -f 0x9f000000 \
+		-v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
+		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
+		-o $(call factoryname,$(1),$(2))
+endef
+
+Image/Build/COMFAST_CF_E316NV2/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(ar9341_cf_e316nv2_mtdlayout))
+define Image/Build/COMFAST_CF_E316NV2/buildkernel
+	$(call MkuImageLzma,$(2),$(3) $(ar9341_cf_e316nv2_mtdlayout))
+	-rm -rf $(KDIR_TMP)/$(2)
+	mkdir -p $(KDIR_TMP)/$(2)/image
+	cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR_TMP)/$(2)/image/kernel0
+	$(STAGING_DIR_HOST)/bin/mkfs.jffs2 \
+		--pad --big-endian --squash-uids -v -e 64KiB \
+		-o $(KDIR_TMP)/$(2)-kernel.jffs2 \
+		-d $(KDIR_TMP)/$(2)/image \
+		2>&1 1>/dev/null | awk '/^.+$$$$/'
+	-rm -rf $(KDIR_TMP)/$(2)
+	$(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR_TMP)/$(2)-kernel.jffs2 -J 64
+endef
+
+define Image/Build/COMFAST_CF_E316NV2
+	$(call CatFiles,$(KDIR_TMP)/$(2)-kernel.jffs2,1572864,$(KDIR)/root.$(1),14548992,$(call sysupname,$(1),$(2)))
+	-$(STAGING_DIR_HOST)/bin/mkfwimage2 -f 0x9f000000 \
+		-v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
+		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
+		-o $(call factoryname,$(1),$(2))
+endef
+
+Image/Build/COMFAST_CF_E325N/initramfs=$(call MkuImageLzma/initramfs,$(2),$(3) $(ar9341_cf_e325n_mtdlayout))
+define Image/Build/COMFAST_CF_E325N/buildkernel
+	$(call MkuImageLzma,$(2),$(3) $(ar9341_cf_e325n_mtdlayout))
+	-rm -rf $(KDIR_TMP)/$(2)
+	mkdir -p $(KDIR_TMP)/$(2)/image
+	cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR_TMP)/$(2)/image/kernel0
+	$(STAGING_DIR_HOST)/bin/mkfs.jffs2 \
+		--pad --big-endian --squash-uids -v -e 64KiB \
+		-o $(KDIR_TMP)/$(2)-kernel.jffs2 \
+		-d $(KDIR_TMP)/$(2)/image \
+		2>&1 1>/dev/null | awk '/^.+$$$$/'
+	-rm -rf $(KDIR_TMP)/$(2)
+	$(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR_TMP)/$(2)-kernel.jffs2 -J 64
+endef
+
+define Image/Build/COMFAST_CF_E325N
+	$(call CatFiles,$(KDIR_TMP)/$(2)-kernel.jffs2,1572864,$(KDIR)/root.$(1),14548992,$(call sysupname,$(1),$(2)))
+	-$(STAGING_DIR_HOST)/bin/mkfwimage2 -f 0x9f000000 \
+		-v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
+		-p jffs2:0x50000:0xf60000:0:0:$(call sysupname,$(1),$(2)) \
+		-o $(call factoryname,$(1),$(2))
+endef
+
+define Image/Build/KUNTENG_KT9671
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/KUNTENG_KT9672
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_WR610N
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_WR615N
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_E380AC
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_E520N
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_E530N
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
+
+define Image/Build/COMFAST_CF_WR650AC
+	$(call MkuImageLzma,$(2),$(3) $(4))
+	dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
+		of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
+	dd if=$(KDIR)/root.$(1) \
+		of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
+	( dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=1572864 conv=sync; dd if=$(KDIR)/root.$(1) ) \
+		> $(call imgname,$(1),$(2))-sysupgrade.bin
+endef
 
 # $(4) = board (XS2, XS5, RS, XM)
 # $(5) = series (BZ, XM, XW)
@@ -1872,6 +2091,15 @@ $(eval $(call SingleProfile,AthLzma,64k,
 $(eval $(call SingleProfile,AthLzma,64k,AP135,ap135-020,AP135-020,ttyS0,115200,$$(ap135_mtdlayout),RKuImage))
 $(eval $(call SingleProfile,AthLzma,64k,AP136_010,ap136-010,AP136-010,ttyS0,115200,$$(ap136_mtdlayout),RKuImage))
 $(eval $(call SingleProfile,AthLzma,64k,AP136_020,ap136-020,AP136-020,ttyS0,115200,$$(ap136_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,AP143_8M,ap143-8M,AP143,ttyS0,115200,$$(ap143_mtdlayout_8M),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,AP143_16M,ap143-16M,AP143,ttyS0,115200,$$(ap143_mtdlayout_16M),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,AP147_010,ap147-010,AP147-010,ttyS0,115200,$$(ap147_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,AP152_16M,ap152-16M,AP152,ttyS0,115200,$$(ap152_mtdlayout_16M),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,GB_CGW600_16M,gb_cgw600_16m,GB-CGW600,ttyS0,115200,$$(gb_cgw600_16m_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,GB_CGW800_16M,gb_cgw800_16m,GB-CGW800,ttyS0,115200,$$(gb_cgw800_16m_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,GB_TA2025AC_16M,gb_ta2025ac_16m,GB-TA2025AC,ttyS0,115200,$$(gb_ta2025ac_16m_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,AthLzma,64k,GB_OA5025_16M,gb_oa5025_16m,GB-OA5025,ttyS0,115200,$$(gb_oa5025_16m_mtdlayout),RKuImage))
+$(eval $(call SingleProfile,KTLzma,64k,KT9661,kt9661,KT9661,ttyS0,115200,$$(kt9661_mtdlayout),KRuImage))
 $(eval $(call SingleProfile,AthLzma,64k,BXU2000N2,bxu2000n-2-a1,BXU2000n-2-A1,ttyS0,115200,$$(bxu2000n2_mtdlayout),RKuImage))
 $(eval $(call SingleProfile,AthLzma,64k,CAP4200AG,cap4200ag,CAP4200AG,ttyS0,115200,$$(cap4200ag_mtdlayout),KRuImage))
 $(eval $(call SingleProfile,AthLzma,64k,DB120,db120,DB120,ttyS0,115200,$$(db120_mtdlayout),RKuImage))
@@ -2006,6 +2234,19 @@ $(eval $(call SingleProfile,TPLINK-SAFEL
 
 $(eval $(call SingleProfile,UAPPRO,64k,UAPPRO,ubnt-uap-pro,UAP-PRO,ttyS0,115200,BZ,BZ,ar934x))
 $(eval $(call SingleProfile,UAPPRO,64k,UBNTUNIFIOUTDOORPLUS,ubnt-unifi-outdoor-plus,UBNT-UOP,ttyS0,115200,BZ,BZ,ar7240))
+$(eval $(call SingleProfile,COMFAST,64k,COMFASTAP9341FE,comfast-ap9341fe,COMFAST-AP9341FE,ttyS0,115200,AP9341FE,AP9341FE,ar934x))
+$(eval $(call SingleProfile,COMFAST,64k,COMFASTCFWR600N,comfast-cf-wr600n,COMFAST-CF-WR600N,ttyS0,115200,CF-WR600N,CF-WR600N,ar934x))
+$(eval $(call SingleProfile,COMFAST,64k,COMFASTCFWR605N,comfast-cf-wr605n,COMFAST-CF-WR605N,ttyS0,115200,CF-WR605N,CF-WR605N,ar934x))
+$(eval $(call SingleProfile,COMFAST,64k,COMFASTCFE316NV2,comfast-cf-e316nv2,COMFAST-CF-E316NV2,ttyS0,115200,CF-E316NV2,CF-E316NV2,ar934x))
+$(eval $(call SingleProfile,COMFAST,64k,COMFASTCFE325N,comfast-cf-e325n,COMFAST-CF-E325N,ttyS0,115200,CF-E325N,CF-E325N,ar934x))
+$(eval $(call SingleProfile,COMFAST_CF_WR610N,64k,COMFASTCFWR610N,comfast-cf-wr610n,COMFAST-CF-WR610N,ttyS0,115200,$$(qca9531_cf_wr610n_mtdlayout),CF-WR610N,qca953x))
+$(eval $(call SingleProfile,KUNTENG_KT9671,64k,KUNTENGKT9671,kt9671,KUNTENG-KT9671,ttyS0,115200,$$(qca9531_kt9671_mtdlayout),KT-9671,qca953x))
+$(eval $(call SingleProfile,KUNTENG_KT9672,64k,KUNTENGKT9672,kt9672,KUNTENG-KT9672,ttyS0,115200,$$(qca9531_kt9672_mtdlayout),KT-9672,qca953x))
+$(eval $(call SingleProfile,COMFAST_CF_WR615N,64k,COMFASTCFWR615N,comfast-cf-wr615n,COMFAST-CF-WR615N,ttyS0,115200,$$(qca9531_cf_wr615n_mtdlayout),CF-WR615N,qca953x))
+$(eval $(call SingleProfile,COMFAST_CF_E380AC,64k,COMFASTCFE380AC,comfast-cf-e380ac,COMFAST-CF-E380AC,ttyS0,115200,$$(qca9558_cf_e380ac_mtdlayout),CF-E380AC,qca955x))
+$(eval $(call SingleProfile,COMFAST_CF_E520N,64k,COMFASTCFE520N,comfast-cf-e520n,COMFAST-CF-E520N,ttyS0,115200,$$(qca9531_cf_e520n_mtdlayout),CF-E520N,qca953x))
+$(eval $(call SingleProfile,COMFAST_CF_E530N,64k,COMFASTCFE530N,comfast-cf-e530n,COMFAST-CF-E530N,ttyS0,115200,$$(qca9531_cf_e530n_mtdlayout),CF-E530N,qca953x))
+$(eval $(call SingleProfile,COMFAST_CF_WR650AC,64k,COMFASTCFWR650AC,comfast-cf-wr650ac,COMFAST-CF-WR650AC,ttyS0,115200,$$(qca9558_cf_wr650ac_mtdlayout),CF-WR650AC,qca955x))
 
 $(eval $(call SingleProfile,UBDEV,64kraw,UBDEV01,ubdev01,UBNT-UF,ttyS0,115200,XM,XM,ar7240))
 
@@ -2047,6 +2288,13 @@ $(eval $(call SingleProfile,ZyXEL,64k,NB
 $(eval $(call MultiProfile,AP121,AP121_2M AP121_4M))
 $(eval $(call MultiProfile,DIR615IX,DIR615I1 DIR615I3))
 $(eval $(call MultiProfile,AP136,AP136_010 AP136_020))
+$(eval $(call MultiProfile,AP143,AP143_8M AP143_16M))
+$(eval $(call MultiProfile,AP147,AP147_010))
+$(eval $(call MultiProfile,AP152,AP152_16M))
+$(eval $(call MultiProfile,GB_CGW600,GB_CGW600_16M))
+$(eval $(call MultiProfile,GB_CGW800,GB_CGW800_16M))
+$(eval $(call MultiProfile,GB_TA2025AC,GB_TA2025AC_16M))
+$(eval $(call MultiProfile,GB_OA5025,GB_OA5025_16M))
 $(eval $(call MultiProfile,EWDORIN, EWDORINAP EWDORINRT EWDORIN16M))
 $(eval $(call MultiProfile,OPENMESH,OM2P OM5P MR600 MR900))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
diff -urpN target_orig/linux/ar71xx/patches-3.18/1000-01-ar71xx-send-wan-plug-event-for-hotplug.patch target/linux/ar71xx/patches-3.18/1000-01-ar71xx-send-wan-plug-event-for-hotplug.patch
--- target_orig/linux/ar71xx/patches-3.18/1000-01-ar71xx-send-wan-plug-event-for-hotplug.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/1000-01-ar71xx-send-wan-plug-event-for-hotplug.patch	2016-07-18 09:34:17.013095086 +0800
@@ -0,0 +1,33 @@
+--- a/drivers/net/ethernet/atheros/ag71xx/ag71xx_phy.c
++++ b/drivers/net/ethernet/atheros/ag71xx/ag71xx_phy.c
+@@ -19,6 +19,8 @@ static void ag71xx_phy_link_adjust(struc
+ 	struct phy_device *phydev = ag->phy_dev;
+ 	unsigned long flags;
+ 	int status_change = 0;
++	char port_num[32];
++	char *envp[] = {port_num, NULL};
+ 
+ 	spin_lock_irqsave(&ag->lock, flags);
+ 
+@@ -37,7 +39,20 @@ static void ag71xx_phy_link_adjust(struc
+ 	ag->speed = phydev->speed;
+ 
+ 	if (status_change)
+-		ag71xx_link_adjust(ag);
++        {     /*modify by chenzejun 20160419 for wan hotplug */
++            if (ag->link) 
++            {  
++                //PORT_ID is 0 to be consistent with ralink drivers
++                snprintf(port_num, sizeof(port_num), "PORT_ID=%d", 0);
++                kobject_uevent_env(&dev->dev.kobj, KOBJ_ONLINE, envp);
++            }
++            else
++            {
++                snprintf(port_num, sizeof(port_num), "PORT_ID=%d", 0);
++                kobject_uevent_env(&dev->dev.kobj, KOBJ_OFFLINE, envp);
++            }
++	    ag71xx_link_adjust(ag);
++        }
+ 
+ 	spin_unlock_irqrestore(&ag->lock, flags);
+ }
diff -urpN target_orig/linux/ar71xx/patches-3.18/614-MIPS-ath79-wdt-timeout.patch target/linux/ar71xx/patches-3.18/614-MIPS-ath79-wdt-timeout.patch
--- target_orig/linux/ar71xx/patches-3.18/614-MIPS-ath79-wdt-timeout.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/614-MIPS-ath79-wdt-timeout.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,54 @@
+--- a/drivers/watchdog/ath79_wdt.c	2014-06-23 23:35:55.747047338 -0400
++++ b/drivers/watchdog/ath79_wdt.c	2014-06-23 21:29:47.793775345 -0400
+@@ -38,6 +38,12 @@
+ 
+ #define DRIVER_NAME	"ath79-wdt"
+ 
++#ifdef CONFIG_ATH79_MACH_COMFAST
++void ath79_external_wdt_trigger(void);
++void ath79_external_wdt_set_timeout(int timeout);
++void ath79_external_wdt_disable(void);
++#endif
++
+ #define WDT_TIMEOUT	15	/* seconds */
+ 
+ #define WDOG_REG_CTRL		0x00
+@@ -86,6 +92,9 @@
+ 	ath79_wdt_wr(WDOG_REG_TIMER, wdt_freq * timeout);
+ 	/* flush write */
+ 	ath79_wdt_rr(WDOG_REG_TIMER);
++#ifdef CONFIG_ATH79_MACH_COMFAST
++	ath79_external_wdt_trigger();
++#endif
+ }
+ 
+ static inline void ath79_wdt_enable(void)
+@@ -101,6 +110,9 @@
+ 	ath79_wdt_wr(WDOG_REG_CTRL, WDOG_CTRL_ACTION_NONE);
+ 	/* flush write */
+ 	ath79_wdt_rr(WDOG_REG_CTRL);
++#ifdef CONFIG_ATH79_MACH_COMFAST
++	ath79_external_wdt_disable();
++#endif
+ }
+ 
+ static int ath79_wdt_set_timeout(int val)
+@@ -108,11 +120,17 @@
+ 	if (val < 1)
+ 		return -EINVAL;
+ 
+-	if (val > max_timeout)
++	if (val > max_timeout) {
++		printk(KERN_ERR "Watchdog timeout exceeds, using %d\n", max_timeout);
+ 		timeout = max_timeout;
++	}
+ 	else
+ 		timeout = val;
+ 
++#ifdef CONFIG_ATH79_MACH_COMFAST
++	ath79_external_wdt_set_timeout(timeout);
++#endif
++
+ 	ath79_wdt_keepalive();
+ 
+ 	return 0;
diff -urpN target_orig/linux/ar71xx/patches-3.18/707-MIPS-ath79-add-support-for-QCA953x-SoC.patch target/linux/ar71xx/patches-3.18/707-MIPS-ath79-add-support-for-QCA953x-SoC.patch
--- target_orig/linux/ar71xx/patches-3.18/707-MIPS-ath79-add-support-for-QCA953x-SoC.patch	2016-06-17 15:12:18.452786375 +0800
+++ target/linux/ar71xx/patches-3.18/707-MIPS-ath79-add-support-for-QCA953x-SoC.patch	2016-07-18 09:34:17.017095088 +0800
@@ -22,7 +22,7 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
 
 --- a/arch/mips/ath79/Kconfig
 +++ b/arch/mips/ath79/Kconfig
-@@ -1248,6 +1248,10 @@ config SOC_AR934X
+@@ -1266,6 +1266,10 @@ config SOC_AR934X
  	select PCI_AR724X if PCI
  	def_bool n
  
@@ -33,7 +33,7 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  config SOC_QCA955X
  	select HW_HAS_PCI
  	select PCI_AR724X if PCI
-@@ -1290,7 +1294,7 @@ config ATH79_DEV_USB
+@@ -1308,7 +1312,7 @@ config ATH79_DEV_USB
  	def_bool n
  
  config ATH79_DEV_WMAC
@@ -175,6 +175,48 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  	    soc_is_qca955x()) {
  		ath79_uart_data[0].uartclk = uart_clk_rate;
  		platform_device_register(&ath79_uart_device);
+--- a/arch/mips/ath79/dev-usb.c
++++ b/arch/mips/ath79/dev-usb.c
+@@ -236,6 +236,30 @@ static void __init ar934x_usb_setup(void
+ 			   &ath79_ehci_pdata_v2, sizeof(ath79_ehci_pdata_v2));
+ }
+ 
++static void __init qca953x_usb_setup(void)
++{
++	u32 bootstrap;
++
++	bootstrap = ath79_reset_rr(QCA953X_RESET_REG_BOOTSTRAP);
++
++	ath79_device_reset_set(QCA953X_RESET_USBSUS_OVERRIDE);
++	udelay(1000);
++
++	ath79_device_reset_clear(QCA953X_RESET_USB_PHY);
++	udelay(1000);
++
++	ath79_device_reset_clear(QCA953X_RESET_USB_PHY_ANALOG);
++	udelay(1000);
++
++	ath79_device_reset_clear(QCA953X_RESET_USB_HOST);
++	udelay(1000);
++
++	ath79_usb_register("ehci-platform", -1,
++			   QCA953X_EHCI_BASE, QCA953X_EHCI_SIZE,
++			   ATH79_CPU_IRQ(3),
++			   &ath79_ehci_pdata_v2, sizeof(ath79_ehci_pdata_v2));
++}
++
+ static void qca955x_usb_reset_notifier(struct platform_device *pdev)
+ {
+ 	u32 base;
+@@ -286,6 +310,8 @@ void __init ath79_register_usb(void)
+ 		ar933x_usb_setup();
+ 	else if (soc_is_ar934x())
+ 		ar934x_usb_setup();
++	else if (soc_is_qca953x())
++		qca953x_usb_setup();
+ 	else if (soc_is_qca955x())
+ 		qca955x_usb_setup();
+ 	else
 --- a/arch/mips/ath79/dev-wmac.c
 +++ b/arch/mips/ath79/dev-wmac.c
 @@ -101,7 +101,7 @@ static int ar933x_wmac_reset(void)
@@ -207,8 +249,8 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
 +
 +	ath79_wmac_resources[0].start = QCA953X_WMAC_BASE;
 +	ath79_wmac_resources[0].end = QCA953X_WMAC_BASE + QCA953X_WMAC_SIZE - 1;
-+	ath79_wmac_resources[1].start = ATH79_CPU_IRQ(2);
-+	ath79_wmac_resources[1].end = ATH79_CPU_IRQ(2);
++	ath79_wmac_resources[1].start = ATH79_IP2_IRQ(1);
++	ath79_wmac_resources[1].end = ATH79_IP2_IRQ(1);
 +
 +	t = ath79_reset_rr(QCA953X_RESET_REG_BOOTSTRAP);
 +	if (t & QCA953X_BOOTSTRAP_REF_CLK_40)
@@ -233,7 +275,7 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  	else
 --- a/arch/mips/ath79/early_printk.c
 +++ b/arch/mips/ath79/early_printk.c
-@@ -114,6 +114,8 @@ static void prom_putchar_init(void)
+@@ -116,6 +116,8 @@ static void prom_putchar_init(void)
  	case REV_ID_MAJOR_AR9341:
  	case REV_ID_MAJOR_AR9342:
  	case REV_ID_MAJOR_AR9344:
@@ -272,16 +314,77 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  		 soc_is_qca955x())
  		ath79_misc_irq_chip.irq_ack = ar724x_misc_irq_ack;
  	else
-@@ -352,6 +353,9 @@ void __init arch_init_irq(void)
+@@ -153,6 +154,38 @@ static void ar934x_ip2_irq_init(void)
+ 	irq_set_chained_handler(ATH79_CPU_IRQ(2), ar934x_ip2_irq_dispatch);
+ }
+ 
++static void qca953x_ip2_irq_dispatch(unsigned int irq, struct irq_desc *desc)
++{
++	u32 status;
++
++	disable_irq_nosync(irq);
++
++	status = ath79_reset_rr(QCA953X_RESET_REG_PCIE_WMAC_INT_STATUS);
++
++	if (status & QCA953X_PCIE_WMAC_INT_PCIE_ALL) {
++		ath79_ddr_wb_flush(QCA953X_DDR_REG_FLUSH_PCIE);
++		generic_handle_irq(ATH79_IP2_IRQ(0));
++	} else if (status & QCA953X_PCIE_WMAC_INT_WMAC_ALL) {
++		ath79_ddr_wb_flush(QCA953X_DDR_REG_FLUSH_WMAC);
++		generic_handle_irq(ATH79_IP2_IRQ(1));
++	} else {
++		spurious_interrupt();
++	}
++
++	enable_irq(irq);
++}
++
++static void qca953x_irq_init(void)
++{
++	int i;
++
++	for (i = ATH79_IP2_IRQ_BASE;
++	     i < ATH79_IP2_IRQ_BASE + ATH79_IP2_IRQ_COUNT; i++)
++		irq_set_chip_and_handler(i, &dummy_irq_chip, handle_level_irq);
++
++	irq_set_chained_handler(ATH79_CPU_IRQ(2), qca953x_ip2_irq_dispatch);
++}
++
+ static void qca955x_ip2_irq_dispatch(unsigned int irq, struct irq_desc *desc)
+ {
+ 	u32 status;
+@@ -335,6 +368,12 @@ static void ar934x_ip3_handler(void)
+ 	do_IRQ(ATH79_CPU_IRQ(3));
+ }
+ 
++static void qca953x_ip3_handler(void)
++{
++	ath79_ddr_wb_flush(QCA953X_DDR_REG_FLUSH_USB);
++	do_IRQ(ATH79_CPU_IRQ(3));
++}
++
+ void __init arch_init_irq(void)
+ {
+ 	if (soc_is_ar71xx()) {
+@@ -352,6 +391,9 @@ void __init arch_init_irq(void)
  	} else if (soc_is_ar934x()) {
  		ath79_ip2_handler = ath79_default_ip2_handler;
  		ath79_ip3_handler = ar934x_ip3_handler;
 +	} else if (soc_is_qca953x()) {
 +		ath79_ip2_handler = ath79_default_ip2_handler;
-+		ath79_ip3_handler = ath79_default_ip3_handler;
++		ath79_ip3_handler = qca953x_ip3_handler;
  	} else if (soc_is_qca955x()) {
  		ath79_ip2_handler = ath79_default_ip2_handler;
  		ath79_ip3_handler = ath79_default_ip3_handler;
+@@ -365,6 +407,8 @@ void __init arch_init_irq(void)
+ 
+ 	if (soc_is_ar934x())
+ 		ar934x_ip2_irq_init();
++	else if (soc_is_qca953x())
++		qca953x_irq_init();
+ 	else if (soc_is_qca955x())
+ 		qca955x_irq_init();
+ }
 --- a/arch/mips/ath79/setup.c
 +++ b/arch/mips/ath79/setup.c
 @@ -59,6 +59,7 @@ static void __init ath79_detect_sys_type
@@ -324,23 +427,49 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  	pr_info("SoC: %s\n", ath79_sys_type);
 --- a/arch/mips/include/asm/mach-ath79/ar71xx_regs.h
 +++ b/arch/mips/include/asm/mach-ath79/ar71xx_regs.h
-@@ -105,6 +105,9 @@
+@@ -105,6 +105,21 @@
  #define AR934X_SRIF_BASE	(AR71XX_APB_BASE + 0x00116000)
  #define AR934X_SRIF_SIZE	0x1000
  
++#define QCA953X_GMAC_BASE	(AR71XX_APB_BASE + 0x00070000)
++#define QCA953X_GMAC_SIZE	0x14
 +#define QCA953X_WMAC_BASE	(AR71XX_APB_BASE + 0x00100000)
 +#define QCA953X_WMAC_SIZE	0x20000
++#define QCA953X_EHCI_BASE	0x1b000000
++#define QCA953X_EHCI_SIZE	0x200
++#define QCA953X_SRIF_BASE	(AR71XX_APB_BASE + 0x00116000)
++#define QCA953X_SRIF_SIZE	0x1000
++
++#define QCA953X_PCI_CFG_BASE0	0x14000000
++#define QCA953X_PCI_CTRL_BASE0	(AR71XX_APB_BASE + 0x000f0000)
++#define QCA953X_PCI_CRP_BASE0	(AR71XX_APB_BASE + 0x000c0000)
++#define QCA953X_PCI_MEM_BASE0	0x10000000
++#define QCA953X_PCI_MEM_SIZE	0x02000000
 +
  #define QCA955X_PCI_MEM_BASE0	0x10000000
  #define QCA955X_PCI_MEM_BASE1	0x12000000
  #define QCA955X_PCI_MEM_SIZE	0x02000000
-@@ -279,6 +282,43 @@
+@@ -173,6 +188,12 @@
+ #define AR934X_DDR_REG_FLUSH_PCIE	0xa8
+ #define AR934X_DDR_REG_FLUSH_WMAC	0xac
+ 
++#define QCA953X_DDR_REG_FLUSH_GE0	0x9c
++#define QCA953X_DDR_REG_FLUSH_GE1	0xa0
++#define QCA953X_DDR_REG_FLUSH_USB	0xa4
++#define QCA953X_DDR_REG_FLUSH_PCIE	0xa8
++#define QCA953X_DDR_REG_FLUSH_WMAC	0xac
++
+ /*
+  * PLL block
+  */
+@@ -279,6 +300,44 @@
  
  #define AR934X_PLL_SWITCH_CLOCK_CONTROL_MDIO_CLK_SEL	BIT(6)
  
 +#define QCA953X_PLL_CPU_CONFIG_REG		0x00
 +#define QCA953X_PLL_DDR_CONFIG_REG		0x04
 +#define QCA953X_PLL_CLK_CTRL_REG		0x08
++#define QCA953X_PLL_SWITCH_CLOCK_CONTROL_REG	0x24
 +#define QCA953X_PLL_ETH_XMII_CONTROL_REG	0x2c
 +#define QCA953X_PLL_ETH_SGMII_CONTROL_REG	0x48
 +
@@ -351,7 +480,7 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
 +#define QCA953X_PLL_CPU_CONFIG_REFDIV_SHIFT	12
 +#define QCA953X_PLL_CPU_CONFIG_REFDIV_MASK	0x1f
 +#define QCA953X_PLL_CPU_CONFIG_OUTDIV_SHIFT	19
-+#define QCA953X_PLL_CPU_CONFIG_OUTDIV_MASK	0x3
++#define QCA953X_PLL_CPU_CONFIG_OUTDIV_MASK	0x7
 +
 +#define QCA953X_PLL_DDR_CONFIG_NFRAC_SHIFT	0
 +#define QCA953X_PLL_DDR_CONFIG_NFRAC_MASK	0x3ff
@@ -378,27 +507,85 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  #define QCA955X_PLL_CPU_CONFIG_REG		0x00
  #define QCA955X_PLL_DDR_CONFIG_REG		0x04
  #define QCA955X_PLL_CLK_CTRL_REG		0x08
-@@ -355,6 +395,10 @@
+@@ -355,6 +414,10 @@
  #define AR934X_RESET_REG_BOOTSTRAP		0xb0
  #define AR934X_RESET_REG_PCIE_WMAC_INT_STATUS	0xac
  
 +#define QCA953X_RESET_REG_RESET_MODULE		0x1c
 +#define QCA953X_RESET_REG_BOOTSTRAP		0xb0
-+#define QCA953X_RESET_REG_EXT_INT_STATUS	0xac
++#define QCA953X_RESET_REG_PCIE_WMAC_INT_STATUS	0xac
 +
  #define QCA955X_RESET_REG_RESET_MODULE		0x1c
  #define QCA955X_RESET_REG_BOOTSTRAP		0xb0
  #define QCA955X_RESET_REG_EXT_INT_STATUS	0xac
-@@ -503,6 +547,8 @@
+@@ -450,6 +513,27 @@
+ #define AR934X_RESET_MBOX		BIT(1)
+ #define AR934X_RESET_I2S		BIT(0)
+ 
++#define QCA953X_RESET_USB_EXT_PWR	BIT(29)
++#define QCA953X_RESET_EXTERNAL		BIT(28)
++#define QCA953X_RESET_RTC		BIT(27)
++#define QCA953X_RESET_FULL_CHIP		BIT(24)
++#define QCA953X_RESET_GE1_MDIO		BIT(23)
++#define QCA953X_RESET_GE0_MDIO		BIT(22)
++#define QCA953X_RESET_CPU_NMI		BIT(21)
++#define QCA953X_RESET_CPU_COLD		BIT(20)
++#define QCA953X_RESET_DDR		BIT(16)
++#define QCA953X_RESET_USB_PHY_PLL_PWD_EXT BIT(15)
++#define QCA953X_RESET_GE1_MAC		BIT(13)
++#define QCA953X_RESET_ETH_SWITCH_ANALOG	BIT(12)
++#define QCA953X_RESET_USB_PHY_ANALOG	BIT(11)
++#define QCA953X_RESET_GE0_MAC		BIT(9)
++#define QCA953X_RESET_ETH_SWITCH	BIT(8)
++#define QCA953X_RESET_PCIE_PHY		BIT(7)
++#define QCA953X_RESET_PCIE		BIT(6)
++#define QCA953X_RESET_USB_HOST		BIT(5)
++#define QCA953X_RESET_USB_PHY		BIT(4)
++#define QCA953X_RESET_USBSUS_OVERRIDE	BIT(3)
++
+ #define QCA955X_RESET_HOST		BIT(31)
+ #define QCA955X_RESET_SLIC		BIT(30)
+ #define QCA955X_RESET_HDMA		BIT(29)
+@@ -503,6 +587,13 @@
  #define AR934X_BOOTSTRAP_SDRAM_DISABLED BIT(1)
  #define AR934X_BOOTSTRAP_DDR1		BIT(0)
  
++#define QCA953X_BOOTSTRAP_SW_OPTION2	BIT(12)
++#define QCA953X_BOOTSTRAP_SW_OPTION1	BIT(11)
++#define QCA953X_BOOTSTRAP_EJTAG_MODE	BIT(5)
 +#define QCA953X_BOOTSTRAP_REF_CLK_40	BIT(4)
++#define QCA953X_BOOTSTRAP_SDRAM_DISABLED BIT(1)
++#define QCA953X_BOOTSTRAP_DDR1		BIT(0)
 +
  #define QCA955X_BOOTSTRAP_REF_CLK_40	BIT(4)
  
  #define AR934X_PCIE_WMAC_INT_WMAC_MISC		BIT(0)
-@@ -565,6 +611,8 @@
+@@ -523,6 +614,24 @@
+ 	 AR934X_PCIE_WMAC_INT_PCIE_RC1 | AR934X_PCIE_WMAC_INT_PCIE_RC2 | \
+ 	 AR934X_PCIE_WMAC_INT_PCIE_RC3)
+ 
++#define QCA953X_PCIE_WMAC_INT_WMAC_MISC		BIT(0)
++#define QCA953X_PCIE_WMAC_INT_WMAC_TX		BIT(1)
++#define QCA953X_PCIE_WMAC_INT_WMAC_RXLP		BIT(2)
++#define QCA953X_PCIE_WMAC_INT_WMAC_RXHP		BIT(3)
++#define QCA953X_PCIE_WMAC_INT_PCIE_RC		BIT(4)
++#define QCA953X_PCIE_WMAC_INT_PCIE_RC0		BIT(5)
++#define QCA953X_PCIE_WMAC_INT_PCIE_RC1		BIT(6)
++#define QCA953X_PCIE_WMAC_INT_PCIE_RC2		BIT(7)
++#define QCA953X_PCIE_WMAC_INT_PCIE_RC3		BIT(8)
++#define QCA953X_PCIE_WMAC_INT_WMAC_ALL \
++	(QCA953X_PCIE_WMAC_INT_WMAC_MISC | QCA953X_PCIE_WMAC_INT_WMAC_TX | \
++	 QCA953X_PCIE_WMAC_INT_WMAC_RXLP | QCA953X_PCIE_WMAC_INT_WMAC_RXHP)
++
++#define QCA953X_PCIE_WMAC_INT_PCIE_ALL \
++	(QCA953X_PCIE_WMAC_INT_PCIE_RC | QCA953X_PCIE_WMAC_INT_PCIE_RC0 | \
++	 QCA953X_PCIE_WMAC_INT_PCIE_RC1 | QCA953X_PCIE_WMAC_INT_PCIE_RC2 | \
++	 QCA953X_PCIE_WMAC_INT_PCIE_RC3)
++
+ #define QCA955X_EXT_INT_WMAC_MISC		BIT(0)
+ #define QCA955X_EXT_INT_WMAC_TX			BIT(1)
+ #define QCA955X_EXT_INT_WMAC_RXLP		BIT(2)
+@@ -565,6 +674,8 @@
  #define REV_ID_MAJOR_AR9341		0x0120
  #define REV_ID_MAJOR_AR9342		0x1120
  #define REV_ID_MAJOR_AR9344		0x2120
@@ -407,7 +594,7 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  #define REV_ID_MAJOR_QCA9556		0x0130
  #define REV_ID_MAJOR_QCA9558		0x1130
  
-@@ -587,6 +635,8 @@
+@@ -587,6 +698,8 @@
  
  #define AR934X_REV_ID_REVISION_MASK	0xf
  
@@ -416,7 +603,32 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  #define QCA955X_REV_ID_REVISION_MASK	0xf
  
  /*
-@@ -640,6 +690,7 @@
+@@ -634,12 +747,32 @@
+ #define AR934X_GPIO_REG_OUT_FUNC5	0x40
+ #define AR934X_GPIO_REG_FUNC		0x6c
+ 
++#define QCA953X_GPIO_REG_OUT_FUNC0	0x2c
++#define QCA953X_GPIO_REG_OUT_FUNC1	0x30
++#define QCA953X_GPIO_REG_OUT_FUNC2	0x34
++#define QCA953X_GPIO_REG_OUT_FUNC3	0x38
++#define QCA953X_GPIO_REG_OUT_FUNC4	0x3c
++#define QCA953X_GPIO_REG_IN_ENABLE0	0x44
++#define QCA953X_GPIO_REG_FUNC		0x6c
++
++#define QCA953X_GPIO_OUT_MUX_SPI_CS1		10
++#define QCA953X_GPIO_OUT_MUX_SPI_CS2		11
++#define QCA953X_GPIO_OUT_MUX_SPI_CS0		9
++#define QCA953X_GPIO_OUT_MUX_SPI_CLK		8
++#define QCA953X_GPIO_OUT_MUX_SPI_MOSI		12
++#define QCA953X_GPIO_OUT_MUX_LED_LINK1		41
++#define QCA953X_GPIO_OUT_MUX_LED_LINK2		42
++#define QCA953X_GPIO_OUT_MUX_LED_LINK3		43
++#define QCA953X_GPIO_OUT_MUX_LED_LINK4		44
++#define QCA953X_GPIO_OUT_MUX_LED_LINK5		45
++
+ #define AR71XX_GPIO_COUNT		16
+ #define AR7240_GPIO_COUNT		18
+ #define AR7241_GPIO_COUNT		20
  #define AR913X_GPIO_COUNT		22
  #define AR933X_GPIO_COUNT		30
  #define AR934X_GPIO_COUNT		23
@@ -424,6 +636,48 @@ meaning of the bits CPUCLK_FROM_CPUPLL a
  #define QCA955X_GPIO_COUNT		24
  
  /*
+@@ -663,6 +796,24 @@
+ #define AR934X_SRIF_DPLL2_OUTDIV_SHIFT	13
+ #define AR934X_SRIF_DPLL2_OUTDIV_MASK	0x7
+ 
++#define QCA953X_SRIF_CPU_DPLL1_REG	0x1c0
++#define QCA953X_SRIF_CPU_DPLL2_REG	0x1c4
++#define QCA953X_SRIF_CPU_DPLL3_REG	0x1c8
++
++#define QCA953X_SRIF_DDR_DPLL1_REG	0x240
++#define QCA953X_SRIF_DDR_DPLL2_REG	0x244
++#define QCA953X_SRIF_DDR_DPLL3_REG	0x248
++
++#define QCA953X_SRIF_DPLL1_REFDIV_SHIFT	27
++#define QCA953X_SRIF_DPLL1_REFDIV_MASK	0x1f
++#define QCA953X_SRIF_DPLL1_NINT_SHIFT	18
++#define QCA953X_SRIF_DPLL1_NINT_MASK	0x1ff
++#define QCA953X_SRIF_DPLL1_NFRAC_MASK	0x0003ffff
++
++#define QCA953X_SRIF_DPLL2_LOCAL_PLL	BIT(30)
++#define QCA953X_SRIF_DPLL2_OUTDIV_SHIFT	13
++#define QCA953X_SRIF_DPLL2_OUTDIV_MASK	0x7
++
+ #define AR71XX_GPIO_FUNC_STEREO_EN		BIT(17)
+ #define AR71XX_GPIO_FUNC_SLIC_EN		BIT(16)
+ #define AR71XX_GPIO_FUNC_SPI_CS2_EN		BIT(13)
+@@ -804,6 +955,16 @@
+ #define AR934X_ETH_CFG_RDV_DELAY_SHIFT  16
+ 
+ /*
++ * QCA953X GMAC Interface
++ */
++#define QCA953X_GMAC_REG_ETH_CFG		0x00
++
++#define QCA953X_ETH_CFG_SW_ONLY_MODE		BIT(6)
++#define QCA953X_ETH_CFG_SW_PHY_SWAP		BIT(7)
++#define QCA953X_ETH_CFG_SW_APB_ACCESS		BIT(9)
++#define QCA953X_ETH_CFG_SW_ACC_MSB_FIRST	BIT(13)
++
++/*
+  * QCA955X GMAC Interface
+  */
+ 
 --- a/arch/mips/include/asm/mach-ath79/ath79.h
 +++ b/arch/mips/include/asm/mach-ath79/ath79.h
 @@ -32,6 +32,7 @@ enum ath79_soc_type {
diff -urpN target_orig/linux/ar71xx/patches-3.18/739-MIPS-ath79-disable-bug-on.patch target/linux/ar71xx/patches-3.18/739-MIPS-ath79-disable-bug-on.patch
--- target_orig/linux/ar71xx/patches-3.18/739-MIPS-ath79-disable-bug-on.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/739-MIPS-ath79-disable-bug-on.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,11 @@
+--- a//arch/mips/ath79/gpio.c
++++ b//arch/mips/ath79/gpio.c
+@@ -188,7 +188,7 @@ void __init ath79_gpio_output_select(unsigned gpio, u8 val)
+ 	unsigned int reg;
+ 	u32 t, s;
+ 
+-	BUG_ON(!soc_is_ar934x());
++	//BUG_ON(!soc_is_ar934x());
+ 
+ 	if (gpio >= AR934X_GPIO_COUNT)
+ 		return;
diff -urpN target_orig/linux/ar71xx/patches-3.18/740-MIPS-ath79-fix-gpio-get-function-req.patch target/linux/ar71xx/patches-3.18/740-MIPS-ath79-fix-gpio-get-function-req.patch
--- target_orig/linux/ar71xx/patches-3.18/740-MIPS-ath79-fix-gpio-get-function-req.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/740-MIPS-ath79-fix-gpio-get-function-req.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,12 @@
+--- a/arch/mips/ath79/gpio.c
++++ b/arch/mips/ath79/gpio.c
+@@ -149,7 +149,8 @@ static void __iomem *ath79_gpio_get_function_reg(void)
+ 	    soc_is_ar933x())
+ 		reg = AR71XX_GPIO_REG_FUNC;
+ 	else if (soc_is_ar934x() ||
+-		 soc_is_qca956x())
++		 soc_is_qca956x() ||
++		 soc_is_qca953x())
+ 		reg = AR934X_GPIO_REG_FUNC;
+ 	else
+ 		BUG();
diff -urpN target_orig/linux/ar71xx/patches-3.18/908-MIPS-ath79-add-KT9661-support.patch target/linux/ar71xx/patches-3.18/908-MIPS-ath79-add-KT9661-support.patch
--- target_orig/linux/ar71xx/patches-3.18/908-MIPS-ath79-add-KT9661-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/908-MIPS-ath79-add-KT9661-support.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,41 @@
+Index: linux-3.18.23/arch/mips/ath79/Kconfig
+===================================================================
+--- linux-3.18.23.orig/arch/mips/ath79/Kconfig	2016-03-14 14:30:25.093985607 +0900
++++ linux-3.18.23/arch/mips/ath79/Kconfig	2016-03-14 14:30:25.205985605 +0900
+@@ -1318,6 +1318,15 @@
+ 	select ATH79_DEV_USB
+ 	select ATH79_NVRAM
+ 
++config ATH79_MACH_KT9661
++	bool "KunTeng Foxconn KT9661 support"
++	select SOC_QCA955X
++	select ATH79_DEV_ETH
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_WMAC
++
+ endmenu
+ 
+ config SOC_AR71XX
+Index: linux-3.18.23/arch/mips/ath79/Makefile
+===================================================================
+--- linux-3.18.23.orig/arch/mips/ath79/Makefile	2016-03-14 14:30:25.093985607 +0900
++++ linux-3.18.23/arch/mips/ath79/Makefile	2016-03-14 14:30:25.205985605 +0900
+@@ -170,3 +170,4 @@
+ obj-$(CONFIG_ATH79_MACH_ZCN_1523H)	+= mach-zcn-1523h.o
+ obj-$(CONFIG_ATH79_MACH_CARAMBOLA2)	+= mach-carambola2.o
+ obj-$(CONFIG_ATH79_MACH_NBG6716)	+= mach-nbg6716.o
++obj-$(CONFIG_ATH79_MACH_KT9661)	+= mach-kt9661.o
+Index: linux-3.18.23/arch/mips/ath79/machtypes.h
+===================================================================
+--- linux-3.18.23.orig/arch/mips/ath79/machtypes.h	2016-03-14 14:30:25.093985607 +0900
++++ linux-3.18.23/arch/mips/ath79/machtypes.h	2016-03-14 14:35:37.913980005 +0900
+@@ -218,6 +218,7 @@
+ 	ATH79_MACH_WZR_450HP2,		/* Buffalo WZR-450HP2 */
+ 	ATH79_MACH_ZCN_1523H_2,		/* Zcomax ZCN-1523H-2-xx */
+ 	ATH79_MACH_ZCN_1523H_5,		/* Zcomax ZCN-1523H-5-xx */
++	ATH79_MACH_KT9661,	/* KunTeng Foxconn KT9661 */
+ };
+ 
+ #endif /* _ATH79_MACHTYPE_H */
diff -urpN target_orig/linux/ar71xx/patches-3.18/909-MIPS-arth79-add-dev-m25p80-QCA-32M-support.patch target/linux/ar71xx/patches-3.18/909-MIPS-arth79-add-dev-m25p80-QCA-32M-support.patch
--- target_orig/linux/ar71xx/patches-3.18/909-MIPS-arth79-add-dev-m25p80-QCA-32M-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/909-MIPS-arth79-add-dev-m25p80-QCA-32M-support.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,33 @@
+diff -urN linux-3.18.23.orig/arch/mips/ath79/dev-m25p80.c linux-3.18.23/arch/mips/ath79/dev-m25p80.c
+--- linux-3.18.23.orig/arch/mips/ath79/dev-m25p80.c	2016-05-11 16:35:01.876778446 +0800
++++ linux-3.18.23/arch/mips/ath79/dev-m25p80.c	2016-05-11 16:35:50.020634661 +0800
+@@ -56,6 +56,17 @@
+ 	ath79_register_spi(&ath79_spi_data, ath79_spi_info, 1);
+ }
+ 
++/* gukq add 20160510 support for other qca routers */
++void __init ath79_register_m25p80_32M(struct flash_platform_data *pdata)
++{
++	ath79_spi_data.bus_num = 0;
++	ath79_spi_data.num_chipselect = 1;
++	ath79_spi0_cdata.is_flash = false;  //Feng
++	ath79_spi_info[0].platform_data = pdata;
++	ath79_register_spi(&ath79_spi_data, ath79_spi_info, 1);
++}
++/* gukq added over */
++
+ static struct flash_platform_data *multi_pdata;
+ 
+ static struct mtd_info *concat_devs[2] = { NULL, NULL };
+diff -urN linux-3.18.23.orig/arch/mips/ath79/dev-m25p80.h linux-3.18.23/arch/mips/ath79/dev-m25p80.h
+--- linux-3.18.23.orig/arch/mips/ath79/dev-m25p80.h	2016-05-11 16:59:15.904718122 +0800
++++ linux-3.18.23/arch/mips/ath79/dev-m25p80.h	2016-05-11 16:59:48.964757409 +0800
+@@ -14,4 +14,8 @@
+ void ath79_register_m25p80(struct flash_platform_data *pdata) __init;
+ void ath79_register_m25p80_multi(struct flash_platform_data *pdata) __init;
+ 
++/* gukq add 20160510 */
++void ath79_register_m25p80_32M(struct flash_platform_data *pdata) __init;
++/* gukq added over */
++
+ #endif /* _ATH79_DEV_M25P80_H */
diff -urpN target_orig/linux/ar71xx/patches-3.18/920-mtd-m25p80-32M-support.patch target/linux/ar71xx/patches-3.18/920-mtd-m25p80-32M-support.patch
--- target_orig/linux/ar71xx/patches-3.18/920-mtd-m25p80-32M-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/920-mtd-m25p80-32M-support.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,28 @@
+Index: linux-3.18.23/drivers/mtd/devices/m25p80.c
+===================================================================
+--- linux-3.18.23.orig/drivers/mtd/devices/m25p80.c
++++ linux-3.18.23/drivers/mtd/devices/m25p80.c
+@@ -264,6 +264,14 @@ static int m25p_remove(struct spi_device
+ {
+ 	struct m25p	*flash = spi_get_drvdata(spi);
+ 
++/* foxconn miles hsu add for 32M flash*/
++	flash->command[0] = 0xe9;  
++	spi_write(flash->spi, flash->command, 1);  
++/*	flash->command[0] = 0x66;  
++	spi_write(flash->spi, flash->command, 1);  
++	flash->command[0] = 0x99;  
++	spi_write(flash->spi, flash->command, 1);  
++*/	
+ 	/* Clean up MTD stuff. */
+ 	return mtd_device_unregister(&flash->mtd);
+ }
+@@ -327,6 +335,8 @@ static struct spi_driver m25p80_driver =
+ 	.id_table	= m25p_ids,
+ 	.probe	= m25p_probe,
+ 	.remove	= m25p_remove,
++/* foxconn miles hsu add for 32M flash*/
++	.shutdown = m25p_remove,
+ 
+ 	/* REVISIT: many of these chips have deep power-down modes, which
+ 	 * should clearly be entered on suspend() to minimize power use.
diff -urpN target_orig/linux/ar71xx/patches-3.18/931-linux-netlink-h-support-qca-driver.patch target/linux/ar71xx/patches-3.18/931-linux-netlink-h-support-qca-driver.patch
--- target_orig/linux/ar71xx/patches-3.18/931-linux-netlink-h-support-qca-driver.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/931-linux-netlink-h-support-qca-driver.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,21 @@
+--- a/include/net/netlink.h
++++ b/include/net/netlink.h
+@@ -1186,3 +1186,18 @@ static inline int nla_validate_nested(co
+ 	nla_for_each_attr(pos, nla_data(nla), nla_len(nla), rem)
+ 
+ #endif
++//proc.zhu
++#define NLA_PUT(skb, attrtype, attrlen, data) \
++	do { \
++		if (unlikely(nla_put(skb, attrtype, attrlen, data) < 0)) \
++			goto nla_put_failure; \
++	} while(0)
++
++#define NLA_PUT_TYPE(skb, type, attrtype, value) \
++	do { \
++		type __tmp = value; \
++		NLA_PUT(skb, attrtype, sizeof(type), &__tmp); \
++	} while(0)
++
++#define NLA_PUT_STRING(skb, attrtype, value) \
++	NLA_PUT(skb, attrtype, strlen(value) + 1, value)
diff -urpN target_orig/linux/ar71xx/patches-3.18/940-MIPS-ath79-add-comfast-support.patch target/linux/ar71xx/patches-3.18/940-MIPS-ath79-add-comfast-support.patch
--- target_orig/linux/ar71xx/patches-3.18/940-MIPS-ath79-add-comfast-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/940-MIPS-ath79-add-comfast-support.patch	2016-07-18 09:34:17.013095086 +0800
@@ -0,0 +1,105 @@
+diff -urN a/arch/mips/ath79/machtypes.h b/arch/mips/ath79/machtypes.h
+--- a/arch/mips/ath79/machtypes.h	2016-05-11 18:14:53.869056973 +0800
++++ b/arch/mips/ath79/machtypes.h	2016-05-11 18:15:19.713050408 +0800
+@@ -40,6 +40,19 @@
+ 	ATH79_MACH_BSB,			/* Smart Electronics Black Swift board */
+ 	ATH79_MACH_CAP4200AG,		/* Senao CAP4200AG */
+ 	ATH79_MACH_CARAMBOLA2,		/* 8devices Carambola2 */
++	ATH79_MACH_COMFAST_AP9341FE,	/* COMFAST AP9341FE */
++	ATH79_MACH_COMFAST_CF_E316NV2,	/* COMFAST CF-E316NV2 */
++	ATH79_MACH_COMFAST_CF_E325N,	/* COMFAST CF-E325N */
++	ATH79_MACH_KUNTENG_KT9671,	/* COMFAST CF-E350N gukq renamed it KT9671 20160527*/
++	ATH79_MACH_KUNTENG_KT9672,	/* COMFAST CF-E355AC gukq renamed it KT9672 20160627*/
++	ATH79_MACH_COMFAST_CF_E380AC,	/* COMFAST CF-E380AC */
++	ATH79_MACH_COMFAST_CF_E520N,	/* COMFAST CF-E520N */
++	ATH79_MACH_COMFAST_CF_E530N,	/* COMFAST CF-E530N */
++	ATH79_MACH_COMFAST_CF_WR600N,	/* COMFAST CF-WR600N */
++	ATH79_MACH_COMFAST_CF_WR605N,	/* COMFAST CF-WR605N */
++	ATH79_MACH_COMFAST_CF_WR610N,	/* COMFAST CF-WR610N */
++	ATH79_MACH_COMFAST_CF_WR615N,	/* COMFAST CF-WR615N */
++	ATH79_MACH_COMFAST_CF_WR650AC,	/* COMFAST CF-WR650AC */
+ 	ATH79_MACH_CPE510,		/* TP-LINK CPE510 */
+ 	ATH79_MACH_DB120,		/* Atheros DB120 reference board */
+ 	ATH79_MACH_PB44,		/* Atheros PB44 reference board */
+ };
+ 
+ #endif /* _ATH79_MACHTYPE_H */
+diff -urN a/arch/mips/ath79/Kconfig b/arch/mips/ath79/Kconfig
+--- a/arch/mips/ath79/Kconfig	2016-05-12 09:50:57.360929635 +0800
++++ b/arch/mips/ath79/Kconfig	2016-05-12 09:49:58.149066746 +0800
+@@ -155,6 +155,60 @@
+ 	select ATH79_DEV_M25P80
+ 	select ATH79_DEV_USB
+ 
++config ATH79_MACH_COMFAST
++	bool "COMFAST reference board"
++	select SOC_AR934X
++	select ATH79_DEV_AP9X_PCI if PCI
++	select ATH79_DEV_ETH
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_NFC
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  Comfast reference board.
++
++config ATH79_MACH_KUNTENG_KT9671
++       bool "COMFAST CF-E325N support"
++       select SOC_QCA953X
++       select ATH79_DEV_ETH
++       select ATH79_DEV_GPIO_BUTTONS
++       select ATH79_DEV_LEDS_GPIO
++       select ATH79_DEV_M25P80
++       select ATH79_DEV_WMAC
++
++config ATH79_MACH_KUNTENG_KT9672
++	bool "COMFAST KT9672 board support"
++	select SOC_QCA953X
++	select ATH79_DEV_ETH
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++
++config ATH79_MACH_COMFAST_CF_E380AC
++	bool "COMFAST CF-E380AC board support"
++	select SOC_QCA955X
++	select ATH79_DEV_ETH
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++
++config ATH79_MACH_COMFAST_CF_WR650AC
++	bool "COMFAST CF-WR650AC board support"
++	select SOC_QCA955X
++	select ATH79_DEV_ETH
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++
+ config ATH79_MACH_DB120
+ 	bool "Atheros DB120 reference board"
+ 	select SOC_AR934X
+diff -urN a/arch/mips/ath79/Makefile b/arch/mips/ath79/Makefile
+--- a/arch/mips/ath79/Makefile	2016-05-12 10:01:15.487586393 +0800
++++ b/arch/mips/ath79/Makefile	2016-05-12 10:01:03.755610919 +0800
+@@ -56,6 +56,11 @@
+ obj-$(CONFIG_ATH79_MACH_BHU_BXU2000N2_A)+= mach-bhu-bxu2000n2-a.o
+ obj-$(CONFIG_ATH79_MACH_BSB)		+= mach-bsb.o
+ obj-$(CONFIG_ATH79_MACH_CAP4200AG)	+= mach-cap4200ag.o
++obj-$(CONFIG_ATH79_MACH_COMFAST)	+= mach-comfast.o
++obj-$(CONFIG_ATH79_MACH_KUNTENG_KT9672)	+= mach-comfast.o
++obj-$(CONFIG_ATH79_MACH_COMFAST_CF_E380AC)	+= mach-comfast.o
++obj-$(CONFIG_ATH79_MACH_COMFAST_CF_WR650AC)	+= mach-comfast.o
++obj-$(CONFIG_ATH79_MACH_KUNTENG_KT9671)	+= mach-comfast.o
+ obj-$(CONFIG_ATH79_MACH_CPE510)		+= mach-cpe510.o
+ obj-$(CONFIG_ATH79_MACH_DB120)		+= mach-db120.o
+ obj-$(CONFIG_ATH79_MACH_DLAN_PRO_500_WP)	+= mach-dlan-pro-500-wp.o
diff -urpN target_orig/linux/ar71xx/patches-3.18/941-MIPS-ath79-add-gbcom-device-v0-support.patch target/linux/ar71xx/patches-3.18/941-MIPS-ath79-add-gbcom-device-v0-support.patch
--- target_orig/linux/ar71xx/patches-3.18/941-MIPS-ath79-add-gbcom-device-v0-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/patches-3.18/941-MIPS-ath79-add-gbcom-device-v0-support.patch	2016-07-18 09:34:17.025095090 +0800
@@ -0,0 +1,1493 @@
+--- a/arch/mips/ath79/Kconfig
++++ b/arch/mips/ath79/Kconfig
+@@ -146,6 +146,99 @@ config ATH79_MACH_AP81
+ 	  Say 'Y' here if you want your kernel to support the
+ 	  Atheros AP81 reference board.
+ 
++config ATH79_MACH_AP143
++	bool "Atheros AP143 reference board"
++	select SOC_QCA953X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_SPI
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_ETH
++	select ATH79_DEV_M25P80
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  Atheros AP143 reference board.
++
++config ATH79_MACH_AP147
++	bool "Atheros AP147 reference board"
++	select SOC_QCA953X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  QCA AP147 reference boards.
++
++config ATH79_MACH_AP152
++	bool "Atheros AP152 reference board"
++	select SOC_QCA956X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  QCA AP152 reference boards.
++
++
++config ATH79_MACH_GB_CGW600
++	bool "GBCOM CGW600 board"
++	select SOC_QCA953X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  GBCOM CGW600 board.
++
++config ATH79_MACH_GB_CGW800
++	bool "GBCOM CGW800 board"
++	select SOC_QCA953X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  GBCOM CGW800 board.
++
++config ATH79_MACH_GB_TA2025AC
++	bool "GBCOM TA2025AC board"
++	select SOC_QCA956X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  GBCOM TA2025AC board.
++
++config ATH79_MACH_GB_OA5025
++	bool "GBCOM OA5025 board"
++	select SOC_QCA956X
++	select ATH79_DEV_GPIO_BUTTONS
++	select ATH79_DEV_LEDS_GPIO
++	select ATH79_DEV_M25P80
++	select ATH79_DEV_USB
++	select ATH79_DEV_WMAC
++	select ATH79_DEV_AP9X_PCI if PCI
++	help
++	  Say 'Y' here if you want your kernel to support the
++	  GBCOM OA5025 board.
++
+ config ATH79_MACH_AP83
+ 	bool "Atheros AP83 board support"
+ 	select SOC_AR913X
+--- a/arch/mips/ath79/Makefile
++++ b/arch/mips/ath79/Makefile
+@@ -49,6 +49,9 @@ obj-$(CONFIG_ATH79_MACH_AP113)		+= mach-
+ obj-$(CONFIG_ATH79_MACH_AP121)		+= mach-ap121.o
+ obj-$(CONFIG_ATH79_MACH_AP132)		+= mach-ap132.o
+ obj-$(CONFIG_ATH79_MACH_AP136)		+= mach-ap136.o
++obj-$(CONFIG_ATH79_MACH_AP143)		+= mach-ap143.o
++obj-$(CONFIG_ATH79_MACH_AP147)		+= mach-ap147.o
++obj-$(CONFIG_ATH79_MACH_AP152)		+= mach-ap152.o
+ obj-$(CONFIG_ATH79_MACH_AP81)		+= mach-ap81.o
+ obj-$(CONFIG_ATH79_MACH_AP83)		+= mach-ap83.o
+ obj-$(CONFIG_ATH79_MACH_AP96)		+= mach-ap96.o
+@@ -79,6 +82,10 @@ obj-$(CONFIG_ATH79_MACH_EL_MINI)	+= mach
+ obj-$(CONFIG_ATH79_MACH_EPG5000)	+= mach-epg5000.o
+ obj-$(CONFIG_ATH79_MACH_ESR1750)	+= mach-esr1750.o
+ obj-$(CONFIG_ATH79_MACH_F9K1115V2)	+= mach-f9k1115v2.o
++obj-$(CONFIG_ATH79_MACH_GB_CGW600)		+= mach-gb-cgw600.o
++obj-$(CONFIG_ATH79_MACH_GB_CGW800)		+= mach-gb-cgw800.o
++obj-$(CONFIG_ATH79_MACH_GB_TA2025AC)		+= mach-gb-ta2025ac.o
++obj-$(CONFIG_ATH79_MACH_GB_OA5025)		+= mach-gb-oa5025.o
+ obj-$(CONFIG_ATH79_MACH_GL_INET)	+= mach-gl-inet.o
+ obj-$(CONFIG_ATH79_MACH_GS_MINIBOX_V1)	+= mach-gs-minibox-v1.o
+ obj-$(CONFIG_ATH79_MACH_GS_OOLITE)	+= mach-gs-oolite.o
+--- a/arch/mips/ath79/common.h
++++ b/arch/mips/ath79/common.h
+@@ -28,6 +28,7 @@ void ath79_gpio_function_enable(u32 mask
+ void ath79_gpio_function_disable(u32 mask);
+ void ath79_gpio_function_setup(u32 set, u32 clear);
+ void ath79_gpio_output_select(unsigned gpio, u8 val);
++int ath79_gpio_direction_select(unsigned gpio, bool oe);
+ void ath79_gpio_init(void);
+ 
+ #endif /* __ATH79_COMMON_H */
+--- a/arch/mips/ath79/dev-eth.c
++++ b/arch/mips/ath79/dev-eth.c
+@@ -183,7 +183,8 @@ void __init ath79_register_mdio(unsigned
+ 	    ath79_soc == ATH79_SOC_AR9342 ||
+ 	    ath79_soc == ATH79_SOC_AR9344 ||
+ 	    ath79_soc == ATH79_SOC_QCA9556 ||
+-	    ath79_soc == ATH79_SOC_QCA9558)
++	    ath79_soc == ATH79_SOC_QCA9558 ||
++	    ath79_soc == ATH79_SOC_QCA9561)
+ 		max_id = 1;
+ 	else
+ 		max_id = 0;
+@@ -198,7 +199,6 @@ void __init ath79_register_mdio(unsigned
+ 	case ATH79_SOC_AR9330:
+ 	case ATH79_SOC_AR9331:
+ 	case ATH79_SOC_QCA9533:
+-	case ATH79_SOC_QCA9561:
+ 	case ATH79_SOC_TP9343:
+ 		mdio_dev = &ath79_mdio1_device;
+ 		mdio_data = &ath79_mdio1_data;
+@@ -209,6 +209,7 @@ void __init ath79_register_mdio(unsigned
+ 	case ATH79_SOC_AR9344:
+ 	case ATH79_SOC_QCA9556:
+ 	case ATH79_SOC_QCA9558:
++	case ATH79_SOC_QCA9561:
+ 		if (id == 0) {
+ 			mdio_dev = &ath79_mdio0_device;
+ 			mdio_data = &ath79_mdio0_data;
+@@ -258,7 +259,6 @@ void __init ath79_register_mdio(unsigned
+ 		break;
+ 
+ 	case ATH79_SOC_QCA9533:
+-	case ATH79_SOC_QCA9561:
+ 	case ATH79_SOC_TP9343:
+ 		mdio_data->builtin_switch = 1;
+ 		break;
+@@ -267,6 +267,12 @@ void __init ath79_register_mdio(unsigned
+ 	case ATH79_SOC_QCA9558:
+ 		mdio_data->is_ar934x = 1;
+ 		break;
++		
++	case ATH79_SOC_QCA9561:
++		if (id == 1)
++			mdio_data->builtin_switch = 1;
++		mdio_data->is_ar934x = 1;
++		break;
+ 
+ 	default:
+ 		break;
+@@ -387,6 +393,16 @@ static void qca955x_set_speed_sgmii(int
+ 	iounmap(base);
+ }
+ 
++static void qca956x_set_speed_sgmii(int speed)
++{
++	void __iomem *base;
++	u32 val = ath79_get_eth_pll(0, speed);
++
++	base = ioremap_nocache(AR71XX_PLL_BASE, AR71XX_PLL_SIZE);
++	__raw_writel(val, base + QCA955X_PLL_ETH_SGMII_CONTROL_REG);
++	iounmap(base);
++}
++
+ static void ath79_set_speed_dummy(int speed)
+ {
+ }
+@@ -517,6 +533,10 @@ struct ag71xx_switch_platform_data ath79
+ #define AR934X_PLL_VAL_100	0x00000101
+ #define AR934X_PLL_VAL_10	0x00001616
+ 
++#define QCA956X_PLL_VAL_1000	0x03000000
++#define QCA956X_PLL_VAL_100	0x00000101
++#define QCA956X_PLL_VAL_10	0x00001919
++
+ static void __init ath79_init_eth_pll_data(unsigned int id)
+ {
+ 	struct ath79_eth_pll_data *pll_data;
+@@ -575,12 +595,17 @@ static void __init ath79_init_eth_pll_da
+ 	case ATH79_SOC_QCA9533:
+ 	case ATH79_SOC_QCA9556:
+ 	case ATH79_SOC_QCA9558:
+-	case ATH79_SOC_QCA9561:
+ 	case ATH79_SOC_TP9343:
+ 		pll_10 = AR934X_PLL_VAL_10;
+ 		pll_100 = AR934X_PLL_VAL_100;
+ 		pll_1000 = AR934X_PLL_VAL_1000;
+ 		break;
++		
++	case ATH79_SOC_QCA9561:
++		pll_10 = QCA956X_PLL_VAL_10;
++		pll_100 = QCA956X_PLL_VAL_100;
++		pll_1000 = QCA956X_PLL_VAL_1000;
++		break;
+ 
+ 	default:
+ 		BUG();
+@@ -633,7 +658,6 @@ static int __init ath79_setup_phy_if_mod
+ 		case ATH79_SOC_AR9330:
+ 		case ATH79_SOC_AR9331:
+ 		case ATH79_SOC_QCA9533:
+-		case ATH79_SOC_QCA9561:
+ 		case ATH79_SOC_TP9343:
+ 			pdata->phy_if_mode = PHY_INTERFACE_MODE_MII;
+ 			break;
+@@ -657,6 +681,7 @@ static int __init ath79_setup_phy_if_mod
+ 
+ 		case ATH79_SOC_QCA9556:
+ 		case ATH79_SOC_QCA9558:
++		case ATH79_SOC_QCA9561:
+ 			switch (pdata->phy_if_mode) {
+ 			case PHY_INTERFACE_MODE_MII:
+ 			case PHY_INTERFACE_MODE_RGMII:
+@@ -1028,7 +1053,6 @@ void __init ath79_register_eth(unsigned
+ 		break;
+ 
+ 	case ATH79_SOC_QCA9533:
+-	case ATH79_SOC_QCA9561:
+ 	case ATH79_SOC_TP9343:
+ 		if (id == 0) {
+ 			pdata->reset_bit = AR933X_RESET_GE0_MAC |
+@@ -1095,6 +1119,43 @@ void __init ath79_register_eth(unsigned
+ 			pdata->fifo_cfg3 = 0x01f00140;
+ 		break;
+ 
++	case ATH79_SOC_QCA9561:
++		if (id == 0) {
++			pdata->reset_bit = QCA955X_RESET_GE0_MAC |
++					   QCA955X_RESET_GE0_MDIO;
++
++			if (pdata->phy_if_mode == PHY_INTERFACE_MODE_SGMII)
++				pdata->set_speed = qca956x_set_speed_sgmii;
++			else
++				pdata->set_speed = ath79_set_speed_ge0;
++		} else {
++			pdata->reset_bit = QCA955X_RESET_GE1_MAC |
++					   QCA955X_RESET_GE1_MDIO;
++
++			pdata->set_speed = ath79_set_speed_dummy;
++
++			pdata->switch_data = &ath79_switch_data;
++
++			pdata->speed = SPEED_1000;
++			pdata->duplex = DUPLEX_FULL;
++
++			/* reset the built-in switch */
++			ath79_device_reset_set(AR934X_RESET_ETH_SWITCH);
++			ath79_device_reset_clear(AR934X_RESET_ETH_SWITCH);
++		}
++
++		pdata->ddr_flush = ath79_ddr_no_flush;
++		pdata->has_gbit = 1;
++		pdata->is_ar724x = 1;
++
++		if (!pdata->fifo_cfg1)
++			pdata->fifo_cfg1 = 0x0010ffff;
++		if (!pdata->fifo_cfg2)
++			pdata->fifo_cfg2 = 0x015500aa;
++		if (!pdata->fifo_cfg3)
++			pdata->fifo_cfg3 = 0x01f00140;
++		break;
++
+ 	default:
+ 		BUG();
+ 	}
+@@ -1135,7 +1196,6 @@ void __init ath79_register_eth(unsigned
+ 		case ATH79_SOC_AR9330:
+ 		case ATH79_SOC_AR9331:
+ 		case ATH79_SOC_QCA9533:
+-		case ATH79_SOC_QCA9561:
+ 		case ATH79_SOC_TP9343:
+ 			pdata->mii_bus_dev = &ath79_mdio1_device.dev;
+ 			break;
+@@ -1144,6 +1204,11 @@ void __init ath79_register_eth(unsigned
+ 		case ATH79_SOC_QCA9558:
+ 			/* don't assign any MDIO device by default */
+ 			break;
++			
++		case ATH79_SOC_QCA9561:
++			if (pdata->phy_if_mode != PHY_INTERFACE_MODE_SGMII)
++				pdata->mii_bus_dev = &ath79_mdio1_device.dev;
++			break;
+ 
+ 		default:
+ 			pdata->mii_bus_dev = &ath79_mdio0_device.dev;
+--- a/arch/mips/ath79/dev-wmac.c
++++ b/arch/mips/ath79/dev-wmac.c
+@@ -398,6 +398,11 @@ void __init ath79_wmac_set_ext_lna_gpio(
+ 		ar934x_set_ext_lna_gpio(chain, gpio);
+ }
+ 
++void __init ath79_wmac_set_led_pin(int gpio)
++{
++	ath79_wmac_data.led_pin = gpio;
++}
++
+ void __init ath79_register_wmac(u8 *cal_data, u8 *mac_addr)
+ {
+ 	if (soc_is_ar913x())
+--- a/arch/mips/ath79/dev-wmac.h
++++ b/arch/mips/ath79/dev-wmac.h
+@@ -18,6 +18,7 @@ void ath79_wmac_disable_2ghz(void);
+ void ath79_wmac_disable_5ghz(void);
+ void ath79_wmac_set_tx_gain_buffalo(void);
+ void ath79_wmac_set_ext_lna_gpio(unsigned chain, int gpio);
++void ath79_wmac_set_led_pin(int gpio);
+ 
+ bool ar93xx_wmac_read_mac_address(u8 *dest);
+ 
+--- a/arch/mips/ath79/gpio.c
++++ b/arch/mips/ath79/gpio.c
+@@ -130,6 +130,30 @@ static int ar934x_gpio_direction_output(
+ 	return 0;
+ }
+ 
++int ath79_gpio_direction_select(unsigned gpio, bool oe)
++{
++	void __iomem *base = ath79_gpio_base;
++	unsigned long flags;
++	bool ieq_1 = (soc_is_ar934x() ||
++			soc_is_qca953x());
++
++	if (gpio >= ath79_gpio_count)
++		return -1;
++
++	spin_lock_irqsave(&ath79_gpio_lock, flags);
++
++	if ((ieq_1 && oe) || (!ieq_1 && !oe))
++		__raw_writel(__raw_readl(base + AR71XX_GPIO_REG_OE) & ~(1 << gpio),
++				base + AR71XX_GPIO_REG_OE);
++	else
++		__raw_writel(__raw_readl(base + AR71XX_GPIO_REG_OE) | (1 << gpio),
++				base + AR71XX_GPIO_REG_OE);
++
++	spin_unlock_irqrestore(&ath79_gpio_lock, flags);
++
++	return 0;
++}
++
+ static struct gpio_chip ath79_gpio_chip = {
+ 	.label			= "ath79",
+ 	.get			= ath79_gpio_get_value,
+--- /dev/null
++++ b/arch/mips/ath79/mach-ap143.c
+@@ -0,0 +1,142 @@
++/*
++ * Atheros AP143 reference board support
++ *
++ * Copyright (c) 2013-2015 The Linux Foundation. All rights reserved.
++ * Copyright (c) 2012 Gabor Juhos <juhosg@openwrt.org>
++ *
++ * Permission to use, copy, modify, and/or distribute this software for any
++ * purpose with or without fee is hereby granted, provided that the above
++ * copyright notice and this permission notice appear in all copies.
++ *
++ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
++ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
++ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
++ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
++ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
++ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
++ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
++ *
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ath9k_platform.h>
++#include <linux/ar8216_platform.h>
++
++#include <asm/mach-ath79/ar71xx_regs.h>
++
++#include "common.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-m25p80.h"
++#include "dev-spi.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++#include "machtypes.h"
++
++#define AP143_GPIO_LED_WLAN		12
++#define AP143_GPIO_LED_WPS		13
++#define AP143_GPIO_LED_STATUS		13
++
++#define AP143_GPIO_LED_WAN		4
++#define AP143_GPIO_LED_LAN1		16
++#define AP143_GPIO_LED_LAN2		15
++#define AP143_GPIO_LED_LAN3		14
++#define AP143_GPIO_LED_LAN4		11
++
++#define AP143_GPIO_BTN_WPS		17
++
++#define AP143_KEYS_POLL_INTERVAL	20	/* msecs */
++#define AP143_KEYS_DEBOUNCE_INTERVAL	(3 * AP143_KEYS_POLL_INTERVAL)
++
++#define AP143_MAC0_OFFSET		0
++#define AP143_MAC1_OFFSET		6
++#define AP143_WMAC_CALDATA_OFFSET	0x1000
++
++static struct gpio_led ap143_leds_gpio[] __initdata = {
++	{
++		.name		= "ap143:green:status",
++		.gpio		= AP143_GPIO_LED_STATUS,
++		.active_low	= 1,
++	},
++	{
++		.name		= "ap143:green:wlan",
++		.gpio		= AP143_GPIO_LED_WLAN,
++		.active_low	= 1,
++	}
++};
++
++static struct gpio_keys_button ap143_gpio_keys[] __initdata = {
++	{
++		.desc		= "WPS button",
++		.type		= EV_KEY,
++		.code		= KEY_WPS_BUTTON,
++		.debounce_interval = AP143_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= AP143_GPIO_BTN_WPS,
++		.active_low	= 1,
++	},
++};
++
++static void __init ap143_gpio_led_setup(void)
++{
++	ath79_gpio_direction_select(AP143_GPIO_LED_WAN, true);
++	ath79_gpio_direction_select(AP143_GPIO_LED_LAN1, true);
++	ath79_gpio_direction_select(AP143_GPIO_LED_LAN2, true);
++	ath79_gpio_direction_select(AP143_GPIO_LED_LAN3, true);
++	ath79_gpio_direction_select(AP143_GPIO_LED_LAN4, true);
++
++	ath79_gpio_output_select(AP143_GPIO_LED_WAN,
++			QCA953X_GPIO_OUT_MUX_LED_LINK5);
++	ath79_gpio_output_select(AP143_GPIO_LED_LAN1,
++			QCA953X_GPIO_OUT_MUX_LED_LINK1);
++	ath79_gpio_output_select(AP143_GPIO_LED_LAN2,
++			QCA953X_GPIO_OUT_MUX_LED_LINK2);
++	ath79_gpio_output_select(AP143_GPIO_LED_LAN3,
++			QCA953X_GPIO_OUT_MUX_LED_LINK3);
++	ath79_gpio_output_select(AP143_GPIO_LED_LAN4,
++			QCA953X_GPIO_OUT_MUX_LED_LINK4);
++
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(ap143_leds_gpio),
++			ap143_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, AP143_KEYS_POLL_INTERVAL,
++			ARRAY_SIZE(ap143_gpio_keys),
++			ap143_gpio_keys);
++}
++
++static void __init ap143_setup(void)
++{
++	u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	ap143_gpio_led_setup();
++
++	ath79_register_usb();
++
++	ath79_wmac_set_led_pin(AP143_GPIO_LED_WLAN);
++	ath79_register_wmac(art + AP143_WMAC_CALDATA_OFFSET, NULL);
++
++	ath79_register_mdio(0, 0x0);
++	ath79_register_mdio(1, 0x0);
++
++	ath79_init_mac(ath79_eth0_data.mac_addr, art + AP143_MAC0_OFFSET, 0);
++	ath79_init_mac(ath79_eth1_data.mac_addr, art + AP143_MAC1_OFFSET, 0);
++
++	/* WAN port */
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
++	ath79_eth0_data.speed = SPEED_100;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.phy_mask = BIT(4);
++	ath79_register_eth(0);
++
++	/* LAN ports */
++	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;
++	ath79_eth1_data.speed = SPEED_1000;
++	ath79_eth1_data.duplex = DUPLEX_FULL;
++	ath79_switch_data.phy_poll_mask |= BIT(4);
++	ath79_switch_data.phy4_mii_en = 1;
++	ath79_register_eth(1);
++}
++
++MIPS_MACHINE(ATH79_MACH_AP143, "AP143", "Qualcomm Atheros AP143 reference board",
++	     ap143_setup);
+--- /dev/null
++++ b/arch/mips/ath79/mach-ap147.c
+@@ -0,0 +1,125 @@
++/*
++ *  Atheros AP147 reference board support
++ *
++ *  Copyright (C) 2014 Matthias Schiffer <mschiffer@universe-factory.net>
++ *  Copyright (C) 2015 Sven Eckelmann <sven@open-mesh.com>
++ *
++ *  This program is free software; you can redistribute it and/or modify it
++ *  under the terms of the GNU General Public License version 2 as published
++ *  by the Free Software Foundation.
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ar8216_platform.h>
++
++#include <asm/mach-ath79/ar71xx_regs.h>
++#include <asm/mach-ath79/ath79.h>
++
++#include "common.h"
++#include "dev-ap9x-pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-m25p80.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++#include "machtypes.h"
++#include "pci.h"
++
++#define AP147_GPIO_LED_WAN	4
++#define AP147_GPIO_LED_LAN1	16
++#define AP147_GPIO_LED_LAN2	15
++#define AP147_GPIO_LED_LAN3	14
++#define AP147_GPIO_LED_LAN4	11
++#define AP147_GPIO_LED_STATUS	13
++#define AP147_GPIO_LED_WLAN_2G	12
++
++#define AP147_GPIO_BTN_WPS	17
++
++#define AP147_KEYS_POLL_INTERVAL	20	/* msecs */
++#define AP147_KEYS_DEBOUNCE_INTERVAL	(3 * AP147_KEYS_POLL_INTERVAL)
++
++#define AP147_MAC0_OFFSET	0x1000
++
++static struct gpio_led ap147_leds_gpio[] __initdata = {
++	{
++		.name		= "ap147:green:status",
++		.gpio		= AP147_GPIO_LED_STATUS,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:wlan-2g",
++		.gpio		= AP147_GPIO_LED_WLAN_2G,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:lan1",
++		.gpio		= AP147_GPIO_LED_LAN1,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:lan2",
++		.gpio		= AP147_GPIO_LED_LAN2,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:lan3",
++		.gpio		= AP147_GPIO_LED_LAN3,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:lan4",
++		.gpio		= AP147_GPIO_LED_LAN4,
++		.active_low	= 1,
++	}, {
++		.name		= "ap147:green:wan",
++		.gpio		= AP147_GPIO_LED_WAN,
++		.active_low	= 1,
++	},
++};
++
++static struct gpio_keys_button ap147_gpio_keys[] __initdata = {
++	{
++		.desc		= "wps button",
++		.type		= EV_KEY,
++		.code		= KEY_WPS_BUTTON,
++		.debounce_interval = AP147_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= AP147_GPIO_BTN_WPS,
++		.active_low	= 1,
++	}
++};
++
++static void __init ap147_setup(void)
++{
++	u8 *art = (u8 *)KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(ap147_leds_gpio),
++				 ap147_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, AP147_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(ap147_gpio_keys),
++					ap147_gpio_keys);
++
++	ath79_register_usb();
++
++	ath79_register_pci();
++
++	ath79_register_wmac(art + AP147_MAC0_OFFSET, NULL);
++
++	ath79_setup_ar933x_phy4_switch(false, false);
++
++	ath79_register_mdio(0, 0x0);
++
++	/* LAN */
++	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;
++	ath79_eth1_data.duplex = DUPLEX_FULL;
++	ath79_switch_data.phy_poll_mask |= BIT(4);
++	ath79_init_mac(ath79_eth1_data.mac_addr, art, 0);
++	ath79_register_eth(1);
++
++	/* WAN */
++	ath79_switch_data.phy4_mii_en = 1;
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.speed = SPEED_100;
++	ath79_eth0_data.phy_mask = BIT(4);
++	ath79_init_mac(ath79_eth0_data.mac_addr, art, 1);
++	ath79_register_eth(0);
++}
++
++MIPS_MACHINE(ATH79_MACH_AP147_010, "AP147-010", "Atheros AP147-010 reference board", ap147_setup);
+--- /dev/null
++++ b/arch/mips/ath79/mach-ap152.c
+@@ -0,0 +1,140 @@
++
++/*
++ * Qualcomm Atheros AP152 reference board support
++ *
++ * Copyright (c) 2015 Qualcomm Atheros
++ * Copyright (c) 2012 Gabor Juhos <juhosg@openwrt.org>
++ *
++ * Permission to use, copy, modify, and/or distribute this software for any
++ * purpose with or without fee is hereby granted, provided that the above
++ * copyright notice and this permission notice appear in all copies.
++ *
++ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
++ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
++ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
++ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
++ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
++ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
++ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
++ *
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ath9k_platform.h>
++#include <linux/ar8216_platform.h>
++#include <asm/mach-ath79/ar71xx_regs.h>
++
++#include "common.h"
++#include "dev-m25p80.h"
++#include "machtypes.h"
++#include "pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-spi.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++
++#define AP152_GPIO_LED_USB0		7
++#define AP152_GPIO_LED_USB1		8
++
++#define AP152_GPIO_BTN_RESET            2
++#define AP152_GPIO_BTN_WPS              1
++#define AP152_KEYS_POLL_INTERVAL        20     /* msecs */
++#define AP152_KEYS_DEBOUNCE_INTERVAL    (3 * AP152_KEYS_POLL_INTERVAL)
++
++#define AP152_MAC0_OFFSET               0
++#define AP152_WMAC_CALDATA_OFFSET       0x1000
++
++static struct gpio_led ap152_leds_gpio[] __initdata = {
++	{
++		.name		= "ap152:green:usb0",
++		.gpio		= AP152_GPIO_LED_USB0,
++		.active_low	= 1,
++	},
++	{
++		.name		= "ap152:green:usb1",
++		.gpio		= AP152_GPIO_LED_USB1,
++		.active_low	= 1,
++	},
++};
++
++static struct gpio_keys_button ap152_gpio_keys[] __initdata = {
++	{
++		.desc		= "WPS button",
++		.type		= EV_KEY,
++		.code		= KEY_WPS_BUTTON,
++		.debounce_interval = AP152_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= AP152_GPIO_BTN_WPS,
++		.active_low	= 1,
++	},
++	{
++		.desc		= "Reset button",
++		.type		= EV_KEY,
++		.code		= KEY_RESTART,
++		.debounce_interval = AP152_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= AP152_GPIO_BTN_RESET,
++		.active_low	= 1,
++	},
++};
++
++static struct ar8327_pad_cfg ap152_ar8337_pad0_cfg = {
++	.mode = AR8327_PAD_MAC_SGMII,
++	.sgmii_delay_en = true,
++};
++
++static struct ar8327_platform_data ap152_ar8337_data = {
++	.pad0_cfg = &ap152_ar8337_pad0_cfg,
++	.port0_cfg = {
++		.force_link = 1,
++		.speed = AR8327_PORT_SPEED_1000,
++		.duplex = 1,
++		.txpause = 1,
++		.rxpause = 1,
++	},
++};
++
++static struct mdio_board_info ap152_mdio0_info[] = {
++	{
++		.bus_id = "ag71xx-mdio.0",
++		.phy_addr = 0,
++		.platform_data = &ap152_ar8337_data,
++	},
++};
++
++static void __init ap152_setup(void)
++{
++	u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(ap152_leds_gpio),
++				 ap152_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, AP152_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(ap152_gpio_keys),
++					ap152_gpio_keys);
++
++	ath79_register_usb();
++
++	platform_device_register(&ath79_mdio0_device);
++
++	mdiobus_register_board_info(ap152_mdio0_info,
++				    ARRAY_SIZE(ap152_mdio0_info));
++
++	ath79_register_wmac(art + AP152_WMAC_CALDATA_OFFSET, NULL);
++	ath79_register_pci();
++
++	ath79_init_mac(ath79_eth0_data.mac_addr, art + AP152_MAC0_OFFSET, 0);
++
++	/* GMAC0 is connected to an AR8337 switch */
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_SGMII;
++	ath79_eth0_data.speed = SPEED_1000;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.phy_mask = BIT(0);
++	ath79_eth0_data.mii_bus_dev = &ath79_mdio0_device.dev;
++
++	ath79_register_eth(0);
++}
++
++MIPS_MACHINE(ATH79_MACH_AP152, "AP152", "Qualcomm Atheros AP152 reference board",
++	     ap152_setup);
+--- /dev/null
++++ b/arch/mips/ath79/mach-gb-cgw600.c
+@@ -0,0 +1,151 @@
++/*
++ *  Atheros AP147 reference board support
++ *
++ *  Copyright (C) 2014 Matthias Schiffer <mschiffer@universe-factory.net>
++ *  Copyright (C) 2015 Sven Eckelmann <sven@open-mesh.com>
++ *
++ *  This program is free software; you can redistribute it and/or modify it
++ *  under the terms of the GNU General Public License version 2 as published
++ *  by the Free Software Foundation.
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ar8216_platform.h>
++
++#include <asm/mach-ath79/ar71xx_regs.h>
++#include <asm/mach-ath79/ath79.h>
++
++#include "common.h"
++#include "dev-ap9x-pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-m25p80.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++#include "machtypes.h"
++#include "pci.h"
++
++#define CGW600_GPIO_LED_STATUS	15 /*SYS_LED   1-on*/
++#define CGW600_GPIO_LED_WLAN	3         /*WLAN_2.4G_LED 1-on*/
++#define CGW600_GPIO_LED_LAN1	16        /*LAN1_LED  0-on*/
++#define CGW600_GPIO_LED_LAN2	17	     /*LAN2_LED  0-on*/
++#define CGW600_GPIO_LED_LAN3	14        /*LAN3_LED  0-on*/
++#define CGW600_GPIO_LED_LAN4	12        /*LAN4_LED  0-on*/
++#define CGW600_GPIO_LED_WAN	11        /*WAN_LED   0-on*/
++
++#define CGW600_GPIO_BTN_RST	13   /*SW_RST*/ 
++
++#define CGW600_KEYS_POLL_INTERVAL	20	/* msecs */
++#define CGW600_KEYS_DEBOUNCE_INTERVAL	(3 * CGW600_KEYS_POLL_INTERVAL)
++
++#define CGW600_MAC0_OFFSET	0x1000
++
++static struct gpio_led cgw600_leds_gpio[] __initdata = {
++	{
++		.name		= "cgw600:green:status",
++		.gpio		= CGW600_GPIO_LED_STATUS,
++		.active_low	= 0,
++	},{
++		.name		= "cgw600:green:wlan",
++		.gpio		= CGW600_GPIO_LED_WLAN,
++		.active_low	= 0,
++	},  {
++		.name		= "cgw600:green:lan1",
++		.gpio		= CGW600_GPIO_LED_LAN1,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw600:green:lan2",
++		.gpio		= CGW600_GPIO_LED_LAN2,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw600:green:lan3",
++		.gpio		= CGW600_GPIO_LED_LAN3,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw600:green:lan4",
++		.gpio		= CGW600_GPIO_LED_LAN4,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw600:green:wan",
++		.gpio		= CGW600_GPIO_LED_WAN,
++		.active_low	= 1,
++	},
++};
++
++static struct gpio_keys_button cgw600_gpio_keys[] __initdata = {
++	{
++		.desc		= "Reset button",
++		.type		= EV_KEY,
++		.code		= KEY_RESTART,
++		.debounce_interval =CGW600_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= CGW600_GPIO_BTN_RST,
++		.active_low	= 0,
++	}
++};
++
++
++static void __init cgw600_gpio_led_setup(void)
++{
++	ath79_gpio_direction_select(CGW600_GPIO_LED_WAN, true);
++	ath79_gpio_direction_select(CGW600_GPIO_LED_LAN1, true);
++	ath79_gpio_direction_select(CGW600_GPIO_LED_LAN2, true);
++	ath79_gpio_direction_select(CGW600_GPIO_LED_LAN3, true);
++	ath79_gpio_direction_select(CGW600_GPIO_LED_LAN4, true);
++
++	ath79_gpio_output_select(CGW600_GPIO_LED_WAN,
++			QCA953X_GPIO_OUT_MUX_LED_LINK5);
++	ath79_gpio_output_select(CGW600_GPIO_LED_LAN1,
++			QCA953X_GPIO_OUT_MUX_LED_LINK4);
++	ath79_gpio_output_select(CGW600_GPIO_LED_LAN2,
++			QCA953X_GPIO_OUT_MUX_LED_LINK3);
++	ath79_gpio_output_select(CGW600_GPIO_LED_LAN3,
++			QCA953X_GPIO_OUT_MUX_LED_LINK2);
++	ath79_gpio_output_select(CGW600_GPIO_LED_LAN4,
++			QCA953X_GPIO_OUT_MUX_LED_LINK1);
++
++}
++
++
++static void __init gb_cgw600_setup(void)
++{
++	u8 *art = (u8 *)KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	cgw600_gpio_led_setup();
++	
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(cgw600_leds_gpio),
++				 cgw600_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, CGW600_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(cgw600_gpio_keys),
++					cgw600_gpio_keys);
++
++	ath79_register_usb();
++
++	ath79_register_pci();
++
++	ath79_register_wmac(art + CGW600_MAC0_OFFSET, NULL);
++
++	ath79_setup_ar933x_phy4_switch(false, false);
++
++	ath79_register_mdio(0, 0x0);
++
++	/* LAN */
++	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;
++	ath79_eth1_data.duplex = DUPLEX_FULL;
++	ath79_switch_data.phy_poll_mask |= BIT(4);
++	ath79_init_mac(ath79_eth1_data.mac_addr, art, 0);
++	ath79_register_eth(1);
++
++	/* WAN */
++	ath79_switch_data.phy4_mii_en = 1;
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.speed = SPEED_100;
++	ath79_eth0_data.phy_mask = BIT(4);
++	ath79_init_mac(ath79_eth0_data.mac_addr, art, 1);
++	ath79_register_eth(0);
++}
++
++MIPS_MACHINE(ATH79_MACH_GB_CGW600, "GB-CGW600", "GBCOM CGW600 board", gb_cgw600_setup);
+--- /dev/null
++++ b/arch/mips/ath79/mach-gb-cgw800.c
+@@ -0,0 +1,155 @@
++/*
++ *  Atheros AP147 reference board support
++ *
++ *  Copyright (C) 2014 Matthias Schiffer <mschiffer@universe-factory.net>
++ *  Copyright (C) 2015 Sven Eckelmann <sven@open-mesh.com>
++ *
++ *  This program is free software; you can redistribute it and/or modify it
++ *  under the terms of the GNU General Public License version 2 as published
++ *  by the Free Software Foundation.
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ar8216_platform.h>
++
++#include <asm/mach-ath79/ar71xx_regs.h>
++#include <asm/mach-ath79/ath79.h>
++
++#include "common.h"
++#include "dev-ap9x-pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-m25p80.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++#include "machtypes.h"
++#include "pci.h"
++
++#define CGW800_GPIO_LED_STATUS	15 /*SYS_LED   1-on*/
++#define CGW800_GPIO_LED_WLAN	3         /*WLAN_2.4G_LED 1-on*/
++#define CGW800_GPIO_LED_LAN1	16        /*LAN1_LED  0-on*/
++#define CGW800_GPIO_LED_LAN2	17	     /*LAN2_LED  0-on*/
++#define CGW800_GPIO_LED_LAN3	14        /*LAN3_LED  0-on*/
++#define CGW800_GPIO_LED_LAN4	12        /*LAN4_LED  0-on*/
++#define CGW800_GPIO_LED_WAN	11        /*WAN_LED   0-on*/
++
++
++
++
++#define CGW800_GPIO_BTN_RST	13   /*SW_RST*/
++
++#define CGW800_KEYS_POLL_INTERVAL	20	/* msecs */
++#define CGW800_KEYS_DEBOUNCE_INTERVAL	(3 * CGW800_KEYS_POLL_INTERVAL)
++
++#define CGW800_MAC0_OFFSET	0x1000
++
++static struct gpio_led cgw800_leds_gpio[] __initdata = {
++	{
++		.name		= "cgw800:green:status",
++		.gpio		= CGW800_GPIO_LED_STATUS,
++		.active_low	= 0,
++	}, {
++		.name		= "cgw800:green:wlan",
++		.gpio		= CGW800_GPIO_LED_WLAN,
++		.active_low	= 0,
++	},{
++		.name		= "cgw800:green:lan1",
++		.gpio		= CGW800_GPIO_LED_LAN1,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw800:green:lan2",
++		.gpio		= CGW800_GPIO_LED_LAN2,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw800:green:lan3",
++		.gpio		= CGW800_GPIO_LED_LAN3,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw800:green:lan4",
++		.gpio		= CGW800_GPIO_LED_LAN4,
++		.active_low	= 1,
++	}, {
++		.name		= "cgw800:green:wan",
++		.gpio		= CGW800_GPIO_LED_WAN,
++		.active_low	= 1,
++	},
++};
++
++static struct gpio_keys_button cgw800_gpio_keys[] __initdata = {
++	{
++		.desc		= "Reset button",
++		.type		= EV_KEY,
++		.code		= KEY_RESTART,
++		.debounce_interval =CGW800_KEYS_DEBOUNCE_INTERVAL,
++		.gpio		= CGW800_GPIO_BTN_RST,
++		.active_low	= 0,
++	}
++};
++
++
++static void __init cgw800_gpio_led_setup(void)
++{
++	ath79_gpio_direction_select(CGW800_GPIO_LED_WAN, true);
++	ath79_gpio_direction_select(CGW800_GPIO_LED_LAN1, true);
++	ath79_gpio_direction_select(CGW800_GPIO_LED_LAN2, true);
++	ath79_gpio_direction_select(CGW800_GPIO_LED_LAN3, true);
++	ath79_gpio_direction_select(CGW800_GPIO_LED_LAN4, true);
++
++	ath79_gpio_output_select(CGW800_GPIO_LED_WAN,
++			QCA953X_GPIO_OUT_MUX_LED_LINK5);
++	ath79_gpio_output_select(CGW800_GPIO_LED_LAN1,
++			QCA953X_GPIO_OUT_MUX_LED_LINK4);
++	ath79_gpio_output_select(CGW800_GPIO_LED_LAN2,
++			QCA953X_GPIO_OUT_MUX_LED_LINK3);
++	ath79_gpio_output_select(CGW800_GPIO_LED_LAN3,
++			QCA953X_GPIO_OUT_MUX_LED_LINK2);
++	ath79_gpio_output_select(CGW800_GPIO_LED_LAN4,
++			QCA953X_GPIO_OUT_MUX_LED_LINK1);
++
++}
++
++
++static void __init gb_cgw800_setup(void)
++{
++	u8 *art = (u8 *)KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	cgw800_gpio_led_setup();
++	
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(cgw800_leds_gpio),
++				 cgw800_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, CGW800_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(cgw800_gpio_keys),
++					cgw800_gpio_keys);
++
++	ath79_register_usb();
++
++	ath79_register_pci();
++
++	ath79_register_wmac(art + CGW800_MAC0_OFFSET, NULL);
++
++	ath79_setup_ar933x_phy4_switch(false, false);
++
++	ath79_register_mdio(0, 0x0);
++
++	/* LAN */
++	ath79_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_GMII;
++	ath79_eth1_data.duplex = DUPLEX_FULL;
++	ath79_switch_data.phy_poll_mask |= BIT(4);
++	ath79_init_mac(ath79_eth1_data.mac_addr, art, 0);
++	ath79_register_eth(1);
++
++	/* WAN */
++	ath79_switch_data.phy4_mii_en = 1;
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.speed = SPEED_100;
++	ath79_eth0_data.phy_mask = BIT(4);
++	ath79_init_mac(ath79_eth0_data.mac_addr, art, 1);
++	ath79_register_eth(0);
++}
++
++MIPS_MACHINE(ATH79_MACH_GB_CGW800, "GB-CGW800", "GBCOM CGW800 board", gb_cgw800_setup);
++
+--- /dev/null
++++ b/arch/mips/ath79/mach-gb-oa5025.c
+@@ -0,0 +1,137 @@
++
++/*
++ * Qualcomm Atheros AP152 reference board support
++ *
++ * Copyright (c) 2015 Qualcomm Atheros
++ * Copyright (c) 2012 Gabor Juhos <juhosg@openwrt.org>
++ *
++ * Permission to use, copy, modify, and/or distribute this software for any
++ * purpose with or without fee is hereby granted, provided that the above
++ * copyright notice and this permission notice appear in all copies.
++ *
++ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
++ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
++ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
++ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
++ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
++ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
++ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
++ *
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ath9k_platform.h>
++#include <linux/ar8216_platform.h>
++#include <asm/mach-ath79/ar71xx_regs.h>
++
++#include "common.h"
++#include "dev-m25p80.h"
++#include "machtypes.h"
++#include "pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-spi.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++
++#define OA5025_GPIO_LED_WLAN             10
++#define OA5025_GPIO_LED_RUN              11
++
++#define OA5025_GPIO_BTN_RESET            5
++
++#define OA5025_KEYS_POLL_INTERVAL        20     /* msecs */
++#define OA5025_KEYS_DEBOUNCE_INTERVAL    (3 * OA5025_KEYS_POLL_INTERVAL)
++
++#define OA5025_KEYS_POLL_INTERVAL        20     /* msecs */
++#define OA5025_KEYS_DEBOUNCE_INTERVAL    (3 * OA5025_KEYS_POLL_INTERVAL)
++
++
++#define OA5025_MAC0_OFFSET               0
++#define OA5025_WMAC_CALDATA_OFFSET       0x1000
++
++
++static struct gpio_led oa5025_leds_gpio[] __initdata = {
++	{
++		.name		= "oa5025:green:status",
++		.gpio		= OA5025_GPIO_LED_RUN,
++		.active_low	= 0,
++	},
++	{
++		.name		= "oa5025:green:wlan",
++		.gpio		= OA5025_GPIO_LED_WLAN,
++		.active_low	= 0,
++	},
++};
++
++static struct gpio_keys_button oa5025_gpio_keys[] __initdata = {
++        {
++                .desc           = "Reset button",
++                .type           = EV_KEY,
++                .code           = KEY_RESTART,
++                .debounce_interval = OA5025_KEYS_DEBOUNCE_INTERVAL,
++                .gpio           = OA5025_GPIO_BTN_RESET,
++                .active_low     = 1,
++        },
++};
++
++
++static struct ar8327_pad_cfg oa5025_ar8337_pad0_cfg = {
++	.mode = AR8327_PAD_MAC_SGMII,
++	.sgmii_delay_en = true,
++};
++
++static struct ar8327_platform_data oa5025_ar8337_data = {
++	.pad0_cfg = &oa5025_ar8337_pad0_cfg,
++	.port0_cfg = {
++		.force_link = 1,
++		.speed = AR8327_PORT_SPEED_1000,
++		.duplex = 1,
++		.txpause = 1,
++		.rxpause = 1,
++	},
++};
++
++static struct mdio_board_info oa5025_mdio0_info[] = {
++	{
++		.bus_id = "ag71xx-mdio.0",
++		.phy_addr = 0,
++		.platform_data = &oa5025_ar8337_data,
++	},
++};
++
++static void __init oa5025_setup(void)
++{
++	u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(oa5025_leds_gpio),
++				 oa5025_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, OA5025_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(oa5025_gpio_keys),
++					oa5025_gpio_keys);
++
++	ath79_register_usb();
++
++	platform_device_register(&ath79_mdio0_device);
++
++	mdiobus_register_board_info(oa5025_mdio0_info,
++				    ARRAY_SIZE(oa5025_mdio0_info));
++
++	ath79_register_wmac(art + OA5025_WMAC_CALDATA_OFFSET, NULL);
++	ath79_register_pci();
++
++	ath79_init_mac(ath79_eth0_data.mac_addr, art + OA5025_MAC0_OFFSET, 0);
++
++	/* GMAC0 is connected to an AR8337 switch */
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_SGMII;
++	ath79_eth0_data.speed = SPEED_1000;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.phy_mask = BIT(0);
++	ath79_eth0_data.mii_bus_dev = &ath79_mdio0_device.dev;
++
++	ath79_register_eth(0);
++}
++MIPS_MACHINE(ATH79_MACH_GB_OA5025, "GB-OA5025", "GBCOM OA5025 board",
++	     oa5025_setup);
+--- /dev/null
++++ b/arch/mips/ath79/mach-gb-ta2025ac.c
+@@ -0,0 +1,139 @@
++
++/*
++ * Qualcomm Atheros AP152 reference board support
++ *
++ * Copyright (c) 2015 Qualcomm Atheros
++ * Copyright (c) 2012 Gabor Juhos <juhosg@openwrt.org>
++ *
++ * Permission to use, copy, modify, and/or distribute this software for any
++ * purpose with or without fee is hereby granted, provided that the above
++ * copyright notice and this permission notice appear in all copies.
++ *
++ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
++ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
++ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
++ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
++ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
++ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
++ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
++ *
++ */
++
++#include <linux/platform_device.h>
++#include <linux/ath9k_platform.h>
++#include <linux/ar8216_platform.h>
++#include <asm/mach-ath79/ar71xx_regs.h>
++
++#include "common.h"
++#include "dev-m25p80.h"
++#include "machtypes.h"
++#include "pci.h"
++#include "dev-eth.h"
++#include "dev-gpio-buttons.h"
++#include "dev-leds-gpio.h"
++#include "dev-spi.h"
++#include "dev-usb.h"
++#include "dev-wmac.h"
++
++
++#define TA2025AC_GPIO_LED_WLAN             10
++#define TA2025AC_GPIO_LED_RUN              11
++
++#define TA2025AC_GPIO_BTN_RESET            5
++
++#define TA2025AC_KEYS_POLL_INTERVAL        20     /* msecs */
++#define TA2025AC_KEYS_DEBOUNCE_INTERVAL    (3 * TA2025AC_KEYS_POLL_INTERVAL)
++
++#define TA2025AC_KEYS_POLL_INTERVAL        20     /* msecs */
++#define TA2025AC_KEYS_DEBOUNCE_INTERVAL    (3 * TA2025AC_KEYS_POLL_INTERVAL)
++
++
++#define TA2025AC_MAC0_OFFSET               0
++#define TA2025AC_WMAC_CALDATA_OFFSET       0x1000
++
++
++static struct gpio_led ta2025ac_leds_gpio[] __initdata = {
++	{
++		.name		= "ta2025ac:green:status",
++		.gpio		= TA2025AC_GPIO_LED_RUN,
++		.active_low	= 0,
++	},
++	{
++		.name		= "ta2025ac:green:wlan",
++		.gpio		= TA2025AC_GPIO_LED_WLAN,
++		.active_low	= 0,
++	},
++};
++
++static struct gpio_keys_button ta2025ac_gpio_keys[] __initdata = {
++        {
++                .desc           = "Reset button",
++                .type           = EV_KEY,
++                .code           = KEY_RESTART,
++                .debounce_interval = TA2025AC_KEYS_DEBOUNCE_INTERVAL,
++                .gpio           = TA2025AC_GPIO_BTN_RESET,
++                .active_low     = 1,
++        },
++};
++
++
++static struct ar8327_pad_cfg ta2025ac_ar8337_pad0_cfg = {
++	.mode = AR8327_PAD_MAC_SGMII,
++	.sgmii_delay_en = true,
++};
++
++static struct ar8327_platform_data ta2025ac_ar8337_data = {
++	.pad0_cfg = &ta2025ac_ar8337_pad0_cfg,
++	.port0_cfg = {
++		.force_link = 1,
++		.speed = AR8327_PORT_SPEED_1000,
++		.duplex = 1,
++		.txpause = 1,
++		.rxpause = 1,
++	},
++};
++
++static struct mdio_board_info ta2025ac_mdio0_info[] = {
++	{
++		.bus_id = "ag71xx-mdio.0",
++		.phy_addr = 0,
++		.platform_data = &ta2025ac_ar8337_data,
++	},
++};
++
++static void __init ta2025ac_setup(void)
++{
++	u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
++
++	ath79_register_m25p80(NULL);
++
++	ath79_register_leds_gpio(-1, ARRAY_SIZE(ta2025ac_leds_gpio),
++				 ta2025ac_leds_gpio);
++	ath79_register_gpio_keys_polled(-1, TA2025AC_KEYS_POLL_INTERVAL,
++					ARRAY_SIZE(ta2025ac_gpio_keys),
++					ta2025ac_gpio_keys);
++
++	ath79_register_usb();
++
++	platform_device_register(&ath79_mdio0_device);
++
++	mdiobus_register_board_info(ta2025ac_mdio0_info,
++				    ARRAY_SIZE(ta2025ac_mdio0_info));
++
++	ath79_register_wmac(art + TA2025AC_WMAC_CALDATA_OFFSET, NULL);
++	ath79_register_pci();
++
++	ath79_init_mac(ath79_eth0_data.mac_addr, art + TA2025AC_MAC0_OFFSET, 0);
++
++	/* GMAC0 is connected to an AR8337 switch */
++	ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_SGMII;
++	ath79_eth0_data.speed = SPEED_1000;
++	ath79_eth0_data.duplex = DUPLEX_FULL;
++	ath79_eth0_data.phy_mask = BIT(0);
++	ath79_eth0_data.mii_bus_dev = &ath79_mdio0_device.dev;
++
++	ath79_register_eth(0);
++}
++
++MIPS_MACHINE(ATH79_MACH_GB_TA2025AC, "GB-TA2025AC", "GBCOM TA2025AC board",
++	     ta2025ac_setup);
+--- a/arch/mips/ath79/machtypes.h
++++ b/arch/mips/ath79/machtypes.h
+@@ -31,6 +31,9 @@ enum ath79_mach_type {
+ 	ATH79_MACH_AP135_020,		/* Atheros AP135-020 reference board */
+ 	ATH79_MACH_AP136_010,		/* Atheros AP136-010 reference board */
+ 	ATH79_MACH_AP136_020,		/* Atheros AP136-020 reference board */
++	ATH79_MACH_AP143,		/* Atheros AP143 reference board */
++	ATH79_MACH_AP147_010,		/* Atheros AP147-010 reference board */
++	ATH79_MACH_AP152,		/* Atheros AP152 reference board */
+ 	ATH79_MACH_AP81,		/* Atheros AP81 reference board */
+ 	ATH79_MACH_AP83,		/* Atheros AP83 */
+ 	ATH79_MACH_AP96,		/* Atheros AP96 */
+@@ -68,6 +71,10 @@ enum ath79_mach_type {
+ 	ATH79_MACH_ESR1750,		/* EnGenius ESR1750 */
+ 	ATH79_MACH_EPG5000,		/* EnGenius EPG5000 */
+ 	ATH79_MACH_F9K1115V2,		/* Belkin AC1750DB */
++	ATH79_MACH_GB_CGW600,	/*GBCOM CGW600*/
++	ATH79_MACH_GB_CGW800,	/*GBCOM CGW800*/
++	ATH79_MACH_GB_TA2025AC,  /*GBCOM TA2025AC*/
++	ATH79_MACH_GB_OA5025,	/*GBCOM OA5025*/
+ 	ATH79_MACH_GL_INET,		/* GL-CONNECT GL-INET */
+ 	ATH79_MACH_GS_MINIBOX_V1,	/* Gainstrong MiniBox V1.0 */
+ 	ATH79_MACH_GS_OOLITE,           /* GS OOLITE V1.0 */
+--- a/arch/mips/ath79/pci.c
++++ b/arch/mips/ath79/pci.c
+@@ -53,6 +53,15 @@ static const struct ath79_pci_irq ar724x
+ 	}
+ };
+ 
++static const struct ath79_pci_irq qca953x_pci_irq_map[] __initconst = {
++	{
++		.bus	= 0,
++		.slot	= 0,
++		.pin	= 1,
++		.irq	= ATH79_PCI_IRQ(0),
++	},
++};
++
+ static const struct ath79_pci_irq qca955x_pci_irq_map[] __initconst = {
+ 	{
+ 		.bus	= 0,
+@@ -98,6 +107,9 @@ int __init pcibios_map_irq(const struct 
+ 			   soc_is_ar9344()) {
+ 			ath79_pci_irq_map = ar724x_pci_irq_map;
+ 			ath79_pci_nr_irqs = ARRAY_SIZE(ar724x_pci_irq_map);
++		} else if (soc_is_qca953x()) {
++			ath79_pci_irq_map = qca953x_pci_irq_map;
++			ath79_pci_nr_irqs = ARRAY_SIZE(qca953x_pci_irq_map);
+ 		} else if (soc_is_qca955x()) {
+ 			ath79_pci_irq_map = qca955x_pci_irq_map;
+ 			ath79_pci_nr_irqs = ARRAY_SIZE(qca955x_pci_irq_map);
+@@ -303,6 +315,15 @@ int __init ath79_register_pci(void)
+ 						 AR724X_PCI_MEM_SIZE,
+ 						 0,
+ 						 ATH79_IP2_IRQ(0));
++	} else if (soc_is_qca9533()) {
++		pdev = ath79_register_pci_ar724x(0,
++						 QCA953X_PCI_CFG_BASE0,
++						 QCA953X_PCI_CTRL_BASE0,
++						 QCA953X_PCI_CRP_BASE0,
++						 QCA953X_PCI_MEM_BASE0,
++						 QCA953X_PCI_MEM_SIZE,
++						 0,
++						 ATH79_IP2_IRQ(0));
+ 	} else if (soc_is_qca9558()) {
+ 		pdev = ath79_register_pci_ar724x(0,
+ 						 QCA955X_PCI_CFG_BASE0,
+--- a/drivers/net/phy/at803x.c
++++ b/drivers/net/phy/at803x.c
+@@ -36,6 +36,9 @@
+ #define AT803X_INER				0x0012
+ #define AT803X_INER_INIT			0xec00
+ #define AT803X_INSR				0x0013
++#define AT803X_REG_CHIP_CONFIG			0x1f
++#define AT803X_BT_BX_REG_SEL			0x8000
++#define AT803X_SGMII_ANEG_EN			0x1000
+ 
+ #define AT803X_PCS_SMART_EEE_CTRL3			0x805D
+ #define AT803X_SMART_EEE_CTRL3_LPI_TX_DELAY_SEL_MASK	0x3
+@@ -267,6 +270,27 @@ static int at803x_config_init(struct phy
+ {
+ 	struct at803x_platform_data *pdata;
+ 	int ret;
++	u32 v;
++
++	if (phydev->drv->phy_id == ATH8031_PHY_ID &&
++		phydev->interface == PHY_INTERFACE_MODE_SGMII)
++	{
++		v = phy_read(phydev, AT803X_REG_CHIP_CONFIG);
++		/* select SGMII/fiber page */
++		ret = phy_write(phydev, AT803X_REG_CHIP_CONFIG,
++						v & ~AT803X_BT_BX_REG_SEL);
++		if (ret)
++			return ret;
++		/* enable SGMII autonegotiation */
++		ret = phy_write(phydev, MII_BMCR, AT803X_SGMII_ANEG_EN);
++		if (ret)
++			return ret;
++		/* select copper page */
++		ret = phy_write(phydev, AT803X_REG_CHIP_CONFIG,
++						v | AT803X_BT_BX_REG_SEL);
++		if (ret)
++			return ret;
++	}
+ 
+ 	ret = genphy_config_init(phydev);
+ 	if (ret < 0)
diff -urpN target_orig/linux/ar71xx/wdpi_kernel/files/wdpi.conf target/linux/ar71xx/wdpi_kernel/files/wdpi.conf
--- target_orig/linux/ar71xx/wdpi_kernel/files/wdpi.conf	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/wdpi_kernel/files/wdpi.conf	2016-07-18 09:34:17.029095092 +0800
@@ -0,0 +1,6 @@
+config wdpi_kernel
+	option	wan_interface	'eth1'
+	option	br_interface	'br-lan'
+	option	wdpi_debug      '0'
+	option	wdpi_sample     '20'
+
diff -urpN target_orig/linux/ar71xx/wdpi_kernel/files/wdpi.init target/linux/ar71xx/wdpi_kernel/files/wdpi.init
--- target_orig/linux/ar71xx/wdpi_kernel/files/wdpi.init	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ar71xx/wdpi_kernel/files/wdpi.init	2016-07-18 09:34:17.029095092 +0800
@@ -0,0 +1,47 @@
+#!/bin/sh /etc/rc.common
+
+START=97
+
+SERVICE_USE_PID=1
+SERVICE_WRITE_PID=1
+SERVICE_DAEMONIZE=1
+
+WDPI=/usr/sbin/wdpi_kernel
+
+WDPI_wan_if=eth1
+WDPI_br_if=br_lan
+WDPI_debug=0
+WDPI_sample=0
+
+prepare_wdpi_conf(){
+	local cfg=$1
+        config_get WDPI_wan_if "$cfg" "wan_interface" "eth1"
+        config_get WDPI_br_if "$cfg" "br_interface" "br_lan"
+        config_get WDPI_debug "$cfg" "wdpi_debug" "0"
+        config_get WDPI_sample "$cfg" "wdpi_sample" "30"
+}
+
+start() {
+    local wan_ifname=`uci show network.wan.ifname | cut -d'=' -f 2|sed -e "s/'//g"`
+    local eth_str=`ifconfig | grep $wan_ifname`
+    local wdpi_mod=`lsmod | grep wdpi_kernel`
+
+	config_load wdpi_kernel
+	config_foreach prepare_wdpi_conf wdpi_kernel
+	
+	if [ ! -n "$eth_str" ]; then
+		wan_ifname=$WDPI_wan_if
+		echo "config error: wan_ifname is not exist, replace with $wan_ifname" >/dev/ttyS0
+	fi	
+	
+	if [ -n "$wdpi_mod" ]; then
+		rmmod $WDPI
+		sleep 2
+	fi
+
+	insmod $WDPI debug=$WDPI_debug samples=$WDPI_sample br_if=$WDPI_br_if wan_if=$wan_ifname
+}
+stop() {
+	rmmod $WDPI
+}
+		
diff -urpN target_orig/linux/generic/config-3.18 target/linux/generic/config-3.18
--- target_orig/linux/generic/config-3.18	2016-06-17 15:12:18.472786380 +0800
+++ target/linux/generic/config-3.18	2016-07-18 09:34:16.673094991 +0800
@@ -4639,3 +4639,4 @@ CONFIG_ZONE_DMA_FLAG=1
 # CONFIG_ZRAM is not set
 # CONFIG_ZRAM_LZ4_COMPRESS is not set
 # CONFIG_ZSMALLOC is not set
+
diff -urpN target_orig/linux/ramips/base-files/etc/board.d/01_leds target/linux/ramips/base-files/etc/board.d/01_leds
--- target_orig/linux/ramips/base-files/etc/board.d/01_leds	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/etc/board.d/01_leds	2016-07-18 09:34:16.833095036 +0800
@@ -8,7 +8,7 @@ set_usb_led() {
 }
 
 set_wifi_led() {
-	ucidef_set_led_netdev "wifi_led" "wifi" "$1" "wlan0"
+	ucidef_set_led_netdev "wifi_led" "wifi" "$1" "ra0"
 }
 
 
@@ -266,6 +266,50 @@ case $board in
 	zte-q7)
 		set_wifi_led "zte:blue:status"
 		;;
+	hc5661a |\
+	zc9525a)
+		ucidef_set_led_default "system" "system" "hc5661a:blue:system" "0"
+		ucidef_set_led_netdev "internet" "internet" "hc5661a:blue:internet" "eth0.2"
+		set_wifi_led "hc5661a:blue:wlan2g"
+		;;	
+	hc5661 |\
+	zc9525)
+		ucidef_set_led_default "system" "system" "hc5661:blue:system" "1"
+		ucidef_set_led_netdev "internet" "internet" "hc5661:blue:internet" "eth0.2"
+		set_wifi_led "hc5661:blue:wlan2g"
+		;;	
+	hc5761 |\
+	zc9526 |\
+	zc9527)
+		ucidef_set_led_default "system" "system" "hc5761:blue:system" "1"
+		ucidef_set_led_netdev "internet" "internet" "hc5761:blue:internet" "eth0.2"
+		set_wifi_led "hc5761:blue:wlan2g"
+		ucidef_set_led_netdev "wifi5g" "wifi5g" "hc5761:blue:wlan5g" "rai0"
+		;;
+	hc5861)
+		ucidef_set_led_default "system" "system" "hc5861:blue:system" "1"
+		ucidef_set_led_netdev "internet" "internet" "hc5861:blue:internet" "eth0.2"
+		set_wifi_led "hc5861:blue:wlan2g"
+		ucidef_set_led_netdev "wifi5g" "wifi5g" "hc5861:blue:wlan5g" "rai0"
+		ucidef_set_led_default "turbo" "turbo" "hc5861:blue:turbo" "0"
+		;;
+	kt9762)
+		ucidef_set_led_default "system" "system" "hc5661a:blue:system" "0"
+		ucidef_set_led_netdev "internet" "internet" "hc5661a:blue:internet" "eth0.2"
+		set_wifi_led "hc5661a:blue:wlan2g"
+		ucidef_set_led_netdev "wifi5g" "wifi5g" "hc5661a:blue:wlan5g" "rai0"
+		ucidef_set_led_netdev "wanled" "wanled" "hc5661a:blue:internet" "eth0.2"
+		;;	
+	kt9962)
+		ucidef_set_led_default "system" "system" "kt9962:blue:system" "1"
+		ucidef_set_led_netdev "internet" "internet" "kt9962:blue:internet" "eth0.2"
+		set_wifi_led "kt9962:blue:wifi2g"
+		ucidef_set_led_netdev "wifi5g" "wifi5g" "kt9962:blue:wifi5g" "rai0"
+		;;	
+	kt9990)
+		ucidef_set_led_default "system" "system" "kt9990:blue:system" "1"
+		ucidef_set_led_netdev "internet" "internet" "kt9990:blue:internet" "eth0.2"
+		;;	
 esac
 
 board_config_flush
diff -urpN target_orig/linux/ramips/base-files/etc/board.d/02_network target/linux/ramips/base-files/etc/board.d/02_network
--- target_orig/linux/ramips/base-files/etc/board.d/02_network	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/etc/board.d/02_network	2016-07-18 09:34:16.833095036 +0800
@@ -146,13 +146,15 @@ ramips_setup_interfaces()
 	wt1520 | \
 	xiaomi-miwifi-mini |\
 	y1|\
+	kt9962|\
+	kt9990|\
 	zbt-wg2626)
 		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 		ucidef_add_switch "switch0" "1" "1"
 		ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 6t"
 		ucidef_add_switch_vlan "switch0" "2" "4 6t"
 		;;
-
+	
 	whr-1166d)
 		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 		ucidef_add_switch "switch0" "1" "1"
@@ -177,6 +179,9 @@ ramips_setup_interfaces()
 	wrtnode | \
 	wt3020 | \
 	ur-326n4g | \
+	hc5?61 |\
+	zc9525 |\
+	zc9526 |\
 	zbt-wa05)
 		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 		ucidef_add_switch "switch0" "1" "1"
@@ -184,6 +189,22 @@ ramips_setup_interfaces()
 		ucidef_add_switch_vlan "switch0" "2" "0 6t"
 		;;
 
+	zc9527)
+		ucidef_set_interface_ap_lan "eth0.1 eth0.2"
+		#ucidef_add_switch "switch0" "1" "1"
+		#ucidef_add_switch_vlan "switch0" "1" "1 2 3 4 6t"
+		#ucidef_add_switch_vlan "switch0" "2" "0 6t"
+		;;
+
+	hc5661a |\
+	kt9762 |\
+	zc9525a)
+		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
+		ucidef_add_switch "switch0" "1" "1"
+		ucidef_add_switch_vlan "switch0" "1" "0 1 2 3 6t"
+		ucidef_add_switch_vlan "switch0" "2" "4 6t"
+		;;
+
 	ur-336un)
 		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
 		;;
@@ -385,6 +406,32 @@ ramips_setup_macs()
 		wan_mac=$(mtd_get_mac_binary factory 4)
 		lan_mac=$(mtd_get_mac_binary factory 46)
 		;;
+	kt9762 |\
+	kt9990 |\
+	kt9962)
+		lan_mac=`mtd_get_mac_ascii bdinfo "&fac_mac "`
+		[ -n "$lan_mac" ] || lan_mac=$(cat /sys/class/net/eth0/address)
+		wan_mac=$(macaddr_add "$lan_mac" 1)
+		;;
+	zc9525 |\
+	zc9526 |\
+	zc9525a |\
+	hc5661a |\
+	hc5661 |\
+	hc5761 |\
+	hc5861)
+		lan_mac=`mtd_get_mac_ascii bdinfo "Vfac_mac "`
+		[ -n "$lan_mac" ] || lan_mac=$(cat /sys/class/net/eth0/address)
+		wan_mac=$(macaddr_add "$lan_mac" 1)
+		;;
+	# gukq 20160707 changed for ap to get mac-addr
+	zc9527)
+		lan_mac=`mtd_get_mac_ascii bdinfo "Vfac_mac "`
+		[ -n "$lan_mac" ] || lan_mac=$(cat /sys/class/net/eth0/address)
+		wan_mac=$(macaddr_add "$lan_mac" 1)
+		[ -n "$lan_mac" ] && ucidef_set_interface_macaddr ap $lan_mac
+		;;
+
 	*)
 		lan_mac=$(cat /sys/class/net/eth0/address)
 		wan_mac=$(macaddr_add "$lan_mac" 1)
diff -urpN target_orig/linux/ramips/base-files/etc/diag.sh target/linux/ramips/base-files/etc/diag.sh
--- target_orig/linux/ramips/base-files/etc/diag.sh	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/etc/diag.sh	2016-07-18 09:34:16.833095036 +0800
@@ -253,6 +253,33 @@ get_status_led() {
 	zte-q7)
 		status_led="zte:red:status"
 		;;
+	zc9525)
+		status_led="zc9525:blue:system"
+		;;
+	zc9525a)
+		status_led="zc9525a:blue:system"
+		;;
+	zc9526)
+		status_led="zc9526:blue:system"
+		;;
+	kt9762)
+		status_led="kt9762:blue:system"
+		;;
+	zc9527)
+		status_led="zc9527:blue:system"
+		;;
+	hc5661)
+		status_led="hc5661:blue:system"
+		;;
+	hc5661a)
+		status_led="hc5661a:blue:system"
+		;;
+	hc5761)
+		status_led="hc5761:blue:system"
+		;;
+	hc5861)
+		status_led="hc5861:blue:system"
+		;;
 	esac
 }
 
diff -urpN target_orig/linux/ramips/base-files/etc/inittab target/linux/ramips/base-files/etc/inittab
--- target_orig/linux/ramips/base-files/etc/inittab	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/etc/inittab	2016-07-18 09:34:16.833095036 +0800
@@ -1,3 +1,3 @@
 ::sysinit:/etc/init.d/rcS S boot
 ::shutdown:/etc/init.d/rcS K shutdown
-::askconsole:/bin/ash --login
+ttyS0::askfirst:/bin/ash --login
diff -urpN target_orig/linux/ramips/base-files/etc/uci-defaults/12_move-mac80211-file target/linux/ramips/base-files/etc/uci-defaults/12_move-mac80211-file
--- target_orig/linux/ramips/base-files/etc/uci-defaults/12_move-mac80211-file	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/base-files/etc/uci-defaults/12_move-mac80211-file	2016-07-18 09:34:16.837095036 +0800
@@ -0,0 +1,9 @@
+#!/bin/sh
+
+IS_MT7620_LOAD=`ls /sys/module|grep mt7620`
+[ -z $IS_MT7620_LOAD ] && exit 0
+
+# gukq 20160531 commenttd 2lines
+#[ -f /lib/wifi/mac80211.sh ] && echo "" > /lib/wifi/mac80211.sh
+#[ -f /lib/netifd/wireless/mac80211.sh ] && echo "" > /lib/netifd/wireless/mac80211.sh
+exit 0
diff -urpN target_orig/linux/ramips/base-files/lib/ramips.sh target/linux/ramips/base-files/lib/ramips.sh
--- target_orig/linux/ramips/base-files/lib/ramips.sh	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/lib/ramips.sh	2016-07-18 09:34:16.837095036 +0800
@@ -3,6 +3,8 @@
 # Copyright (C) 2010-2013 OpenWrt.org
 #
 
+# LIUDF 20160210 added RAMIPS_BOARD_TYPE
+RAMIPS_BOARD_TYPE=
 RAMIPS_BOARD_NAME=
 RAMIPS_MODEL=
 
@@ -433,17 +435,85 @@ ramips_board_detect() {
 			name="linkits7688"
 		fi
 		;;
+	*"KunTeng ZC9525")
+		RAMIPS_BOARD_TYPE="9525"	
+		name="zc9525"
+		;;
+	*"KunTeng ZC9525A")
+		RAMIPS_BOARD_TYPE="9525a"
+		name="zc9525a"
+		;;
+	*"KunTeng ZC9526")
+		RAMIPS_BOARD_TYPE="9526"
+		name="zc9526"
+		;;
+	*"KunTeng ZC9527")
+		RAMIPS_BOARD_TYPE="9527"
+		name="zc9527"
+		;;
+	*"KunTeng KT9762")
+		RAMIPS_BOARD_TYPE="9762"
+		name="kt9762"
+		;;
+	*"KunTeng KT9962")
+		RAMIPS_BOARD_TYPE="9962"
+		name="kt9962"
+		;;
+	*"KunTeng KT9990")
+		RAMIPS_BOARD_TYPE="9990"
+		name="kt9990"
+		;;
+	*"HiWiFi HC5661")
+		name="hc5661"
+		;;
+	*"HiWiFi HC5661A")
+		name="hc5661a"
+		;;
+	*"HiWiFi HC5761")
+		name="hc5761"
+		;;
+	*"HiWiFi HC5861")
+		name="hc5861"
+		;;
 	*)
 		name="generic"
 		;;
 	esac
-
+	
+	#liudf 20160210 added	
+	[ -z "$RAMIPS_BOARD_TYPE" ] && RAMIPS_BOARD_TYPE="$name"
 	[ -z "$RAMIPS_BOARD_NAME" ] && RAMIPS_BOARD_NAME="$name"
 	[ -z "$RAMIPS_MODEL" ] && RAMIPS_MODEL="$machine"
 
 	[ -e "/tmp/sysinfo/" ] || mkdir -p "/tmp/sysinfo/"
-
+	
+	#liudf 20160210 added
+	#echo "$RAMIPS_BOARD_TYPE" > /tmp/sysinfo/board_tye
 	echo "$RAMIPS_BOARD_NAME" > /tmp/sysinfo/board_name
+
+	#victor 20160518 check oem board_name
+	# default board_type=board_name
+	echo "$RAMIPS_BOARD_NAME" > /tmp/sysinfo/board_type
+	check_jpm='/usr/lib/opkg/info/jpm-base-files.control'
+	if [ -f $check_jpm ]
+	then
+		echo "jpm""$RAMIPS_BOARD_TYPE" > /tmp/sysinfo/board_type
+	fi
+	check_mili='/usr/lib/opkg/info/mili-wifidog.control'
+	if [ -f $check_mili ]
+	then
+		echo "mili""$RAMIPS_BOARD_TYPE" > /tmp/sysinfo/board_type
+	fi
+	#end victor
+	
+	# gukq 20160531 add saier oem support
+	check_saier='/usr/lib/opkg/info/saier_go.control'
+	if [ -f $check_saier ]
+	then
+		echo "saier""$RAMIPS_BOARD_TYPE" > /tmp/sysinfo/board_type
+	fi
+	# end gukq
+
 	echo "$RAMIPS_MODEL" > /tmp/sysinfo/model
 }
 
@@ -454,4 +524,14 @@ ramips_board_name() {
 	[ -z "$name" ] && name="unknown"
 
 	echo "$name"
+}
+
+#liudf 20160210 added
+ramips_board_type() {
+	local name
+
+	[ -f /tmp/sysinfo/board_type ] && name=$(cat /tmp/sysinfo/board_type)
+	[ -z "$name" ] && name="unknown"
+
+	echo "$name"
 }
diff -urpN target_orig/linux/ramips/base-files/lib/upgrade/platform.sh target/linux/ramips/base-files/lib/upgrade/platform.sh
--- target_orig/linux/ramips/base-files/lib/upgrade/platform.sh	2016-06-17 15:12:18.492786386 +0800
+++ target/linux/ramips/base-files/lib/upgrade/platform.sh	2016-07-18 09:34:16.837095036 +0800
@@ -124,6 +124,17 @@ platform_check_image() {
 	x5 |\
 	x8 |\
 	xiaomi-miwifi-mini |\
+	hc5661 |\
+	hc5661a |\
+	hc5761 |\
+	hc5861 |\
+	zc9525 |\
+	zc9525a |\
+	kt9762 |\
+	zc9526 |\
+	zc9527 |\
+	kt9962 |\
+	kt9990 |\
 	y1 |\
 	y1s |\
 	zbt-wa05 |\
@@ -179,15 +190,30 @@ platform_check_image() {
 	return 1
 }
 
+#zhangzf 20160527 modify add kt9962 upgrade
 platform_do_upgrade() {
 	local board=$(ramips_board_name)
 
 	case "$board" in
+	kt9962)
+		kt_do_upgrade  "$ARGV"
+		;;
 	*)
 		default_do_upgrade "$ARGV"
 		;;
 	esac
 }
+
+#zhangzf 20160527 add
+platform_copy_config() {
+	local board=$(ramips_board_name)
+
+	case "$board" in
+	kt9962)
+		nand_kt_copy_config  "$ARGV"
+		;;
+	esac
+}
 
 disable_watchdog() {
 	killall watchdog
diff -urpN target_orig/linux/ramips/base-files/lib/wifi/ralink_common.sh target/linux/ramips/base-files/lib/wifi/ralink_common.sh
--- target_orig/linux/ramips/base-files/lib/wifi/ralink_common.sh	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/base-files/lib/wifi/ralink_common.sh	2016-07-18 09:34:16.837095036 +0800
@@ -0,0 +1,329 @@
+# this file will be included in 
+#     /lib/wifi/mt{chipname}.sh
+
+repair_wireless_uci() {
+    echo "repair_wireless_uci" >>/tmp/wifi.log
+    vifs=`uci show wireless | grep "=wifi-iface" | sed -n "s/=wifi-iface//gp"`
+    echo $vifs >>/tmp/wifi.log
+
+    ifn5g=0
+    ifn2g=0
+    for vif in $vifs; do
+        local netif nettype device netif_new 
+        echo  "<<<<<<<<<<<<<<<<<" >>/tmp/wifi.log
+        netif=`uci -q get ${vif}.ifname`
+        nettype=`uci -q get ${vif}.network`
+        device=`uci -q get ${vif}.device`
+        if [ "$device" == "" ]; then
+            echo "device cannot be empty!!" >>/tmp/wifi.log
+            return
+        fi
+
+        echo "device name $device!!" >>/tmp/wifi.log
+        echo "netif $netif" >>/tmp/wifi.log
+        echo "nettype $nettype" >>/tmp/wifi.log
+  	echo "mode $mode" >>/tmp/wifi.log
+
+        case "$device" in
+            mt7620 | mt7602e | mt7603e | mt7628 | mt7688 | rt2860v2)
+		netif_new="ra"${ifn2g}
+               	ifn2g=$(( $ifn2g + 1 ))
+                ;;
+            mt7610e | mt7612e )
+                netif_new="rai"${ifn5g}
+                ifn5g=$(( $ifn5g + 1 ))
+                ;;
+            * )
+                echo "device $device not recognized!! " >>/tmp/wifi.log
+                ;;
+        esac                    
+    
+        echo "ifn5g=${ifn5g}, ifn5g_cli=${ifn5g_cli}, ifn2g=${ifn2g} ifn2g_cli={$ifn2g_cli}" >>/tmp/wifi.log
+        echo "netif_new = ${netif_new}" >>/tmp/wifi.log
+            
+        if [ "$netif" == "" ]; then
+            echo "ifname empty, we'll fix it with ${netif_new}" >>/tmp/wifi.log
+            uci -q set ${vif}.ifname=${netif_new}
+        fi
+        if [ "$nettype" == "" ]; then
+            nettype="lan"
+            echo "nettype empty, we'll fix it with ${nettype}" >>/tmp/wifi.log
+            uci -q set ${vif}.network=${nettype}
+        fi
+        echo  ">>>>>>>>>>>>>>>>>" >>/tmp/wifi.log
+    done
+    uci changes >>/tmp/wifi.log
+    uci commit
+}
+
+
+sync_uci_with_dat() {
+    #victor@20151223 fix wireless mac address.
+    . /lib/functions/system.sh
+    . /lib/functions.sh
+
+    local lan_mac=`mtd_get_mac_ascii bdinfo "Vfac_mac "`
+    [ -z $lan_mac ] &&  lan_mac=`mtd_get_mac_ascii bdinfo "&fac_mac "`   
+
+    if [ $1 = 'mt7610e' ] || [ $1 = 'mt7612e' ];
+    then
+        wifi_mac=$(macaddr_add "$lan_mac" 1)
+    else
+        wifi_mac=$lan_mac
+    fi
+
+    #end victor
+    echo "sync_uci_with_dat($1,$2,$3,$4,$wifi_mac)" >>/tmp/wifi.log
+    local device="$1"
+    local datpath="$2"
+    #uci2dat -d $device -f $datpath > /tmp/uci2dat.log
+    uci2dat -d $device -f $datpath $wifi_mac > /tmp/uci2dat.log
+}
+
+
+
+chk8021x() {
+        local x8021x="0" encryption device="$1" prefix
+        #vifs=`uci show wireless | grep "=wifi-iface" | sed -n "s/=wifi-iface//gp"`
+        echo "u8021x dev $device" > /tmp/802.$device.log
+        config_get vifs "$device" vifs
+        for vif in $vifs; do
+                config_get ifname $vif ifname
+                echo "ifname = $ifname" >> /tmp/802.$device.log
+                config_get encryption $vif encryption
+                echo "enc = $encryption" >> /tmp/802.$device.log
+                case "$encryption" in
+                        wpa+*)
+                                [ "$x8021x" == "0" ] && x8021x=1
+                                echo 111 >> /tmp/802.$device.log
+                                ;;
+                        wpa2+*)
+                                [ "$x8021x" == "0" ] && x8021x=1
+                                echo 1l2 >> /tmp/802.$device.log
+                                ;;
+                        wpa-mixed*)
+                                [ "$x8021x" == "0" ] && x8021x=1
+                                echo 1l3 >> /tmp/802.$device.log
+                                ;;
+                esac
+                ifpre=$(echo $ifname | cut -c1-3)
+                echo "prefix = $ifpre" >> /tmp/802.$device.log
+                if [ "$ifpre" == "rai" ]; then
+                    prefix="rai"
+                else
+                    prefix="ra"
+                fi
+                if [ "1" == "$x8021x" ]; then
+                    break
+                fi
+        done
+        echo "x8021x $x8021x, pre $prefix" >>/tmp/802.$device.log
+        if [ "1" == $x8021x ]; then
+            if [ "$prefix" == "ra" ]; then
+                echo "killall 8021xd" >>/tmp/802.$device.log
+                killall 8021xd
+                echo "/bin/8021xd -d 9" >>/tmp/802.$device.log
+                /bin/8021xd -d 9 >> /tmp/802.$device.log 2>&1
+            else # $prefixa == rai
+                echo "killall 8021xdi" >>/tmp/802.$device.log
+                killall 8021xdi
+                echo "/bin/8021xdi -d 9" >>/tmp/802.$device.log
+                /bin/8021xdi -d 9 >> /tmp/802.$device.log 2>&1
+            fi
+        else
+            if [ "$prefix" == "ra" ]; then
+                echo "killall 8021xd" >>/tmp/802.$device.log
+                killall 8021xd
+            else # $prefixa == rai
+                echo "killall 8021xdi" >>/tmp/802.$device.log
+                killall 8021xdi
+            fi
+        fi
+}
+
+
+# $1=device, $2=module
+reinit_wifi() {
+    echo "reinit_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    local device="$1"
+    local module="$2"
+    config_get vifs "$device" vifs
+
+    # shut down all vifs first
+    for vif in $vifs; do
+        config_get ifname $vif ifname
+        ifconfig $ifname down
+    done
+
+    # in some case we have to reload drivers. (mbssid eg)
+    #ref=`cat /sys/module/$module/refcnt`
+    #if [ $ref != "0" ]; then
+    #    # but for single driver, we only need to reload once.
+    #    echo "$module ref=$ref, skip reload module" >>/tmp/wifi.log
+    #else
+    #    echo "rmmod $module" >>/tmp/wifi.log
+    #    rmmod $module
+    #    echo "insmod $module" >>/tmp/wifi.log
+    #    insmod $module
+    #fi
+
+    # bring up vifs
+    for vif in $vifs; do
+        config_get ifname $vif ifname
+        config_get disabled $vif disabled
+        echo "ifconfig $ifname down" >>/tmp/wifi.log
+        if [ "$disabled" == "1" ]; then
+            echo "$ifname marked disabled, skip" >>/tmp/wifi.log
+            continue
+        else
+            echo "ifconfig $ifname up" >>/tmp/wifi.log
+            ifconfig $ifname up
+        fi
+    done
+
+    chk8021x $device
+}
+
+prepare_ralink_wifi() {
+    echo "prepare_ralink_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    local device=$1
+    config_get channel $device channel
+    config_get ssid $2 ssid
+    config_get mode $device mode
+    config_get ht $device ht
+    config_get country $device country
+    config_get regdom $device regdom
+
+    # HT40 mode can be enabled only in bgn (mode = 9), gn (mode = 7)
+    # or n (mode = 6).
+    HT=0
+    [ "$mode" = 6 -o "$mode" = 7 -o "$mode" = 9 ] && [ "$ht" != "20" ] && HT=1
+
+    # In HT40 mode, a second channel is used. If EXTCHA=0, the extra
+    # channel is $channel + 4. If EXTCHA=1, the extra channel is
+    # $channel - 4. If the channel is fixed to 1-4, we'll have to
+    # use + 4, otherwise we can just use - 4.
+    EXTCHA=0
+    [ "$channel" != auto ] && [ "$channel" -lt "5" ] && EXTCHA=1
+    
+}
+
+scan_ralink_wifi() {
+    local device="$1"
+    local module="$2"
+    echo "scan_ralink_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    repair_wireless_uci
+    sync_uci_with_dat $device /etc/wireless/$device/$device.dat
+}
+
+disable_ralink_wifi() {
+    echo "disable_ralink_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    local device="$1"
+    config_get vifs "$device" vifs
+    for vif in $vifs; do
+        config_get ifname $vif ifname
+        ifconfig $ifname down
+		# liudf added 20150325
+		# only support 2.4g apcli now
+		[ "$ifname" = "ra0" ] && {
+			ifconfig apcli0 down
+		}
+    done
+
+    # kill any running ap_clients
+    killall ap_client || true
+}
+
+enable_ralink_wifi() {
+    echo "enable_ralink_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    local device="$1"
+    config_get vifs "$device" vifs
+
+    # bring up vifs
+    for vif in $vifs; do
+        config_get ifname $vif ifname
+        config_get disabled $vif disabled
+		config_get radio $device radio
+		config_get apcli_enable $vif apcli_enable
+        ifconfig $ifname down
+		
+        echo "ifconfig $ifname down" >>/dev/null
+        if [ "$disabled" == "1" ]; then
+            echo "$ifname marked disabled, skip" >>/dev/null
+            continue
+        else
+            echo "ifconfig $ifname up" >>/dev/null
+            ifconfig $ifname up
+        fi
+		# liudf added 20150325
+		[ "$apcli_enable" = "1" -a "$ifname" = "ra0" ] && {
+			config_get apcli_ssid $vif apcli_ssid
+			[ ! -z "$apcli_ssid" ] && {
+				echo "ifconfig apcli0 up" >> /tmp/wifi.log
+				ifconfig apcli0 up
+			} || {
+				echo "need apcli_ssid parameter"
+				ifconfig apcli0 down
+			}
+		}
+		#Radio On/Off only support iwpriv command but dat file
+        [ "$radio" == "0" ] && iwpriv $ifname set RadioOn=0
+        local net_cfg bridge
+        net_cfg="$(find_net_config "$vif")"
+        [ -z "$net_cfg" ] || {
+            bridge="$(bridge_interface "$net_cfg")"
+            config_set "$vif" bridge "$bridge"
+            start_net "$ifname" "$net_cfg"
+        }
+
+		chk8021x $device
+        set_wifi_up "$vif" "$ifname"
+    done
+}
+
+detect_ralink_wifi() {
+    echo "detect_ralink_wifi($1,$2,$3,$4)" >>/tmp/wifi.log
+    local channel
+    local device="$1"
+    local module="$2"
+    local band
+    local ifname
+    cd /sys/module/
+    [ -d $module ] || return
+    config_get channel $device channel
+    [ -z "$channel" ] || return
+    case "$device" in
+        mt7620 | mt7602e | mt7603e | mt7628 | rt2860v2 )
+            ifname="ra0"
+            band="2.4G"
+            ;;
+        mt7610e | mt7612e )
+            ifname="rai0"
+            band="5G"
+            ;;
+        * )
+            echo "device $device not recognized!! " >>/tmp/wifi.log
+            ;;
+    esac                    
+    cat <<EOF
+config wifi-device    $device
+    option type     $device
+    option vendor   ralink
+    option band     $band
+    option channel  0
+    option autoch   2
+
+config wifi-iface
+    option device   $device
+    option ifname    $ifname
+    option network  lan
+    option mode     ap
+    option ssid ApFree-$device
+    option encryption psk2
+    option key      12345678
+
+EOF
+}
+
+
+
diff -urpN target_orig/linux/ramips/dts/HC5661A.dts target/linux/ramips/dts/HC5661A.dts
--- target_orig/linux/ramips/dts/HC5661A.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/HC5661A.dts	2016-07-18 09:34:16.841095038 +0800
@@ -0,0 +1,186 @@
+/dts-v1/;
+
+/include/ "mt7628an.dtsi"
+
+/ {
+	compatible = "HC5661A", "mediatek,mt7628an-soc";
+	model = "HiWiFi HC5661A";
+
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x8000000>;
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "gpio";
+				ralink,function = "gpio";
+			};
+			perst {
+				ralink,group = "perst";
+				ralink,function = "gpio";
+			};
+			refclk {
+				ralink,group = "refclk";
+				ralink,function = "gpio";
+			};
+			i2s {
+				ralink,group = "i2s";
+				ralink,function = "gpio";
+			};
+			spis {
+				ralink,group = "spis";
+				ralink,function = "gpio";
+			};
+			wled_kn {
+				ralink,group = "wled_kn";
+				ralink,function = "gpio";
+			};
+			wled_an {
+				ralink,group = "wled_an";
+				ralink,function = "wled_an";
+			};
+			wdt {
+				ralink,group = "wdt";
+				ralink,function = "gpio";
+			};
+		};
+	};
+
+	palmbus@10000000 {
+		spi@b00 {
+			status = "okay";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&spi_pins>, <&spi_cs1_pins>;
+
+			m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "w25q128";
+				reg = <0 0>;
+				linux,modalias = "m25p80", "w25q128";
+				spi-max-frequency = <10000000>;
+				m25p,chunked-io = <31>;
+
+				partition@0 {
+					label = "u-boot";
+					reg = <0x0 0x30000>;
+					read-only;
+				};
+
+				partition@30000 {
+					label = "u-boot-env";
+					reg = <0x30000 0x10000>;
+				};
+
+				factory: partition@40000 {
+					label = "factory";
+					reg = <0x40000 0x10000>;
+					read-only;
+				};
+
+				partition@50000 {
+					label = "firmware";
+					reg = <0x50000 0xf80000>;
+				};
+				
+				partition@fd0000 {
+					label = "hwf_config";
+					reg = <0xfd0000 0x10000>;
+				};
+
+				bdinfo: partition@fe0000 {
+					label = "bdinfo";
+					reg = <0xfe0000 0x10000>;
+				};
+
+				partition@ff0000 {
+					label = "backup";
+					reg = <0xff0000 0x10000>;
+				};
+			};
+
+			spidev@1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "spidev";
+				reg = <1 0>;
+				spi-max-frequency = <40000000>;
+			};
+		};
+
+		i2c@900 {
+			status = "okay";
+		};
+
+		uart1@d00 {
+			status = "okay";
+		};
+
+		uart2@e00 {
+			status = "okay";
+		};
+
+		pwm@5000 {
+			status = "okay";
+		};
+	};
+
+	ethernet@10100000 {
+		mtd-mac-address = <&factory 0x4>;
+		ralink,port-map = "llllw";
+	};
+	
+	pcie@10140000 {
+		status = "okay";
+	};
+
+	sdhci@10130000 {
+		status = "okay";
+		mediatek,cd-high;
+//		mediatek,cd-poll;
+	};
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5661a:blue:system";
+			gpios = <&gpio0 5 1>;
+		};
+		
+		internet {
+			label = "hc5661a:blue:internet";
+			gpios = <&gpio0 1 1>;
+		};
+		
+		wlan2g {
+			label = "hc5661a:blue:wlan2g";
+			gpios = <&gpio1 9 1>;
+		};
+		
+		wlan5g {
+			label = "hc5661a:blue:wlan5g";
+			gpios = <&gpio1 8 1>;
+		};
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+	
+		reset {
+			label = "reset";
+			gpios = <&gpio1 6 1>;
+			linux,code = <0x198>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/HC5661.dts target/linux/ramips/dts/HC5661.dts
--- target_orig/linux/ramips/dts/HC5661.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/HC5661.dts	2016-07-18 09:34:16.841095038 +0800
@@ -0,0 +1,32 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "HC5661", "ralink,mt7620a-soc";
+	model = "HiWiFi HC5661";
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5661:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		internet {
+			label = "hc5661:blue:internet";
+			gpios = <&gpio0 11 1>;
+		};
+
+		wlan2g {
+			label = "hc5661:blue:wlan2g";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5661:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/HC5761.dts target/linux/ramips/dts/HC5761.dts
--- target_orig/linux/ramips/dts/HC5761.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/HC5761.dts	2016-07-18 09:34:16.841095038 +0800
@@ -0,0 +1,32 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "HC5761", "ralink,mt7620a-soc";
+	model = "HiWiFi HC5761";
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5761:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		internet {
+			label = "hc5761:blue:internet";
+			gpios = <&gpio0 11 1>;
+		};
+
+		wlan2g {
+			label = "hc5761:blue:wlan2g";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5761:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/HC5861.dts target/linux/ramips/dts/HC5861.dts
--- target_orig/linux/ramips/dts/HC5861.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/HC5861.dts	2016-07-18 09:34:16.841095038 +0800
@@ -0,0 +1,92 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "HC5861", "ralink,mt7620a-soc";
+	model = "HiWiFi HC5861";
+
+	ethernet@10100000 {
+		status = "okay";
+		mtd-mac-address = <&factory 0x4>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&rgmii1_pins &rgmii2_pins &mdio_pins>;
+		ralink,port-map = "wllll";
+
+		port@4 {
+			status = "okay";
+			phy-handle = <&phy4>;
+			phy-mode = "rgmii";
+		};
+
+		port@5 {
+			status = "okay";
+			phy-handle = <&phy5>;
+			phy-mode = "rgmii";
+		};
+
+		mdio-bus {
+			status = "okay";
+
+			phy4: ethernet-phy@4 {
+				reg = <4>;
+				phy-mode = "rgmii";
+			};
+
+			phy5: ethernet-phy@5 {
+				reg = <5>;
+				phy-mode = "rgmii";
+			};
+		};
+	};
+
+	gsw@10110000 {
+		ralink,port4 = "gmac";
+	};
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5861:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		wlan2g {
+			label = "hc5861:blue:wlan2g";
+			gpios = <&gpio0 11 1>;
+		};
+
+		internet {
+			label = "hc5861:blue:internet";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5861:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+
+		turbo {
+			label = "hc5861:blue:turbo";
+			gpios = <&gpio0 10 1>;
+		};
+	};
+
+	gpio_export {
+		compatible = "gpio-export";
+		#size-cells = <0>;
+
+		usbpower {
+			gpio-export,name = "usbpower";
+			gpio-export,output = <0>;
+			gpios = <&gpio0 13 0>;
+		};
+
+		sdpower {
+			gpio-export,name = "sdpower";
+			gpio-export,output = <0>;
+			gpios = <&gpio0 8 0>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/HC5XXX.dtsi target/linux/ramips/dts/HC5XXX.dtsi
--- target_orig/linux/ramips/dts/HC5XXX.dtsi	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/HC5XXX.dtsi	2016-07-18 09:34:16.841095038 +0800
@@ -0,0 +1,141 @@
+/include/ "mt7620a.dtsi"
+
+/ {
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	palmbus@10000000 {
+		sysc@0 {
+			ralink,gpiomux = "i2c", "jtag";
+			ralink,uartmux = "gpio";
+			ralink,wdtmux = <1>;
+		};
+
+		gpio0: gpio@600 {
+			status = "okay";
+		};
+
+		gpio2: gpio@660 {
+			status = "okay";
+		};
+
+		gpio3: gpio@688 {
+			status = "okay";
+		};
+
+		spi@b00 {
+			status = "okay";
+
+			m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "w25q128";
+				reg = <0 0>;
+				linux,modalias = "m25p80", "w25q128";
+				spi-max-frequency = <10000000>;
+
+				partition@0 {
+					label = "u-boot";
+					reg = <0x0 0x30000>;
+				};
+
+				partition@30000 {
+					label = "u-boot-env";
+					reg = <0x30000 0x10000>;
+					read-only;
+				};
+
+				factory: partition@40000 {
+					label = "factory";
+					reg = <0x40000 0x10000>;
+				};
+
+				partition@50000 {
+					label = "firmware";
+					reg = <0x50000 0xf80000>;
+				};
+
+				partition@fd0000 {
+					label = "hwf_config";
+					reg = <0xfd0000 0x10000>;
+				};
+
+				bdinfo: partition@fe0000 {
+					label = "bdinfo";
+					reg = <0xfe0000 0x10000>;
+				};
+
+				partition@ff0000 {
+					label = "backup";
+					reg = <0xff0000 0x10000>;
+				};
+			};
+		};
+	};
+
+	ehci@101c0000 {
+		status = "okay";
+	};
+
+	ohci@101c1000 {
+		status = "okay";
+	};
+
+	ethernet@10100000 {
+		pinctrl-names = "default";
+		pinctrl-0 = <&ephy_pins>;
+		mtd-mac-address = <&factory 0x4>;
+		ralink,port-map = "wllll";
+	};
+
+	sdhci@10130000 {
+		status = "okay";
+	};
+
+	wmac@10180000 {
+		ralink,mtd-eeprom = <&factory 0>;
+	};
+
+	pcie@10140000 {
+		status = "okay";
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "uartf", "wled", "nd_sd";
+				ralink,function = "gpio";
+			};
+
+			pa {
+				ralink,group = "pa";
+				ralink,function = "pa";
+			};
+		};
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+
+		reset {
+			label = "reset";
+			gpios = <&gpio0 12 1>;
+			linux,code = <0x198>;
+		};
+	};
+
+	gpio_export {
+		compatible = "gpio-export";
+		#size-cells = <0>;
+
+		usbpower {
+			gpio-export,name = "usbpower";
+			gpio-export,output = <1>;
+			gpios = <&gpio0 13 0>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/KT9762.dts target/linux/ramips/dts/KT9762.dts
--- target_orig/linux/ramips/dts/KT9762.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/KT9762.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,186 @@
+/dts-v1/;
+
+/include/ "mt7628an.dtsi"
+
+/ {
+	compatible = "KT9762", "mediatek,mt7628an-soc";
+	model = "KunTeng KT9762";
+
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x8000000>;
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "gpio";
+				ralink,function = "gpio";
+			};
+			perst {
+				ralink,group = "perst";
+				ralink,function = "gpio";
+			};
+			refclk {
+				ralink,group = "refclk";
+				ralink,function = "gpio";
+			};
+			i2s {
+				ralink,group = "i2s";
+				ralink,function = "gpio";
+			};
+			spis {
+				ralink,group = "spis";
+				ralink,function = "gpio";
+			};
+			wled_kn {
+				ralink,group = "wled_kn";
+				ralink,function = "gpio";
+			};
+			wled_an {
+				ralink,group = "wled_an";
+				ralink,function = "wled_an";
+			};
+			wdt {
+				ralink,group = "wdt";
+				ralink,function = "gpio";
+			};
+		};
+	};
+
+	palmbus@10000000 {
+		spi@b00 {
+			status = "okay";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&spi_pins>, <&spi_cs1_pins>;
+
+			m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "w25q128";
+				reg = <0 0>;
+				linux,modalias = "m25p80", "w25q128";
+				spi-max-frequency = <10000000>;
+				m25p,chunked-io = <31>;
+
+				partition@0 {
+					label = "u-boot";
+					reg = <0x0 0x30000>;
+					read-only;
+				};
+
+				partition@30000 {
+					label = "u-boot-env";
+					reg = <0x30000 0x10000>;
+				};
+
+				factory: partition@40000 {
+					label = "factory";
+					reg = <0x40000 0x10000>;
+					read-only;
+				};
+
+				partition@50000 {
+					label = "firmware";
+					reg = <0x50000 0xf80000>;
+				};
+				
+				partition@fd0000 {
+					label = "hwf_config";
+					reg = <0xfd0000 0x10000>;
+				};
+
+				bdinfo: partition@fe0000 {
+					label = "bdinfo";
+					reg = <0xfe0000 0x10000>;
+				};
+
+				partition@ff0000 {
+					label = "backup";
+					reg = <0xff0000 0x10000>;
+				};
+			};
+
+			spidev@1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "spidev";
+				reg = <1 0>;
+				spi-max-frequency = <40000000>;
+			};
+		};
+
+		i2c@900 {
+			status = "okay";
+		};
+
+		uart1@d00 {
+			status = "okay";
+		};
+
+		uart2@e00 {
+			status = "okay";
+		};
+
+		pwm@5000 {
+			status = "okay";
+		};
+	};
+
+	ethernet@10100000 {
+		mtd-mac-address = <&factory 0x4>;
+		ralink,port-map = "llllw";
+	};
+	
+	pcie@10140000 {
+		status = "okay";
+	};
+
+	sdhci@10130000 {
+		status = "okay";
+		mediatek,cd-high;
+//		mediatek,cd-poll;
+	};
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5661a:blue:system";
+			gpios = <&gpio1 5 1>;
+		};
+		
+		internet {
+			label = "hc5661a:blue:internet";
+			gpios = <&gpio0 1 0>;
+		};
+		
+		wlan2g {
+			label = "hc5661a:blue:wlan2g";
+			gpios = <&gpio1 12 0>;
+		};
+		
+		wlan5g {
+			label = "hc5661a:blue:wlan5g";
+			gpios = <&gpio1 8 0>;
+		};
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+	
+		reset {
+			label = "reset";
+			gpios = <&gpio1 6 1>;
+			linux,code = <0x198>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/KT9962.dts target/linux/ramips/dts/KT9962.dts
--- target_orig/linux/ramips/dts/KT9962.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/KT9962.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,156 @@
+/dts-v1/;
+
+/include/ "mt7621.dtsi"
+
+/ {
+	compatible = "mediatek,mt7621-eval-board", "mediatek,mt7621-soc";
+	model = "KunTeng KT9962";
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x10000000>;
+	};
+
+	palmbus@1E000000 {
+		spi@b00 {
+			status="disabled";
+		};
+	};
+
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	nand@1e003000 {
+		status = "okay";
+
+		partition@0 {
+			label = "u-boot";
+			reg = <0x0 0x80000>;
+			read-only;
+		};
+
+		partition@80000 {
+			label = "debug";
+			reg = <0x80000 0x80000>;
+		};
+
+		factory: partition@100000 {
+			label = "factory";
+			reg = <0x100000 0x40000>;
+			read-only;
+		};
+		
+		firmware {
+			label = "firmware";
+			reg = <0x140000 0x2000000>;
+		};
+
+		partition@140000 {
+			label = "kernel";
+			reg = <0x140000 0x200000>;
+		};
+
+		partition@340000 {
+			label = "ubi";
+			reg = <0x340000 0x1E00000>;
+		};
+		
+		partition@21c0000 {
+			label = "bdinfo";
+			reg = <0x21c0000 0x80000>;
+		};
+		partition@2240000 {
+			label = "reserver";
+			reg = <0x2240000 0x80000>;
+		};
+		
+		partition@22c0000 {
+			label = "overly";
+			reg = <0x22c0000 0x1000000>;
+		};
+		
+		partition@32c0000 {
+			label = "firmware_backup";
+			reg = <0x32c0000 0x2000000>;
+		};
+		
+		partition@52c0000 {
+			label = "opt";
+			reg = <0x52c0000 0x2cc0000>;
+		};				
+		
+	};
+
+	pcie@1e140000 {
+		status = "okay";
+
+		pcie0 {
+			mt76@0,0 {
+				reg = <0x0000 0 0 0 0>;
+				device_type = "pci";
+				mediatek,mtd-eeprom = <&factory 0x8000>;
+				mediatek,2ghz = <0>;
+			};
+		};
+
+		pcie1 {
+			mt76@1,0 {
+				reg = <0x0000 0 0 0 0>;
+				device_type = "pci";
+				mediatek,mtd-eeprom = <&factory 0x0000>;
+				mediatek,5ghz = <0>;
+			};
+		};
+	};
+
+	ethernet@1e100000 {
+		mtd-mac-address = <&factory 0xe006>;
+	};	
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "kt9962:blue:system";
+			gpios = <&gpio0 6 1>;
+		};
+
+		internet {
+			label = "kt9962:blue:internet";
+			gpios = <&gpio0 15 1>;
+		};		
+		
+		wifi5g {
+			label = "kt9962:blue:wifi5g";
+			gpios = <&gpio0 7 1>;
+		};		
+		
+		wifi2g {
+			label = "kt9962:blue:wifi2g";
+			gpios = <&gpio0 8 1>;
+		};
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+
+		reset {
+			label = "reset";
+			gpios = <&gpio0 18 1>;
+			linux,code = <0x198>;
+		};
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "uart3", "jtag";
+				ralink,function = "gpio";
+			};
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/KT9990.dts target/linux/ramips/dts/KT9990.dts
--- target_orig/linux/ramips/dts/KT9990.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/KT9990.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,146 @@
+/dts-v1/;
+
+/include/ "mt7621.dtsi"
+
+/ {
+	compatible = "mediatek,mt7621-eval-board", "mediatek,mt7621-soc";
+	model = "KunTeng KT9990";
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x10000000>;
+	};
+
+	palmbus@1E000000 {
+		spi@b00 {
+			status="disabled";
+		};
+	};
+
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	nand@1e003000 {
+		status = "okay";
+
+		partition@0 {
+			label = "u-boot";
+			reg = <0x0 0x80000>;
+			read-only;
+		};
+
+		partition@80000 {
+			label = "debug";
+			reg = <0x80000 0x80000>;
+		};
+
+		factory: partition@100000 {
+			label = "factory";
+			reg = <0x100000 0x40000>;
+			read-only;
+		};
+		
+		firmware {
+			label = "firmware";
+			reg = <0x140000 0x2000000>;
+		};
+
+		partition@140000 {
+			label = "kernel";
+			reg = <0x140000 0x200000>;
+		};
+
+		partition@340000 {
+			label = "ubi";
+			reg = <0x340000 0x1E00000>;
+		};
+		
+		partition@21c0000 {
+			label = "bdinfo";
+			reg = <0x21c0000 0x80000>;
+		};
+		partition@2240000 {
+			label = "reserver";
+			reg = <0x2240000 0x80000>;
+		};
+		
+		partition@22c0000 {
+			label = "overly";
+			reg = <0x22c0000 0x1000000>;
+		};
+		
+		partition@32c0000 {
+			label = "firmware_backup";
+			reg = <0x32c0000 0x2000000>;
+		};
+		
+		partition@52c0000 {
+			label = "opt";
+			reg = <0x52c0000 0x2cc0000>;
+		};				
+		
+	};
+
+	pcie@1e140000 {
+		status = "okay";
+
+		pcie0 {
+			mt76@0,0 {
+				reg = <0x0000 0 0 0 0>;
+				device_type = "pci";
+				mediatek,mtd-eeprom = <&factory 0x8000>;
+				mediatek,2ghz = <0>;
+			};
+		};
+
+		pcie1 {
+			mt76@1,0 {
+				reg = <0x0000 0 0 0 0>;
+				device_type = "pci";
+				mediatek,mtd-eeprom = <&factory 0x0000>;
+				mediatek,5ghz = <0>;
+			};
+		};
+	};
+
+	ethernet@1e100000 {
+		mtd-mac-address = <&factory 0xe006>;
+	};	
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "kt9990:blue:system";
+			gpios = <&gpio0 6 1>;
+		};
+
+		internet {
+			label = "kt9990:blue:internet";
+			gpios = <&gpio0 15 1>;
+		};		
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+
+		reset {
+			label = "reset";
+			gpios = <&gpio0 18 1>;
+			linux,code = <0x198>;
+		};
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "uart3", "jtag";
+				ralink,function = "gpio";
+			};
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/LINKIT7688.dts target/linux/ramips/dts/LINKIT7688.dts
--- target_orig/linux/ramips/dts/LINKIT7688.dts	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/dts/LINKIT7688.dts	2016-07-18 09:34:16.841095038 +0800
@@ -163,4 +163,7 @@
 		#gpio-cells = <2>;
 	};
 
+	pcie@10140000 {
+		status = "okey";
+	};
 };
diff -urpN target_orig/linux/ramips/dts/ZC9525A.dts target/linux/ramips/dts/ZC9525A.dts
--- target_orig/linux/ramips/dts/ZC9525A.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/ZC9525A.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,181 @@
+/dts-v1/;
+
+/include/ "mt7628an.dtsi"
+
+/ {
+	compatible = "ZC9525A", "mediatek,mt7628an-soc";
+	model = "KunTeng ZC9525A";
+
+	chosen {
+		bootargs = "console=ttyS0,115200";
+	};
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x8000000>;
+	};
+
+	pinctrl {
+		state_default: pinctrl0 {
+			gpio {
+				ralink,group = "gpio";
+				ralink,function = "gpio";
+			};
+			perst {
+				ralink,group = "perst";
+				ralink,function = "gpio";
+			};
+			refclk {
+				ralink,group = "refclk";
+				ralink,function = "gpio";
+			};
+			i2s {
+				ralink,group = "i2s";
+				ralink,function = "gpio";
+			};
+			spis {
+				ralink,group = "spis";
+				ralink,function = "gpio";
+			};
+			wled_kn {
+				ralink,group = "wled_kn";
+				ralink,function = "gpio";
+			};
+			wled_an {
+				ralink,group = "wled_an";
+				ralink,function = "wled_an";
+			};
+			wdt {
+				ralink,group = "wdt";
+				ralink,function = "gpio";
+			};
+		};
+	};
+
+	palmbus@10000000 {
+		spi@b00 {
+			status = "okay";
+
+			pinctrl-names = "default";
+			pinctrl-0 = <&spi_pins>, <&spi_cs1_pins>;
+
+			m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "w25q128";
+				reg = <0 0>;
+				linux,modalias = "m25p80", "w25q128";
+				spi-max-frequency = <10000000>;
+				m25p,chunked-io = <31>;
+
+				partition@0 {
+					label = "u-boot";
+					reg = <0x0 0x30000>;
+					read-only;
+				};
+
+				partition@30000 {
+					label = "u-boot-env";
+					reg = <0x30000 0x10000>;
+				};
+
+				factory: partition@40000 {
+					label = "factory";
+					reg = <0x40000 0x10000>;
+					read-only;
+				};
+
+				partition@50000 {
+					label = "firmware";
+					reg = <0x50000 0xf80000>;
+				};
+				
+				partition@fd0000 {
+					label = "hwf_config";
+					reg = <0xfd0000 0x10000>;
+				};
+
+				bdinfo: partition@fe0000 {
+					label = "bdinfo";
+					reg = <0xfe0000 0x10000>;
+				};
+
+				partition@ff0000 {
+					label = "backup";
+					reg = <0xff0000 0x10000>;
+				};
+			};
+
+			spidev@1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "spidev";
+				reg = <1 0>;
+				spi-max-frequency = <40000000>;
+			};
+		};
+
+		i2c@900 {
+			status = "okay";
+		};
+
+		uart1@d00 {
+			status = "okay";
+		};
+
+		uart2@e00 {
+			status = "okay";
+		};
+
+		pwm@5000 {
+			status = "okay";
+		};
+	};
+
+	ethernet@10100000 {
+		mtd-mac-address = <&factory 0x4>;
+		ralink,port-map = "llllw";
+	};
+	
+	pcie@10140000 {
+		status = "okay";
+	};
+
+	sdhci@10130000 {
+		status = "okay";
+		mediatek,cd-high;
+//		mediatek,cd-poll;
+	};
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5661a:blue:system";
+			gpios = <&gpio1 5 1>;
+		};
+		
+		internet {
+			label = "hc5661a:blue:internet";
+			gpios = <&gpio0 1 0>;
+		};
+		
+		wlan2g {
+			label = "hc5661a:blue:wlan2g";
+			gpios = <&gpio1 12 0>;
+		};
+	};
+
+	gpio-keys-polled {
+		compatible = "gpio-keys-polled";
+		#address-cells = <1>;
+		#size-cells = <0>;
+		poll-interval = <20>;
+	
+		reset {
+			label = "reset";
+			gpios = <&gpio1 6 1>;
+			linux,code = <0x198>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/ZC9525.dts target/linux/ramips/dts/ZC9525.dts
--- target_orig/linux/ramips/dts/ZC9525.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/ZC9525.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,32 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "ZC9525", "ralink,mt7620a-soc";
+	model = "KunTeng ZC9525";
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5661:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		internet {
+			label = "hc5661:blue:internet";
+			gpios = <&gpio0 11 1>;
+		};
+
+		wlan2g {
+			label = "hc5661:blue:wlan2g";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5661:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/ZC9526.dts target/linux/ramips/dts/ZC9526.dts
--- target_orig/linux/ramips/dts/ZC9526.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/ZC9526.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,32 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "ZC9526", "ralink,mt7620a-soc";
+	model = "KunTeng ZC9526";
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5761:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		internet {
+			label = "hc5761:blue:internet";
+			gpios = <&gpio0 11 1>;
+		};
+
+		wlan2g {
+			label = "hc5761:blue:wlan2g";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5761:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/dts/ZC9527.dts target/linux/ramips/dts/ZC9527.dts
--- target_orig/linux/ramips/dts/ZC9527.dts	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/dts/ZC9527.dts	2016-07-18 09:34:16.849095040 +0800
@@ -0,0 +1,32 @@
+/dts-v1/;
+
+/include/ "HC5XXX.dtsi"
+
+/ {
+	compatible = "ZC9527", "ralink,mt7620a-soc";
+	model = "KunTeng ZC9527";
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		system {
+			label = "hc5761:blue:system";
+			gpios = <&gpio0 9 1>;
+		};
+
+		internet {
+			label = "hc5761:blue:internet";
+			gpios = <&gpio0 11 1>;
+		};
+
+		wlan2g {
+			label = "hc5761:blue:wlan2g";
+			gpios = <&gpio3 0 1>;
+		};
+
+		wlan5g {
+			label = "hc5761:blue:wlan5g";
+			gpios = <&gpio0 7 1>;
+		};
+	};
+};
diff -urpN target_orig/linux/ramips/image/Makefile target/linux/ramips/image/Makefile
--- target_orig/linux/ramips/image/Makefile	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/image/Makefile	2016-07-18 09:34:16.909095058 +0800
@@ -888,6 +888,13 @@ Image/Build/Profile/ZBT-WA05=$(call Buil
 Image/Build/Profile/ArcherC20i=$(call BuildFirmware/Tplink/$(1),$(1),ArcherC20i,ArcherC20i)
 microwrt_mtd_size=16515072
 Image/Build/Profile/MicroWRT=$(call BuildFirmware/CustomFlash/$(1),$(1),microwrt,MicroWRT,$(microwrt_mtd_size))
+Image/Build/Profile/HC5661=$(call BuildFirmware/Default16M/$(1),$(1),hc5661,HC5661)
+Image/Build/Profile/HC5761=$(call BuildFirmware/Default16M/$(1),$(1),hc5761,HC5761)
+Image/Build/Profile/HC5861=$(call BuildFirmware/Default16M/$(1),$(1),hc5861,HC5861)
+Image/Build/Profile/ZC9525=$(call BuildFirmware/Default16M/$(1),$(1),zc9525,ZC9525)
+Image/Build/Profile/ZC9526=$(call BuildFirmware/Default16M/$(1),$(1),zc9526,ZC9526)
+Image/Build/Profile/ZC9527=$(call BuildFirmware/Default16M/$(1),$(1),zc9527,ZC9527)
+Image/Build/Profile/KT9762=$(call BuildFirmware/Default16M/$(1),$(1),kt9762,KT9762)
 
 
 ifeq ($(SUBTARGET),mt7620)
@@ -920,6 +927,13 @@ define Image/Build/Profile/Default
 	$(call Image/Build/Profile/ZBT-WA05,$(1))
 	$(call Image/Build/Profile/ArcherC20i,$(1))
 	$(call Image/Build/Profile/MicroWRT,$(1))
+	$(call Image/Build/Profile/HC5661,$(1))
+	$(call Image/Build/Profile/HC5761,$(1))
+	$(call Image/Build/Profile/HC5861,$(1))
+	$(call Image/Build/Profile/ZC9525,$(1))
+	$(call Image/Build/Profile/ZC9526,$(1))
+	$(call Image/Build/Profile/ZC9527,$(1))
+	$(call Image/Build/Profile/KT9762,$(1))
 endef
 endif
 
@@ -928,9 +942,40 @@ endif
 #
 
 ifeq ($(SUBTARGET),mt7621)
-  TARGET_DEVICES += mt7621 wsr-600 wsr-1166 dir-860l-b1 firewrt pbr-m1 re6500 zbt-wg2626
+  #TARGET_DEVICES += mt7621 wsr-600 wsr-1166 dir-860l-b1 firewrt pbr-m1 re6500 zbt-wg2626
+  TARGET_DEVICES += kt9962
 endif
 
+define Device/kt9962
+  DTS := KT9962
+  BLOCKSIZE := 128KiB
+  IMAGES := sysupgrade.bin
+  PAGESIZE := 2048
+  KERNEL_SIZE := 2097152
+  FILESYSTEMS := squashfs
+  IMAGE/sysupgrade.bin := append-kernel | pad-to $$(KERNEL_SIZE) | append-ubi | check-size $$$$(ralink_default_fw_size_32M)
+endef
+
+#
+# MT7621 Profiles
+#
+
+ifeq ($(SUBTARGET),mt7621)
+  #TARGET_DEVICES += mt7621 wsr-600 wsr-1166 dir-860l-b1 firewrt pbr-m1 re6500 zbt-wg2626
+  TARGET_DEVICES += kt9990
+endif
+
+define Device/kt9990
+  DTS := KT9990
+  BLOCKSIZE := 128KiB
+  IMAGES := sysupgrade.bin
+  PAGESIZE := 2048
+  KERNEL_SIZE := 2097152
+  FILESYSTEMS := squashfs
+  IMAGE/sysupgrade.bin := append-kernel | pad-to $$(KERNEL_SIZE) | append-ubi | check-size $$$$(ralink_default_fw_size_32M)
+endef
+
+
 define Device/mt7621
   DTS := MT7621
   IMAGE_SIZE := $(ralink_default_fw_size_4M)
@@ -984,10 +1029,36 @@ endef
 #
 
 Image/Build/Profile/MT7628=$(call BuildFirmware/Default4M/$(1),$(1),mt7628,MT7628)
+Image/Build/Profile/HC5661A=$(call BuildFirmware/Default16M/$(1),$(1),hc5661a,HC5661A)
+Image/Build/Profile/ZC9525A=$(call BuildFirmware/Default16M/$(1),$(1),zc9525a,ZC9525A)
+Image/Build/Profile/KT9762=$(call BuildFirmware/Default16M/$(1),$(1),kt9762,KT9762)
+
+#victor 20160519 add oem Image
+#jpm
+ifeq ($(CONFIG_PACKAGE_jpm-base-files),y)
+Image/Build/Profile/ZC9525=$(call BuildFirmware/Default16M/$(1),$(1),jpm9525,ZC9525)
+Image/Build/Profile/ZC9526=$(call BuildFirmware/Default16M/$(1),$(1),jpm9526,ZC9526)
+Image/Build/Profile/ZC9527=$(call BuildFirmware/Default16M/$(1),$(1),jpm9527,ZC9527)
+Image/Build/Profile/ZC9525A=$(call BuildFirmware/Default16M/$(1),$(1),jpm9525a,ZC9525A)
+Image/Build/Profile/KT9762=$(call BuildFirmware/Default16M/$(1),$(1),jpm9762,KT9762)
+endif
+#mili
+ifeq ($(CONFIG_PACKAGE_mili-wifidog),y)
+Image/Build/Profile/ZC9525=$(call BuildFirmware/Default16M/$(1),$(1),mili9525,ZC9525)
+Image/Build/Profile/ZC9526=$(call BuildFirmware/Default16M/$(1),$(1),mili9526,ZC9526)
+Image/Build/Profile/ZC9527=$(call BuildFirmware/Default16M/$(1),$(1),mili9527,ZC9527)
+Image/Build/Profile/ZC9525A=$(call BuildFirmware/Default16M/$(1),$(1),mili9525a,ZC9525A)
+Image/Build/Profile/KT9762=$(call BuildFirmware/Default16M/$(1),$(1),mili9762,KT9762)
+endif
+#end victor
+
 
 ifeq ($(SUBTARGET),mt7628)
 define Image/Build/Profile/Default
 	$(call Image/Build/Profile/MT7628,$(1))
+	$(call Image/Build/Profile/HC5661A,$(1))
+	$(call Image/Build/Profile/ZC9525A,$(1))
+	$(call Image/Build/Profile/KT9762,$(1))
 endef
 endif
 
diff -urpN target_orig/linux/ramips/mt7620/config-3.18 target/linux/ramips/mt7620/config-3.18
--- target_orig/linux/ramips/mt7620/config-3.18	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/mt7620/config-3.18	2016-07-18 09:34:16.913095058 +0800
@@ -13,6 +13,7 @@ CONFIG_ARCH_WANT_IPC_PARSE_VERSION=y
 CONFIG_AT803X_PHY=y
 CONFIG_CC_OPTIMIZE_FOR_SIZE=y
 CONFIG_CEVT_R4K=y
+CONFIG_CEVT_SYSTICK_QUIRK=y
 CONFIG_CLKDEV_LOOKUP=y
 CONFIG_CLKEVT_RT3352=y
 CONFIG_CLKSRC_MMIO=y
@@ -39,7 +40,6 @@ CONFIG_CSRC_R4K=y
 CONFIG_DEBUG_PINCTRL=y
 CONFIG_DMA_NONCOHERENT=y
 # CONFIG_DTB_MT7620A_EVAL is not set
-# CONFIG_DTB_MT7628AN_EVAL is not set
 CONFIG_DTB_RT_NONE=y
 CONFIG_DTC=y
 CONFIG_EARLY_PRINTK=y
@@ -151,8 +151,6 @@ CONFIG_PINCTRL_RT2880=y
 # CONFIG_PINCTRL_SINGLE is not set
 # CONFIG_PREEMPT_RCU is not set
 CONFIG_RALINK=y
-# CONFIG_RALINK_ILL_ACC is not set
-CONFIG_RALINK_USBPHY=y
 CONFIG_RALINK_WDT=y
 # CONFIG_RCU_STALL_COMMON is not set
 CONFIG_RESET_CONTROLLER=y
@@ -167,8 +165,6 @@ CONFIG_SOC_MT7620=y
 # CONFIG_SOC_RT288X is not set
 # CONFIG_SOC_RT305X is not set
 # CONFIG_SOC_RT3883 is not set
-CONFIG_SND_MT76XX_SOC_MT7620=y
-# CONFIG_SND_MT76XX_SOC_MT7628 is not set
 CONFIG_SPI=y
 CONFIG_SPI_MASTER=y
 # CONFIG_SPI_MT7621 is not set
@@ -182,8 +178,8 @@ CONFIG_SYS_SUPPORTS_ARBIT_HZ=y
 CONFIG_SYS_SUPPORTS_LITTLE_ENDIAN=y
 CONFIG_SYS_SUPPORTS_MIPS16=y
 CONFIG_TICK_CPU_ACCOUNTING=y
-CONFIG_USB_PHY=y
 CONFIG_USB_SUPPORT=y
 CONFIG_USE_OF=y
 CONFIG_WATCHDOG_CORE=y
 CONFIG_ZONE_DMA_FLAG=0
+
diff -urpN target_orig/linux/ramips/mt7620/profiles/hiwifi.mk target/linux/ramips/mt7620/profiles/hiwifi.mk
--- target_orig/linux/ramips/mt7620/profiles/hiwifi.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/mt7620/profiles/hiwifi.mk	2016-07-18 09:34:16.913095058 +0800
@@ -0,0 +1,47 @@
+#
+# Copyright (C) 2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/HC5661
+	NAME:=HiWiFi HC5661
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+   		kmod-ledtrig-usbdev kmod-mt7620 apfree-wireless
+endef
+
+define Profile/HC5661/Description
+	Support HiWiFi HC5661 model(J1S)
+endef
+$(eval $(call Profile,HC5661))
+
+
+define Profile/HC5761
+	NAME:=HiWiFi HC5761
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+		kmod-ledtrig-usbdev kmod-mt7620 kmod-mt7610e
+endef
+
+define Profile/HC5761/Description
+	Support HiWiFi HC5761 model(J2)
+endef
+$(eval $(call Profile,HC5761))
+
+	
+define Profile/HC5861
+	NAME:=HiWiFi HC5861
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+		kmod-ledtrig-usbdev kmod-mt7620 kmod-mt7610e
+endef
+
+define Profile/HC5861/Description
+	Support HiWiFi HC5861 model(J3)
+endef
+$(eval $(call Profile,HC5861))
diff -urpN target_orig/linux/ramips/mt7620/profiles/kunteng.mk target/linux/ramips/mt7620/profiles/kunteng.mk
--- target_orig/linux/ramips/mt7620/profiles/kunteng.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/mt7620/profiles/kunteng.mk	2016-07-18 09:34:16.913095058 +0800
@@ -0,0 +1,48 @@
+#
+# Copyright (C) 2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+
+define Profile/ZC9525
+	NAME:=KunTeng ZC9525
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+   		kmod-ledtrig-usbdev kmod-mt7620 apfree-wireless
+endef
+
+define Profile/ZC9525/Description
+	Support KunTeng ZC9525 model(J1S)
+endef
+$(eval $(call Profile,ZC9525))
+
+
+define Profile/ZC9526
+	NAME:=KunTeng ZC9526
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+		kmod-ledtrig-usbdev kmod-mt7620 kmod-mt7610e
+endef
+
+define Profile/ZC9526/Description
+	Support KunTeng ZC9526 model(J2)
+endef
+$(eval $(call Profile,ZC9526))
+
+
+define Profile/ZC9527
+	NAME:=KunTeng ZC9527
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci kmod-sdhci-mt7620 \
+		kmod-ledtrig-usbdev kmod-mt7620 kmod-mt7610e bridged_ap
+endef
+
+define Profile/ZC9527/Description
+	Support KunTeng ZC9527 mode(bridged-ap support)
+endef
+$(eval $(call Profile,ZC9527))
diff -urpN target_orig/linux/ramips/mt7620/target.mk target/linux/ramips/mt7620/target.mk
--- target_orig/linux/ramips/mt7620/target.mk	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/mt7620/target.mk	2016-07-18 09:34:16.913095058 +0800
@@ -9,7 +9,7 @@ FEATURES+=usb
 CPU_TYPE:=24kec
 CPU_SUBTYPE:=dsp
 
-DEFAULT_PACKAGES += kmod-rt2800-pci kmod-rt2800-soc
+#DEFAULT_PACKAGES += kmod-rt2800-pci kmod-rt2800-soc
 
 define Target/Description
 	Build firmware images for Ralink MT7620 based boards.
diff -urpN target_orig/linux/ramips/mt7621/config-3.18 target/linux/ramips/mt7621/config-3.18
--- target_orig/linux/ramips/mt7621/config-3.18	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/mt7621/config-3.18	2016-07-18 09:34:16.913095058 +0800
@@ -36,6 +36,9 @@ CONFIG_CPU_RMAP=y
 CONFIG_CPU_SUPPORTS_32BIT_KERNEL=y
 CONFIG_CPU_SUPPORTS_HIGHMEM=y
 CONFIG_CPU_SUPPORTS_MSA=y
+CONFIG_CRC16=y
+CONFIG_CRYPTO_DEFLATE=y
+CONFIG_CRYPTO_LZO=y
 CONFIG_CSRC_R4K=y
 CONFIG_DEBUG_PINCTRL=y
 CONFIG_DMA_NONCOHERENT=y
@@ -94,7 +97,6 @@ CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
 CONFIG_HIGHMEM=y
 CONFIG_HW_HAS_PCI=y
 CONFIG_HZ_PERIODIC=y
-CONFIG_IMAGE_CMDLINE_HACK=y
 CONFIG_INITRAMFS_SOURCE=""
 CONFIG_IRQCHIP=y
 CONFIG_IRQ_CPU=y
@@ -103,6 +105,8 @@ CONFIG_IRQ_FORCED_THREADING=y
 CONFIG_IRQ_GIC=y
 CONFIG_IRQ_WORK=y
 CONFIG_LIBFDT=y
+CONFIG_LZO_COMPRESS=y
+CONFIG_LZO_DECOMPRESS=y
 CONFIG_MDIO_BOARDINFO=y
 CONFIG_MIPS=y
 CONFIG_MIPS_CM=y
@@ -118,18 +122,26 @@ CONFIG_MIPS_MT_FPAFF=y
 CONFIG_MIPS_MT_SMP=y
 CONFIG_MIPS_PERF_SHARED_TC_COUNTERS=y
 # CONFIG_MIPS_VPE_LOADER is not set
-# CONFIG_MTK_MTD_NAND is not set
 CONFIG_MODULES_USE_ELF_REL=y
 CONFIG_MT7621_WDT=y
 # CONFIG_MTD_CFI_INTELEXT is not set
 CONFIG_MTD_CMDLINE_PARTS=y
 CONFIG_MTD_M25P80=y
+CONFIG_MTD_NAND=y
+CONFIG_MTD_NAND_ECC=y
 CONFIG_MTD_PHYSMAP=y
 CONFIG_MTD_SPI_NOR=y
 CONFIG_MTD_SPLIT_FIRMWARE=y
 CONFIG_MTD_SPLIT_SEAMA_FW=y
 CONFIG_MTD_SPLIT_TRX_FW=y
 CONFIG_MTD_SPLIT_UIMAGE_FW=y
+CONFIG_MTD_UBI=y
+CONFIG_MTD_UBI_BEB_LIMIT=20
+CONFIG_MTD_UBI_BLOCK=y
+# CONFIG_MTD_UBI_FASTMAP is not set
+# CONFIG_MTD_UBI_GLUEBI is not set
+CONFIG_MTD_UBI_WL_THRESHOLD=4096
+CONFIG_MTK_MTD_NAND=y
 CONFIG_NEED_DMA_MAP_STATE=y
 CONFIG_NET_FLOW_LIMIT=y
 CONFIG_NET_RALINK=y
@@ -209,9 +221,16 @@ CONFIG_SYS_SUPPORTS_SCHED_SMT=y
 CONFIG_SYS_SUPPORTS_SMP=y
 CONFIG_TICK_CPU_ACCOUNTING=y
 CONFIG_TREE_RCU=y
+CONFIG_UBIFS_FS=y
+CONFIG_UBIFS_FS_ADVANCED_COMPR=y
+CONFIG_UBIFS_FS_LZO=y
+# CONFIG_UBIFS_FS_XZ is not set
+CONFIG_UBIFS_FS_ZLIB=y
 CONFIG_USB_SUPPORT=y
 CONFIG_USE_OF=y
 CONFIG_WATCHDOG_CORE=y
 CONFIG_WEAK_ORDERING=y
 CONFIG_XPS=y
+CONFIG_ZLIB_DEFLATE=y
+CONFIG_ZLIB_INFLATE=y
 CONFIG_ZONE_DMA_FLAG=0
diff -urpN target_orig/linux/ramips/mt7621/profiles/kunteng.mk target/linux/ramips/mt7621/profiles/kunteng.mk
--- target_orig/linux/ramips/mt7621/profiles/kunteng.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/mt7621/profiles/kunteng.mk	2016-07-18 09:34:16.913095058 +0800
@@ -0,0 +1,40 @@
+#
+# Copyright (C) 2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/KT9962
+	NAME:=KunTeng KT9962
+	PACKAGES:=\
+		kmod-usb-core kmod-usb3 kmod-usb-hid \
+		kmod-ledtrig-netdev
+endef
+
+define Profile/KT9962/Description
+	Support KunTeng KT9962 model(MT7621-NAND).
+endef
+
+#-m <min io size> -e <LEB size> -c <Eraseblocks count>
+KT9962_UBIFS_OPTS:="-m 2048 -e 129024 -c 1024"
+KT9962_UBI_OPTS:="-m 2048 -p 128KiB -s 512"
+
+$(eval $(call Profile,KT9962))
+
+define Profile/KT9990
+	NAME:=KunTeng KT9990
+	PACKAGES:=\
+		kmod-usb-core kmod-usb3 kmod-usb-hid \
+		kmod-ledtrig-netdev
+endef
+
+define Profile/KT9990/Description
+	Support KunTeng KT9990 model(MT7621-NAND).
+endef
+
+#-m <min io size> -e <LEB size> -c <Eraseblocks count>
+KT9990_UBIFS_OPTS:="-m 2048 -e 129024 -c 1024"
+KT9990_UBI_OPTS:="-m 2048 -p 128KiB -s 512"
+
+$(eval $(call Profile,KT9990))
diff -urpN target_orig/linux/ramips/mt7621/target.mk target/linux/ramips/mt7621/target.mk
--- target_orig/linux/ramips/mt7621/target.mk	2016-06-17 15:12:18.496786388 +0800
+++ target/linux/ramips/mt7621/target.mk	2016-07-18 09:34:16.913095058 +0800
@@ -5,7 +5,7 @@
 SUBTARGET:=mt7621
 BOARDNAME:=MT7621 based boards
 ARCH_PACKAGES:=ramips_1004kc
-FEATURES+=usb
+FEATURES+=usb squashfs nand ubifs
 CPU_TYPE:=1004kc
 CPU_SUBTYPE:=dsp
 CFLAGS:=-Os -pipe -mmt -mips32r2 -mtune=1004kc
diff -urpN target_orig/linux/ramips/mt7628/profiles/hiwifi.mk target/linux/ramips/mt7628/profiles/hiwifi.mk
--- target_orig/linux/ramips/mt7628/profiles/hiwifi.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/mt7628/profiles/hiwifi.mk	2016-07-18 09:34:16.913095058 +0800
@@ -0,0 +1,19 @@
+#
+# Copyright (C) 2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/HC5661A
+	NAME:=HiWiFi HC5661A
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci \
+   		kmod-ledtrig-usbdev kmod-mt7628 apfree-wireless apfree_wifidog
+endef
+
+define Profile/HC5661A/Description
+	Support HiWiFi HC5661A model
+endef
+$(eval $(call Profile,HC5661A))
diff -urpN target_orig/linux/ramips/mt7628/profiles/kunteng.mk target/linux/ramips/mt7628/profiles/kunteng.mk
--- target_orig/linux/ramips/mt7628/profiles/kunteng.mk	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/mt7628/profiles/kunteng.mk	2016-07-18 09:34:16.913095058 +0800
@@ -0,0 +1,33 @@
+#
+# Copyright (C) 2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/ZC9525A
+	NAME:=KunTeng ZC9525A
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci \
+   		kmod-ledtrig-usbdev kmod-mt7628 apfree-wireless apfree_wifidog
+endef
+
+define Profile/ZC9525A/Description
+	Support KunTeng ZC9525A model
+endef
+$(eval $(call Profile,ZC9525A))
+
+
+define Profile/KT9762
+	NAME:=KunTeng KT9762
+	PACKAGES:=\
+		kmod-usb-core kmod-usb-dwc2 kmod-usb2 \
+		kmod-mmc-spi kmod-sdhci \
+   		kmod-ledtrig-usbdev kmod-mt7628 kmod-mt7612e apfree-wireless apfree_wifidog
+endef
+
+define Profile/KT9762/Description
+	Support KunTeng KT9762 model
+endef
+$(eval $(call Profile,KT9762))
\ 文件尾没有 newline 字符
diff -urpN target_orig/linux/ramips/patches-3.18/1000-01-mt762x-send-wan-plug-event-for-hotplug.patch target/linux/ramips/patches-3.18/1000-01-mt762x-send-wan-plug-event-for-hotplug.patch
--- target_orig/linux/ramips/patches-3.18/1000-01-mt762x-send-wan-plug-event-for-hotplug.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-01-mt762x-send-wan-plug-event-for-hotplug.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,34 @@
+--- a/drivers/net/ethernet/ralink/gsw_mt7620a.c
++++ b/drivers/net/ethernet/ralink/gsw_mt7620a.c
+@@ -287,7 +287,9 @@ static irqreturn_t gsw_interrupt_mt7620(
+ 	struct mt7620_gsw *gsw = (struct mt7620_gsw *) priv->soc->swpriv;
+ 	u32 status;
+ 	int i, max = (gsw->port4 == PORT4_EPHY) ? (4) : (3);
+-
++	char port_num[32];
++	char *envp[] = {port_num, NULL};
++	
+ 	status = gsw_r32(gsw, GSW_REG_ISR);
+ 	if (status & PORT_IRQ_ST_CHG)
+ 		for (i = 0; i <= max; i++) {
+@@ -296,11 +298,20 @@ static irqreturn_t gsw_interrupt_mt7620(
+ 
+ 			if (link != priv->link[i]) {
+ 				if (link)
++				{
+ 					netdev_info(priv->netdev, "port %d link up (%sMbps/%s duplex)\n",
+ 							i, fe_speed_str((status >> 2) & 3),
+ 							(status & 0x2) ? "Full" : "Half");
++
++					snprintf(port_num, sizeof(port_num), "PORT_ID=%d", i);
++					kobject_uevent_env(&priv->netdev->dev.kobj, KOBJ_ONLINE, envp);
++				}
+ 				else
++				{
+ 					netdev_info(priv->netdev, "port %d link down\n", i);
++					snprintf(port_num, sizeof(port_num), "PORT_ID=%d", i);
++					kobject_uevent_env(&priv->netdev->dev.kobj, KOBJ_OFFLINE, envp);
++				}
+ 			}
+ 
+ 			priv->link[i] = link;
diff -urpN target_orig/linux/ramips/patches-3.18/1000-02-mt7628-send-wan-plug-event-for-hotplug.patch target/linux/ramips/patches-3.18/1000-02-mt7628-send-wan-plug-event-for-hotplug.patch
--- target_orig/linux/ramips/patches-3.18/1000-02-mt7628-send-wan-plug-event-for-hotplug.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-02-mt7628-send-wan-plug-event-for-hotplug.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,58 @@
+--- a/drivers/net/ethernet/ralink/esw_rt3052.c
++++ b/drivers/net/ethernet/ralink/esw_rt3052.c
+@@ -212,6 +212,7 @@ enum {
+ };
+ 
+ struct esw_port {
++	bool	link_status;
+ 	bool	disable;
+ 	bool	doubletag;
+ 	bool	untag;
+@@ -509,6 +510,10 @@ static void esw_hw_init(struct rt305x_es
+ 	for (i = 0; i < 6; i++)
+ 		esw->ports[i].disable = (port_disable & (1 << i)) != 0;
+ 
++	for (i = 0; i < 6; i++)
++		esw->ports[i].link_status = 0;
++
++
+ 	if (ralink_soc == RT305X_SOC_RT3352) {
+ 		/* reset EPHY */
+ 		fe_reset(RT5350_RESET_EPHY);
+@@ -720,6 +725,9 @@ static irqreturn_t esw_interrupt(int irq
+ {
+ 	struct rt305x_esw *esw = (struct rt305x_esw *) _esw;
+ 	u32 status;
++	u32 poa, i, link_status;
++	char port_num[32];
++	char *envp[] = {port_num, NULL};
+ 
+ 	status = esw_r32(esw, RT305X_ESW_REG_ISR);
+ 	if (status & RT305X_ESW_PORT_ST_CHG) {
+@@ -727,6 +735,26 @@ static irqreturn_t esw_interrupt(int irq
+ 		link >>= RT305X_ESW_POA_LINK_SHIFT;
+ 		link &= RT305X_ESW_POA_LINK_MASK;
+ 		dev_info(esw->dev, "link changed 0x%02X\n", link);
++
++                          for (i = 0; i < RT305X_ESW_NUM_PORTS; i++)
++                          {
++                	        poa = esw_r32(esw, RT305X_ESW_REG_POA) >> i;
++                	        link_status = (poa >> RT305X_ESW_LINK_S) & 1;
++
++                                  if (link_status != esw->ports[i].link_status)
++                                  {
++                                        esw->ports[i].link_status = link_status;
++                                        snprintf(port_num, sizeof(port_num), "PORT_ID=%d", i);
++                                        if (link_status)
++                                        {
++                 		        kobject_uevent_env(&esw->dev->kobj, KOBJ_ONLINE, envp);
++         		              }
++         		              else
++         		              {
++                 		       kobject_uevent_env(&esw->dev->kobj, KOBJ_OFFLINE, envp);
++         		              }
++                                  }
++                          }
+ 	}
+ 	esw_w32(esw, status, RT305X_ESW_REG_ISR);
+ 
diff -urpN target_orig/linux/ramips/patches-3.18/1000-03-mt7628-wan-led.patch target/linux/ramips/patches-3.18/1000-03-mt7628-wan-led.patch
--- target_orig/linux/ramips/patches-3.18/1000-03-mt7628-wan-led.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-03-mt7628-wan-led.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,70 @@
+--- a/drivers/net/ethernet/ralink/esw_rt3052.c
++++ b/drivers/net/ethernet/ralink/esw_rt3052.c
+@@ -721,10 +721,14 @@ static void esw_hw_init(struct rt305x_es
+ 	esw_w32(esw, ~RT305X_ESW_PORT_ST_CHG, RT305X_ESW_REG_IMR);
+ }
+ 
++/* begin: add by chenzejun for wan led by 2016.6.22 */
++struct net_device *ralink_esw_netdev = NULL;
++EXPORT_SYMBOL_GPL(ralink_esw_netdev);
++/* end: add by chenzejun for wan led by 2016.6.22 */
+ static irqreturn_t esw_interrupt(int irq, void *_esw)
+ {
+ 	struct rt305x_esw *esw = (struct rt305x_esw *) _esw;
+-	u32 status;
++	u32 status, carrier = 0;
+ 	u32 poa, i, link_status;
+ 	char port_num[32];
+ 	char *envp[] = {port_num, NULL};
+@@ -754,10 +758,24 @@ static irqreturn_t esw_interrupt(int irq
+                  		       kobject_uevent_env(&esw->dev->kobj, KOBJ_OFFLINE, envp);
+          		              }
+                                   }
++                                  if (link_status)  carrier++;
+                           }
+ 	}
+ 	esw_w32(esw, status, RT305X_ESW_REG_ISR);
+ 
++/* begin: add by chenzejun for wan led by 2016.6.22 */
++             if (ralink_esw_netdev && (carrier > 1))
++        	{
++        		//printk("link up wan, carrier:%d\n", carrier);
++        		netif_carrier_on(ralink_esw_netdev);
++        	}
++        	else
++        	{
++        		//printk("link down wan, carrier:%d\n", carrier);
++        		netif_carrier_off(ralink_esw_netdev);
++        	}
++/* end: add by chenzejun for wan led by 2016.6.22 */
++
+ 	return IRQ_HANDLED;
+ }
+ 
+--- a/drivers/net/ethernet/ralink/ralink_soc_eth.c
++++ b/drivers/net/ethernet/ralink/ralink_soc_eth.c
+@@ -1411,6 +1411,11 @@ static void fe_pending_work(struct work_
+ 	}
+ }
+ 
++/* begin: add by chenzejun for wan led by 2016.6.22 */
++#ifdef CONFIG_NET_RALINK_ESW_RT3052
++extern struct net_device *ralink_esw_netdev;
++#endif
++/* end: add by chenzejun for wan led by 2016.6.22 */
+ static int fe_probe(struct platform_device *pdev)
+ {
+ 	struct resource *res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
+@@ -1508,6 +1513,12 @@ static int fe_probe(struct platform_devi
+ 
+ 	platform_set_drvdata(pdev, netdev);
+ 
++/* begin: add by chenzejun for wan led by 2016.6.22 */
++#ifdef CONFIG_NET_RALINK_ESW_RT3052
++	ralink_esw_netdev = netdev;
++#endif
++/* end: add by chenzejun for wan led by 2016.6.22 */
++
+ 	netif_info(priv, probe, netdev, "ralink at 0x%08lx, irq %d\n",
+ 			netdev->base_addr, netdev->irq);
+ 
diff -urpN target_orig/linux/ramips/patches-3.18/1000-04-mt7621-send-wan-plug-event-for-hotplug.patch target/linux/ramips/patches-3.18/1000-04-mt7621-send-wan-plug-event-for-hotplug.patch
--- target_orig/linux/ramips/patches-3.18/1000-04-mt7621-send-wan-plug-event-for-hotplug.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-04-mt7621-send-wan-plug-event-for-hotplug.patch	2016-07-18 09:34:16.929095063 +0800
@@ -0,0 +1,29 @@
+--- a/drivers/net/ethernet/ralink/gsw_mt7620a.c
++++ b/drivers/net/ethernet/ralink/gsw_mt7620a.c
+@@ -328,6 +328,8 @@ static irqreturn_t gsw_interrupt_mt7621(
+ 	struct fe_priv *priv = (struct fe_priv *) _priv;
+ 	struct mt7620_gsw *gsw = (struct mt7620_gsw *) priv->soc->swpriv;
+ 	u32 reg, i;
++	char port_num[32];
++	char *envp[] = {port_num, NULL};
+ 
+ 	reg = mt7530_mdio_r32(gsw, 0x700c);
+ 
+@@ -338,9 +340,17 @@ static irqreturn_t gsw_interrupt_mt7621(
+ 			if (link != priv->link[i]) {
+ 				priv->link[i] = link;
+ 				if (link)
++                                {
+ 					netdev_info(priv->netdev, "port %d link up\n", i);
++                                        snprintf(port_num, sizeof(port_num), "PORT_ID=%d", i);
++                                        kobject_uevent_env(&priv->netdev->dev.kobj, KOBJ_ONLINE, envp);
++                                }
+ 				else
++                                {
+ 					netdev_info(priv->netdev, "port %d link down\n", i);
++                                        snprintf(port_num, sizeof(port_num), "PORT_ID=%d", i);
++                                        kobject_uevent_env(&priv->netdev->dev.kobj, KOBJ_OFFLINE, envp);
++                                }
+ 			}
+ 		}
+ 
diff -urpN target_orig/linux/ramips/patches-3.18/1000-mt7628-zc9525a-wifi-led-support.patch target/linux/ramips/patches-3.18/1000-mt7628-zc9525a-wifi-led-support.patch
--- target_orig/linux/ramips/patches-3.18/1000-mt7628-zc9525a-wifi-led-support.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-mt7628-zc9525a-wifi-led-support.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,106 @@
+Index: linux-3.18.23/drivers/gpio/gpio-mt7621.c
+===================================================================
+--- linux-3.18.23.orig/drivers/gpio/gpio-mt7621.c	2016-03-10 19:18:45.107864835 +0900
++++ linux-3.18.23/drivers/gpio/gpio-mt7621.c	2016-03-10 19:25:14.311857865 +0900
+@@ -16,10 +16,36 @@
+ #include <linux/irqdomain.h>
+ #include <linux/interrupt.h>
+ #include <linux/platform_device.h>
++#include <asm/mach-ralink/ralink_regs.h>
+ 
+ #define MTK_MAX_BANK		3
+ #define MTK_BANK_WIDTH		32
+ 
++#define SYSC_REG_GPIO1_MDOE     0x60
++#define SYSC_REG_GPIO2_MDOE     0x64
++
++#define WDT_GPIO_MODE    (1 << 14)
++#define REFCLK_GPIO_MODE    (1 << 18)
++#define GPIO0_GPIO_MODE    (3 << 0)
++
++#define SPI_CS1_GPIO_MODE   (1 << 4)
++#define SPI_CS1_MODE_MASK   (3 << 4)
++
++#define WLAN_GPIO_MODE    (1 << 0)
++#define WLAN_GPIO_MASK    (3 << 0)
++
++#define P0_LED_GPIO_MASK    (3 << 2)
++#define P1_LED_MODE_MASK    (3 << 4)
++#define P2_LED_MODE_MASK    (3 << 6)
++#define P3_LED_MODE_MASK    (3 << 8)
++#define P4_LED_MODE_MASK    (3 << 10)
++
++#define P0_LED_GPIO_MODE    (1 << 2)
++#define P1_LED_GPIO_MODE    (1 << 4)
++#define P2_LED_GPIO_MODE    (1 << 6)
++#define P3_LED_GPIO_MODE    (1 << 8)
++#define P4_LED_GPIO_MODE    (1 << 10)
++
+ enum mediatek_gpio_reg {
+ 	GPIO_REG_CTRL = 0,
+ 	GPIO_REG_POL,
+@@ -301,6 +327,55 @@
+ 	.map = mediatek_gpio_gpio_map,
+ };
+ 
++
++static void 
++zc9525a_gpio_init(void)
++{
++	u32 gpio1_mode;
++    u32 gpio2_mode;
++
++    gpio1_mode = rt_sysc_r32(SYSC_REG_GPIO1_MDOE);
++    gpio2_mode = rt_sysc_r32(SYSC_REG_GPIO2_MDOE);
++
++    /*
++     * reset button and system
++     */
++    gpio1_mode |= WDT_GPIO_MODE | REFCLK_GPIO_MODE;
++    gpio1_mode &= ~GPIO0_GPIO_MODE;     // internet led
++
++    /*
++     * signal LED SPI_CS1
++     */
++    gpio1_mode &= ~SPI_CS1_MODE_MASK;
++    gpio1_mode |= SPI_CS1_GPIO_MODE;
++
++    /*
++     * wlan gpio to gpio mode
++     */
++    gpio2_mode &= ~WLAN_GPIO_MASK;
++    gpio2_mode |= WLAN_GPIO_MODE;
++
++    /*
++     * setup ephy led mode
++     */
++    gpio2_mode &= ~(P0_LED_GPIO_MASK | P1_LED_MODE_MASK | P2_LED_MODE_MASK | P3_LED_MODE_MASK | P4_LED_MODE_MASK);
++
++    /*
++     * PHY2 LED for usb
++     */
++    gpio2_mode &= ~P2_LED_MODE_MASK;
++    gpio2_mode |= P2_LED_GPIO_MODE;
++
++    /*
++     * PHY3 LED for wlan 5G led
++     */
++    gpio2_mode &= ~P3_LED_MODE_MASK;
++    gpio2_mode |= P3_LED_GPIO_MODE;
++	
++	rt_sysc_w32(gpio1_mode, SYSC_REG_GPIO1_MDOE);
++    rt_sysc_w32(gpio2_mode, SYSC_REG_GPIO2_MDOE);
++}
++
+ static int
+ mediatek_gpio_probe(struct platform_device *pdev)
+ {
+@@ -320,6 +395,8 @@
+ 			dev_err(&pdev->dev, "irq_domain_add_linear failed\n");
+ 	}
+ 
++	zc9525a_gpio_init();
++	
+ 	for_each_child_of_node(np, bank)
+ 		if (of_device_is_compatible(bank, "mtk,mt7621-gpio-bank"))
+ 			mediatek_gpio_bank_probe(pdev, bank);
diff -urpN target_orig/linux/ramips/patches-3.18/1000-mt76xx-support-openwrt.patch target/linux/ramips/patches-3.18/1000-mt76xx-support-openwrt.patch
--- target_orig/linux/ramips/patches-3.18/1000-mt76xx-support-openwrt.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1000-mt76xx-support-openwrt.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,13 @@
+Index: linux-3.18.23/Kconfig
+===================================================================
+--- linux-3.18.23.orig/Kconfig	2015-10-29 11:49:46.000000000 +0900
++++ linux-3.18.23/Kconfig	2015-12-08 17:06:57.779506887 +0900
+@@ -8,4 +8,8 @@
+ 	string
+ 	option env="SRCARCH"
+ 
++config SUPPORT_OPENWRT
++	bool
++	default y
++
+ source "arch/$SRCARCH/Kconfig"
diff -urpN target_orig/linux/ramips/patches-3.18/1001-enable-br-fastpath.patch target/linux/ramips/patches-3.18/1001-enable-br-fastpath.patch
--- target_orig/linux/ramips/patches-3.18/1001-enable-br-fastpath.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/1001-enable-br-fastpath.patch	2016-07-18 09:34:16.925095061 +0800
@@ -0,0 +1,13 @@
+Index: linux-3.18.23/net/bridge/br_fdb.c
+===================================================================
+--- linux-3.18.23.orig/net/bridge/br_fdb.c	2015-10-29 11:49:46.000000000 +0900
++++ linux-3.18.23/net/bridge/br_fdb.c	2015-12-08 21:29:59.523224266 +0900
+@@ -361,6 +361,8 @@
+ 
+ 	return NULL;
+ }
++EXPORT_SYMBOL(__br_fdb_get);
++
+ 
+ #if IS_ENABLED(CONFIG_ATM_LANE)
+ /* Interface used by ATM LANE hook to test
diff -urpN target_orig/linux/ramips/patches-3.18/907-fix-mt7621-nand-driver-build-faild.patch target/linux/ramips/patches-3.18/907-fix-mt7621-nand-driver-build-faild.patch
--- target_orig/linux/ramips/patches-3.18/907-fix-mt7621-nand-driver-build-faild.patch	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/patches-3.18/907-fix-mt7621-nand-driver-build-faild.patch	2016-07-18 09:34:16.929095063 +0800
@@ -0,0 +1,148 @@
+diff -urNb a/drivers/mtd/nand/mtk_nand.c b/drivers/mtd/nand/mtk_nand.c
+--- a/drivers/mtd/nand/mtk_nand.c	2015-11-06 16:44:31.000000000 +0400
++++ b/drivers/mtd/nand/mtk_nand.c	2015-11-12 10:06:20.080430855 +0400
+@@ -110,6 +110,10 @@
+ int manu_id;
+ int dev_id;
+ 
++/* this constant was taken from linux/nand/nand.h v 3.14
++ * in later versions it seems it was removed in order to save a bit of space
++ */
++#define NAND_MAX_OOBSIZE 774
+ static u8 local_oob_buf[NAND_MAX_OOBSIZE];
+ 
+ static u8 nand_badblock_offset = 0;
+@@ -348,7 +352,7 @@
+ 		if (0xF == u4ErrNum) {
+ 			mtd->ecc_stats.failed++;
+ 			bRet = false;
+-			//printk(KERN_ERR"UnCorrectable at PageAddr=%d\n", u4PageAddr);
++			printk(KERN_ERR"mtk_nand: UnCorrectable at PageAddr=%d\n", u4PageAddr);
+ 		} else {
+ 			for (i = 0; i < ((u4ErrNum + 1) >> 1); ++i) {
+ 				au4ErrBitLoc[i] = DRV_Reg32(ECC_DECEL0_REG32 + i);
+@@ -1422,7 +1426,7 @@
+ {
+ 	struct nand_chip *chip = (struct nand_chip *)mtd->priv;
+ 
+-	chip->erase_cmd(mtd, page);
++	chip->erase(mtd, page);
+ 
+ 	return chip->waitfunc(mtd, chip);
+ }
+@@ -2094,8 +2098,8 @@
+ 	nand_chip->write_page = mtk_nand_write_page;
+ 	nand_chip->ecc.write_oob = mtk_nand_write_oob;
+ 	nand_chip->block_markbad = mtk_nand_block_markbad;   // need to add nand_get_device()/nand_release_device().
+-	//	nand_chip->erase = mtk_nand_erase;	
+-	//    nand_chip->read_page = mtk_nand_read_page;
++	nand_chip->erase_mtk = mtk_nand_erase;	
++	nand_chip->read_page = mtk_nand_read_page;
+ 	nand_chip->ecc.read_oob = mtk_nand_read_oob;
+ 	nand_chip->block_bad = mtk_nand_block_bad;
+ 
+@@ -2175,6 +2179,21 @@
+ 	nand_chip->pagemask = (nand_chip->chipsize >> nand_chip->page_shift) - 1;
+ 	nand_chip->phys_erase_shift = ffs(mtd->erasesize) - 1;
+ 	nand_chip->chip_shift = ffs(nand_chip->chipsize) - 1;//0x1C;//ffs(nand_chip->chipsize) - 1;
++
++	/* allocate buffers or call select_chip here or a bit earlier*/
++	{
++		struct nand_buffers *nbuf = kzalloc(sizeof(*nbuf) + mtd->writesize + mtd->oobsize * 3, GFP_KERNEL);
++		if (!nbuf) {
++			return -ENOMEM;
++		}
++		nbuf->ecccalc = (uint8_t *)(nbuf + 1);
++		nbuf->ecccode = nbuf->ecccalc + mtd->oobsize;
++		nbuf->databuf = nbuf->ecccode + mtd->oobsize;
++
++		nand_chip->buffers = nbuf;
++		nand_chip->options |= NAND_OWN_BUFFERS;
++	}
++
+ 	nand_chip->oob_poi = nand_chip->buffers->databuf + mtd->writesize;
+ 	nand_chip->badblockpos = 0;
+ 
+@@ -2251,6 +2270,9 @@
+ 	MSG(INIT, "[NFI] mtk_nand_probe fail, err = %d!\n", err);
+ 	nand_release(mtd);
+ 	platform_set_drvdata(pdev, NULL);
++	if ( NULL != nand_chip->buffers) {
++		kfree(nand_chip->buffers);
++	}
+ 	kfree(host);
+ 	nand_disable_clock();
+ 	return err;
+@@ -2261,8 +2283,12 @@
+ {
+ 	struct mtk_nand_host *host = platform_get_drvdata(pdev);
+ 	struct mtd_info *mtd = &host->mtd;
++	struct nand_chip *nand_chip = &host->nand_chip;
+ 
+ 	nand_release(mtd);
++	if ( NULL != nand_chip->buffers) {
++		kfree(nand_chip->buffers);
++	}
+ 	kfree(host);
+ 	nand_disable_clock();
+ 
+diff -urNb a/drivers/mtd/nand/nand_base.c b/drivers/mtd/nand/nand_base.c
+--- a/drivers/mtd/nand/nand_base.c	2015-11-06 16:44:31.000000000 +0400
++++ b/drivers/mtd/nand/nand_base.c	2015-11-09 10:24:52.931720862 +0400
+@@ -1575,6 +1575,9 @@
+ 						 __func__, buf);
+ 
+ read_retry:
++#ifdef CONFIG_MTK_MTD_NAND
++			ret = chip->read_page(mtd, chip, bufpoi, page);
++#else
+ 			chip->cmdfunc(mtd, NAND_CMD_READ0, 0x00, page);
+ 
+ 			/*
+@@ -1593,6 +1596,7 @@
+ 			else
+ 				ret = chip->ecc.read_page(mtd, chip, bufpoi,
+ 							  oob_required, page);
++#endif /* CONFIG_MTK_MTD_NAND */
+ 			if (ret < 0) {
+ 				if (use_bufpoi)
+ 					/* Invalidate page cache */
+@@ -2770,8 +2774,11 @@
+ 		if (page <= chip->pagebuf && chip->pagebuf <
+ 		    (page + pages_per_block))
+ 			chip->pagebuf = -1;
+-
++#ifdef CONFIG_MTK_MTD_NAND
++		status = chip->erase_mtk(mtd, page & chip->pagemask);
++#else
+ 		status = chip->erase(mtd, page & chip->pagemask);
++#endif /* CONFIG_MTK_MTD_NAND */
+ 
+ 		/*
+ 		 * See if operation failed and additional status checks are
+diff -urNb a/drivers/mtd/nand/nand_device_list.h b/drivers/mtd/nand/nand_device_list.h
+--- a/drivers/mtd/nand/nand_device_list.h	2015-11-06 16:44:31.000000000 +0400
++++ b/drivers/mtd/nand/nand_device_list.h	2015-11-06 11:13:26.000000000 +0400
+@@ -43,6 +43,8 @@
+ 	{0xADBC, 0x905554, 5, 16, 512, 128, 2048, 64, 0x10801011, "H9DA4GH4JJAMC", 0},
+     {0x01F1, 0x801D01, 4, 8, 128, 128, 2048, 64, 0x30C77fff, "S34ML01G100TF", 0},
+     {0x92F1, 0x8095FF, 4, 8, 128, 128, 2048, 64, 0x30C77fff, "F59L1G81A", 0},
++	{0xC8DA, 0x909544, 5, 8, 256, 128, 2048, 64, 0x30C77fff, "F59L2G81A", 0},
++	{0xC8DC, 0x909554, 5, 8, 512, 128, 2048, 64, 0x30C77fff, "F59L4G81A", 0},
+ 	{0xECD3, 0x519558, 5, 8, 1024, 128, 2048, 64, 0x44333, "K9K8G8000", 0},
+     {0xC2F1, 0x801DC2, 4, 8, 128, 128, 2048, 64, 0x30C77fff, "MX30LF1G08AA", 0},
+     {0x98D3, 0x902676, 5, 8, 1024, 256, 4096, 224, 0x00C25332, "TC58NVG3S0F", 0},
+diff -urNb a/include/linux/mtd/nand.h b/include/linux/mtd/nand.h
+--- a/include/linux/mtd/nand.h	2015-11-06 16:44:30.000000000 +0400
++++ b/include/linux/mtd/nand.h	2015-11-09 10:18:55.704701886 +0400
+@@ -653,6 +653,10 @@
+ 	int (*write_page)(struct mtd_info *mtd, struct nand_chip *chip,
+ 			uint32_t offset, int data_len, const uint8_t *buf,
+ 			int oob_required, int page, int cached, int raw);
++#ifdef CONFIG_MTK_MTD_NAND
++	int (*read_page)(struct mtd_info *mtd, struct nand_chip *chip, u8 *buf, int page);
++	int (*erase_mtk)(struct mtd_info *mtd, int page);
++#endif /* CONFIG_MTK_MTD_NAND */
+ 	int (*onfi_set_features)(struct mtd_info *mtd, struct nand_chip *chip,
+ 			int feature_addr, uint8_t *subfeature_para);
+ 	int (*onfi_get_features)(struct mtd_info *mtd, struct nand_chip *chip,
diff -urpN target_orig/linux/ramips/wdpi_kernel/files/wdpi.conf target/linux/ramips/wdpi_kernel/files/wdpi.conf
--- target_orig/linux/ramips/wdpi_kernel/files/wdpi.conf	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/wdpi_kernel/files/wdpi.conf	2016-07-18 09:34:16.933095063 +0800
@@ -0,0 +1,6 @@
+config wdpi_kernel
+	option	wan_interface	'eth0.2'
+	option	br_interface	'br-lan'
+	option	wdpi_debug      '0'
+	option	wdpi_sample     '20'
+
diff -urpN target_orig/linux/ramips/wdpi_kernel/files/wdpi.init target/linux/ramips/wdpi_kernel/files/wdpi.init
--- target_orig/linux/ramips/wdpi_kernel/files/wdpi.init	1970-01-01 08:00:00.000000000 +0800
+++ target/linux/ramips/wdpi_kernel/files/wdpi.init	2016-07-18 09:34:16.933095063 +0800
@@ -0,0 +1,41 @@
+#!/bin/sh /etc/rc.common
+
+START=97
+
+SERVICE_USE_PID=1
+SERVICE_WRITE_PID=1
+SERVICE_DAEMONIZE=1
+
+WDPI=/usr/sbin/wdpi_kernel
+
+WDPI_wan_if=eth0.2
+WDPI_br_if=br_lan
+WDPI_debug=0
+WDPI_sample=0
+
+prepare_wdpi_conf(){
+	local cfg=$1
+        config_get WDPI_wan_if "$cfg" "wan_interface" "eth0.2"
+        config_get WDPI_br_if "$cfg" "br_interface" "br_lan"
+        config_get WDPI_debug "$cfg" "wdpi_debug" "0"
+        config_get WDPI_sample "$cfg" "wdpi_sample" "30"
+}
+
+start() {
+    local wan_ifname=`uci show network.wan.ifname | cut -d'=' -f 2|sed -e "s/'//g"`
+    local eth_str=`ifconfig | grep $wan_ifname`
+
+	config_load wdpi_kernel
+	config_foreach prepare_wdpi_conf wdpi_kernel
+	
+	if [ ! -n "$eth_str" ]; then
+		wan_ifname=$WDPI_wan_if
+		echo "config error: wan_ifname is not exist, replace with $wan_ifname" >/dev/ttyS0
+	fi	
+	
+	insmod $WDPI debug=$WDPI_debug samples=$WDPI_sample br_if=$WDPI_br_if wan_if=$wan_ifname
+}
+stop() {
+	rmmod $WDPI
+}
+		
